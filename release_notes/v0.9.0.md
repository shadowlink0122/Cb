# Cb言語 v0.9.0 リリースノート

## 🩹 バグ修正

**リリース日**: 2025年10月2日  
**バージョン**: v0.9.0  
**テスト成功率**: 100%

---

### 構造体メンバーの Union 値が 0 に戻ってしまう問題

#### 🎯 期待値
構造体に含まれる Union 型メンバーへ数値を代入・複合代入した際、代入後の値が保持され、`println` などで正しい値が表示される。

#### 🐛 不具合
`tests/cases/union/struct_union_compound_assignment.cb` などで、構造体を関数に渡して戻した後、Union メンバーを出力すると `10` ではなく `0` が表示され、複合代入結果が失われていた。

#### ✅ 修正ポイント
- 構造体と直アクセス変数間の同期処理で、Union メンバーの `type_name` と `current_type`、数値／文字列などの値を完全にコピーするよう `sync_struct_members_from_direct_access` を改修
- メンバー定義のメタ情報（ポインタ深度・参照・unsigned 指定など）を再適用し、戻り構造体をそのまま代入しても情報が欠落しないように調整

---

### 構造体メンバーの文字列配列が `0` で表示される問題

#### � 期待値
構造体メンバーとして保持している `string` 型の配列を `println`/`printf` すると、代入した文字列がそのまま出力される。

#### 🐛 不具合
`tests/cases/struct/struct_function_array_members.cb` など、構造体から返された `string[]` メンバーを出力すると `[honor, active]` のような期待値ではなく `[0, 0]` の初期値が表示されていた。

#### ✅ 修正ポイント
- `output_manager` が構造体メンバー配列を文字列として展開する際に、型の基底情報を正しく参照するように調整
- 直接アクセス中の変数と構造体メンバーとの同期処理で、`TYPE_ARRAY_BASE` を含む型情報を分解し、実際の要素型を用いてコピーを行うように修正
- デバッグ目的で追加されていた `std::cerr` 出力をすべて削除し、テスト実行時に余計なログが混ざらないように整理

---

## �🌟 新機能: unsigned プリミティブの正式サポート

- `tiny`/`short`/`int`/`long`/`char` に unsigned 指定を追加し、0 からそれぞれ 255・65535・4294967295・18446744073709551615・255 までの範囲をサポート
- `TypeManager::check_type_range` が unsigned フラグに基づいて最大値を切り替え、`VariableManager::assign_variable` など変数管理経路で自動的に適用
- 透過的なメンバーアクセスや配列・構造体同期を含むすべての代入パスで unsigned の範囲チェックと 0 への丸め処理を保証
- `tests/cases/unsigned/` 以下に境界値の成功／失敗ケースを追加し、`tests/integration/unsigned/test_unsigned.hpp` で一括検証

## 🔧 変更ファイル
- バグ修正
	- 構造体メンバーの Union 値
		- `src/backend/interpreter/core/interpreter.cpp`
		- `src/backend/interpreter/managers/variable_manager.cpp`
	- 構造体メンバーの文字列配列
		- `src/backend/interpreter/core/interpreter.cpp`
		- `src/backend/interpreter/managers/variable_manager.cpp`
		- `src/backend/interpreter/output/output_manager.cpp`
- 新機能
	- `src/backend/interpreter/managers/type_manager.cpp`
	- `src/backend/interpreter/managers/type_manager.h`
	- `src/backend/interpreter/managers/variable_manager.cpp`
	- `src/backend/interpreter/core/interpreter.h`
	- `src/backend/interpreter/common/common_operations.cpp`
	- `tests/cases/unsigned/*`
	- `tests/integration/unsigned/test_unsigned.hpp`

---

## 🧪 テスト
- `make`
- `./main tests/cases/struct/struct_function_array_members.cb`
- `./main tests/cases/union/struct_union_compound_assignment.cb`
- `make test`

すべてのテストが成功し、Union メンバーが複合代入後も正しい値を保持することを確認しました。

---

## 📌 影響範囲
- 構造体に Union 型メンバーを含み、値を複合代入で更新するすべてのプログラム
- 構造体を関数境界を越えて受け渡し、戻り値を再代入するシナリオ

他の型（配列、多次元配列、interface など）への影響は確認されていません。

---

**Cb言語開発チーム**  
2025年10月2日
