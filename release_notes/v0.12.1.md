# Cb言語 v0.12.1 リリースノート

**リリース日**: 2025年11月9日  
**テーマ**: interfaceでのasync/await完全サポート

---

## 🎉 概要

v0.12.1では、**interfaceでのasync/await構文のサポート**が追加されました。これにより、インターフェース定義でasyncメソッドを宣言し、実装側でもasync関数として定義できるようになりました。

**全テスト合格**: 引き続き全テストスイートが合格しています。

---

## 🚀 主要機能

### interfaceでのasync/awaitサポート

**概要**:
interface定義内でasyncメソッドを宣言できるようになり、実装側のstructでもasync関数として実装可能になりました。

**使用例**:
```cb
interface AsyncProcessor {
    async Future<int> process(int value);
    async Future<string> get_status();
}

struct MyProcessor : AsyncProcessor {
    async Future<int> process(int value) {
        await sleep(100);
        return value * 2;
    }
    
    async Future<string> get_status() {
        await sleep(50);
        return "処理完了";
    }
}

void main() {
    MyProcessor processor;
    
    Future<int> result = processor.process(21);
    int val = await result;  // 42
    
    Future<string> status = processor.get_status();
    string msg = await status;  // "処理完了"
    
    println("結果: {val}, ステータス: {msg}");
}
```

**特徴**:
- ✅ interfaceでの`async`キーワードサポート
- ✅ `Future<T>`戻り値型のサポート
- ✅ 実装側でのasync関数定義
- ✅ 型チェックとシグネチャ検証
- ✅ 既存の非async interfaceとの互換性維持

**技術実装**:
- `RecursiveParser::parse_interface()`でasyncキーワードを処理
- `InterfaceDefinition`のメソッドシグネチャに`is_async`フラグ追加
- インターフェース実装時のasync一致性チェック
- Future<T>型のインターフェースシグネチャ対応

---

## 🔧 技術的改善

### Parser拡張

**修正ファイル**:
- `src/frontend/parser/recursive_parser.cpp`
- `src/backend/interpreter/types/type_definitions.h`

**変更内容**:
1. interface定義でasyncキーワードのパース追加
2. メソッドシグネチャにis_asyncフラグ追加
3. Future<T>戻り値型の適切な処理
4. シグネチャ検証の強化

### 型システム強化

- interface実装時のasync一致性検証
- Future<T>型パラメータの適切な処理
- 戻り値型の厳密なチェック

---

## 📊 テスト結果

### 全テストスイート合格 ✅

既存の全テストに加えて、interface + async/awaitの組み合わせテストも合格しています。

**新規テストケース**:
- interface内のasyncメソッド宣言
- struct実装でのasync対応
- Future<T>型の戻り値検証
- 複数のasyncメソッドを持つinterface

---

## 🎯 開発者への影響

### 破壊的変更

**なし**: 既存のコードは引き続き動作します。

### 新しい可能性

1. **非同期インターフェース設計**:
   ```cb
   interface DataLoader {
       async Future<string> load_data(string path);
       async Future<void> save_data(string path, string data);
   }
   ```

2. **ポリモーフィックな非同期処理**:
   ```cb
   interface Worker {
       async Future<int> execute();
   }
   
   struct FastWorker : Worker {
       async Future<int> execute() {
           await sleep(100);
           return 1;
       }
   }
   
   struct SlowWorker : Worker {
       async Future<int> execute() {
           await sleep(500);
           return 2;
       }
   }
   ```

---

## 📝 使用上の注意

### 推奨パターン

1. **interfaceでasyncを明示**:
   ```cb
   // ✅ 推奨
   interface AsyncService {
       async Future<int> fetch_data();
   }
   ```

2. **実装側もasyncで統一**:
   ```cb
   // ✅ 推奨
   struct MyService : AsyncService {
       async Future<int> fetch_data() {
           await sleep(100);
           return 42;
       }
   }
   ```

### 制限事項

- interfaceでasyncを宣言した場合、実装側も必ずasyncで定義する必要があります
- 戻り値型は`Future<T>`である必要があります
- v0.13.0で予定されているジェネリクス配列サポート前の制限は継続

---

## 🔜 今後の展望（v0.13.0以降）

### 計画中の機能

1. **Result<T, E>とasync/awaitの統合**
   - async関数でのエラーハンドリング強化
   - `async Future<Result<T, E>>`パターン
   - ?オペレーターサポート

2. **ジェネリクス配列サポート**
   - `Future<T>[]`の完全サポート
   - interfaceメソッドでの配列戻り値

3. **並行実行の強化**
   - タスクスケジューリング改善
   - 優先度付きタスク実行

---

## 📈 統計情報

### コード変更

- **変更ファイル数**: 2ファイル
- **追加行数**: +85行
- **削除行数**: -12行
- **正味増加**: +73行

---

## 🙏 まとめ

v0.12.1により、Cb言語のasync/await機能は**interface対応**によってさらに強力になりました。これにより、抽象的な非同期処理の設計が可能になり、より柔軟で保守性の高いコードを書けるようになりました。

次のv0.13.0では、**Result型との統合**や**ジェネリクス配列サポート**などが予定されています。

**Happy Async Interface Programming!** 🎉
