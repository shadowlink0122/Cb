# Cbè¨€èª v0.7.1 ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ

## ğŸ‰ ãƒ¡ã‚¸ãƒ£ãƒ¼æ©Ÿèƒ½è¿½åŠ : å¤šæ¬¡å…ƒé…åˆ—æˆ»ã‚Šå€¤å‡¦ç†ã®å®Œå…¨å¯¾å¿œ

**ãƒªãƒªãƒ¼ã‚¹æ—¥**: 2025å¹´9æœˆ29æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.7.1  
**ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 100% (1116/1116 ãƒ†ã‚¹ãƒˆæˆåŠŸ)

---

## âœ¨ ä¸»ãªæ–°æ©Ÿèƒ½

### ğŸ”§ å¤šæ¬¡å…ƒé…åˆ—æˆ»ã‚Šå€¤å‡¦ç†ã®å®Œå…¨å®Ÿè£…

typedefé…åˆ—é–¢æ•°ã‹ã‚‰ã®å¤šæ¬¡å…ƒé…åˆ—æˆ»ã‚Šå€¤ãŒå®Œå…¨ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

#### ä¿®æ­£å‰ã®å•é¡Œ
```cb
typedef Matrix2D = int[2][2];

Matrix2D create_matrix() {
    Matrix2D result;
    result[0][0] = 1; result[0][1] = 2;
    result[1][0] = 3; result[1][1] = 4;
    return result;
}

int main() {
    Matrix2D matrix = create_matrix();
    // ä¿®æ­£å‰: ä»¥ä¸‹ã§å¢ƒç•Œã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
    printf("Row 1: [%d, %d]", matrix[1][0], matrix[1][1]);
    //     ^^^^^^^^^^^^^^^^
    //     Error: Array index out of bounds: flat_index=2
    return 0;
}
```

#### ä¿®æ­£å¾Œã®å‹•ä½œ
```cb
typedef Matrix2D = int[2][2];

Matrix2D create_matrix() {
    Matrix2D result;
    result[0][0] = 1; result[0][1] = 2;
    result[1][0] = 3; result[1][1] = 4;
    return result;
}

int main() {
    Matrix2D matrix = create_matrix();
    printf("Matrix (2x2):\n");
    printf("Row 0: [%d, %d]\n", matrix[0][0], matrix[0][1]);
    printf("Row 1: [%d, %d]\n", matrix[1][0], matrix[1][1]);
    
    // å‡ºåŠ›:
    // Matrix (2x2):
    // Row 0: [1, 2]
    // Row 1: [3, 4]  â† ä¿®æ­£ã«ã‚ˆã‚Šæ­£å¸¸å‹•ä½œ
    
    return 0;
}
```

---

## ğŸ”§ æŠ€è¡“çš„æ”¹å–„

### 1. Variable Manageræ”¹å–„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/backend/interpreter/managers/variable_manager.cpp`

**å•é¡Œ**: é…åˆ—æˆ»ã‚Šå€¤å‡¦ç†ã§`ret.int_array_3d[0][0]`ã¨ã—ã¦1æ¬¡å…ƒé…åˆ—ã®ã¿ã‚’å‡¦ç†
```cpp
// ä¿®æ­£å‰
if (!ret.int_array_3d.empty() && !ret.int_array_3d[0].empty() && 
    !ret.int_array_3d[0][0].empty()) {
    var.array_values = ret.int_array_3d[0][0];  // 1æ¬¡å…ƒã®ã¿
    var.array_size = var.array_values.size();
}
```

**è§£æ±º**: å¤šæ¬¡å…ƒé…åˆ—ã®å…¨è¦ç´ ã‚’å±•é–‹ã—ã¦`multidim_array_values`ã«è¨­å®š
```cpp
// ä¿®æ­£å¾Œ
std::string actual_type = interpreter_->type_manager_->resolve_typedef(ret.array_type_name);
bool is_multidim = (actual_type.find("[][]") != std::string::npos || 
                   ret.array_type_name.find("[][]") != std::string::npos ||
                   ret.int_array_3d.size() > 1 || 
                   (ret.int_array_3d.size() == 1 && ret.int_array_3d[0].size() > 1));

if (is_multidim) {
    // å¤šæ¬¡å…ƒé…åˆ—ã®å ´åˆ - å…¨è¦ç´ ã‚’å±•é–‹
    var.multidim_array_values.clear();
    for (const auto &plane : ret.int_array_3d) {
        for (const auto &row : plane) {
            for (const auto &element : row) {
                var.multidim_array_values.push_back(element);
            }
        }
    }
    var.array_size = var.multidim_array_values.size();
    var.is_multidimensional = true;
    
    // é…åˆ—ã®æ¬¡å…ƒæƒ…å ±ã‚’è¨­å®š
    if (!ret.int_array_3d[0].empty()) {
        var.array_dimensions.clear();
        var.array_dimensions.push_back(ret.int_array_3d[0].size());     // è¡Œæ•°
        var.array_dimensions.push_back(ret.int_array_3d[0][0].size()); // åˆ—æ•°
    }
}
```

### 2. Statement Executorå¼·åŒ–
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/backend/interpreter/executor/statement_executor.cpp`

**è¿½åŠ æ©Ÿèƒ½**: ReturnExceptionå‡¦ç†ã§å¤šæ¬¡å…ƒé…åˆ—åˆ¤å®šãƒ»æ¬¡å…ƒæƒ…å ±è¨­å®šã‚’å®Ÿè£…
```cpp
// å¤šæ¬¡å…ƒé…åˆ—ã‹ã©ã†ã‹ã‚’åˆ¤å®šï¼ˆtypedefé…åˆ—åã«[][]ãŒå«ã¾ã‚Œã‚‹å ´åˆï¼‰
bool is_multidim = (ret.array_type_name.find("[][]") != std::string::npos);
if (is_multidim) {
    // å¤šæ¬¡å…ƒé…åˆ—ã®å ´åˆã¯å…¨è¦ç´ ã‚’å±•é–‹ã—ã¦multidim_array_valuesã«è¨­å®š
    target_var.multidim_array_values.clear();
    for (const auto &plane : ret.int_array_3d) {
        for (const auto &row : plane) {
            for (const auto &element : row) {
                target_var.multidim_array_values.push_back(element);
            }
        }
    }
    // é…åˆ—ã®æ¬¡å…ƒæƒ…å ±ã‚‚è¨­å®šï¼ˆ2Dé…åˆ—ã®å ´åˆï¼‰
    target_var.is_multidimensional = true;
    target_var.array_size = target_var.multidim_array_values.size();
    target_var.array_values.clear(); // 1æ¬¡å…ƒé…åˆ—ã¯ã‚¯ãƒªã‚¢
    
    // 2æ¬¡å…ƒé…åˆ—ã®æ¬¡å…ƒæƒ…å ±ã‚’è¨­å®š
    if (!ret.int_array_3d.empty() && !ret.int_array_3d[0].empty()) {
        target_var.array_dimensions.clear();
        target_var.array_dimensions.push_back(ret.int_array_3d[0].size());     // è¡Œæ•°
        target_var.array_dimensions.push_back(ret.int_array_3d[0][0].size()); // åˆ—æ•°
    }
}
```

### 3. Array Managerå¢ƒç•Œãƒã‚§ãƒƒã‚¯æ”¹å–„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/backend/interpreter/managers/array_manager.cpp`

**å•é¡Œ**: ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ãŒæ¨™æº–ã‚¨ãƒ©ãƒ¼ã«å‡ºåŠ›ã•ã‚Œã¦ã„ãŸ
**è§£æ±º**: æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒãƒƒã‚°ã‚·ã‚¹ãƒ†ãƒ ã«ç§»è¡Œã€å¢ƒç•Œãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç°¡ç´ åŒ–

---

## ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ

### ãƒ†ã‚¹ãƒˆçµ±è¨ˆ
- **ç·ãƒ†ã‚¹ãƒˆæ•°**: 1116ãƒ†ã‚¹ãƒˆï¼ˆçµ±åˆ: 1116, å˜ä½“: 26ï¼‰
- **æˆåŠŸç‡**: 100% (1116/1116 ãƒ†ã‚¹ãƒˆæˆåŠŸ)
- **æ–°è¦ãƒ†ã‚¹ãƒˆ**: Function Type Check Testsï¼ˆè¤‡é›‘ãªtypedefé…åˆ—é–¢æ•°ï¼‰
- **ä¿®æ­£ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª**:
  - âœ… Array Return Tests: æ–‡å­—åˆ—é…åˆ—æˆ»ã‚Šå€¤
  - âœ… Printf Tests: ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  - âœ… Global/Static Variable Tests: TEMP_DEBUG_VARå‡ºåŠ›é™¤å»
  - âœ… **Function Type Check Tests**: typedefå¤šæ¬¡å…ƒé…åˆ—æˆ»ã‚Šå€¤ï¼ˆä»Šå›ã®ä¸»è¦ä¿®æ­£ï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
```
=== Test Summary ===
Total:  1116
Passed: 1116
Failed: 0

ğŸ‰ ALL TESTS PASSED! ğŸ‰

============================================================
=== Timing Summary ===
Tests with timing: 39
Total time: 563.97 ms
Average time: 14.46 ms
Min time: 7.38 ms
Max time: 198.53 ms
```

---

## ğŸ” æŠ€è¡“çš„è©³ç´°

### å¤šæ¬¡å…ƒé…åˆ—æˆ»ã‚Šå€¤å‡¦ç†ãƒ•ãƒ­ãƒ¼
1. **é–¢æ•°å®Ÿè¡Œ**: `create_matrix()`ç­‰ã®typedefé…åˆ—é–¢æ•°ã‚’å®Ÿè¡Œ
2. **ReturnExceptionç”Ÿæˆ**: `int_array_3d`ã«å¤šæ¬¡å…ƒé…åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
3. **Variable Managerå‡¦ç†**: 
   - typedefåè§£æ±ºã«ã‚ˆã‚‹å¤šæ¬¡å…ƒé…åˆ—åˆ¤å®š
   - `int_array_3d`æ§‹é€ ã‹ã‚‰ã®å¤šæ¬¡å…ƒåˆ¤å®š
   - å…¨è¦ç´ ã‚’`multidim_array_values`ã«å±•é–‹
   - `array_dimensions`ã«æ¬¡å…ƒæƒ…å ±è¨­å®š
4. **Array Manager**: å¢ƒç•Œãƒã‚§ãƒƒã‚¯æ™‚ã«`multidim_array_values`ã‚’ä½¿ç”¨
5. **OutputManager**: printfç­‰ã§ã®å¤šæ¬¡å…ƒé…åˆ—è¦ç´ ã‚¢ã‚¯ã‚»ã‚¹

### å¯¾å¿œã™ã‚‹å‹å®šç¾©ãƒ‘ã‚¿ãƒ¼ãƒ³
```cb
// ã™ã¹ã¦æ­£å¸¸ã«å‡¦ç†ã•ã‚Œã‚‹
typedef Matrix2D = int[2][2];           // 2æ¬¡å…ƒé…åˆ—
typedef Matrix3D = int[2][2][2];        // 3æ¬¡å…ƒé…åˆ—
typedef StringMatrix = string[3][4];    // æ–‡å­—åˆ—2æ¬¡å…ƒé…åˆ—
typedef LargeMatrix = int[10][20];      // å¤§ããª2æ¬¡å…ƒé…åˆ—
```

---

## ğŸš§ äº’æ›æ€§æƒ…å ±

### ä¸‹ä½äº’æ›æ€§
- **å®Œå…¨ä¸‹ä½äº’æ›**: æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ä¸è¦
- **å½±éŸ¿ãªã—**: 1æ¬¡å…ƒé…åˆ—ã€åŸºæœ¬å‹ã€Unionå‹ç­‰ã®æ—¢å­˜æ©Ÿèƒ½

### æ–°æ©Ÿèƒ½ã®æ©æµã‚’å—ã‘ã‚‹ã‚³ãƒ¼ãƒ‰
```cb
// ã“ã‚Œã‚‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä¿®æ­£ã®æ©æµã‚’å—ã‘ã‚‹
typedef Matrix2D = int[2][2];
Matrix2D create_matrix() { /* ... */ }
int main() {
    Matrix2D m = create_matrix();  // ä¿®æ­£å‰: å¢ƒç•Œã‚¨ãƒ©ãƒ¼ â†’ ä¿®æ­£å¾Œ: æ­£å¸¸å‹•ä½œ
    printf("%d", m[1][1]);         // ä¿®æ­£å‰: ã‚¨ãƒ©ãƒ¼ â†’ ä¿®æ­£å¾Œ: æ­£å¸¸å‹•ä½œ
}
```

---

## ğŸ“š å®Ÿè£…äº‹ä¾‹

### è¡Œåˆ—æ¼”ç®—ã‚·ã‚¹ãƒ†ãƒ 
```cb
typedef Matrix3x3 = int[3][3];

Matrix3x3 create_identity() {
    Matrix3x3 result;
    for (int i = 0; i < 3; i++) {
        for (int j = 0; j < 3; j++) {
            result[i][j] = (i == j) ? 1 : 0;
        }
    }
    return result;
}

Matrix3x3 matrix_multiply(Matrix3x3 a, Matrix3x3 b) {
    Matrix3x3 result;
    for (int i = 0; i < 3; i++) {
        for (int j = 0; j < 3; j++) {
            result[i][j] = 0;
            for (int k = 0; k < 3; k++) {
                result[i][j] += a[i][k] * b[k][j];
            }
        }
    }
    return result;
}

int main() {
    Matrix3x3 identity = create_identity();
    Matrix3x3 matrix = {{1, 2, 3}, {4, 5, 6}, {7, 8, 9}};
    Matrix3x3 result = matrix_multiply(matrix, identity);
    
    // ã™ã¹ã¦æ­£å¸¸ã«å‹•ä½œï¼ˆä¿®æ­£å‰ã¯ã“ã“ã§å¢ƒç•Œã‚¨ãƒ©ãƒ¼ï¼‰
    for (int i = 0; i < 3; i++) {
        for (int j = 0; j < 3; j++) {
            printf("%d ", result[i][j]);
        }
        println("");
    }
    
    return 0;
}
```

---

## ğŸ”® æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®äºˆå®š

### v0.8.0 äºˆå®šæ©Ÿèƒ½
- **æµ®å‹•å°æ•°ç‚¹æ•°å‹**: `float`, `double`ã®ã‚µãƒãƒ¼ãƒˆ
- **enumæ©Ÿèƒ½æ‹¡å¼µ**: Unionå‹ã¨ã®å®Œå…¨çµ±åˆ
- **æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ‹¡å……**: `math.cb`, `string.cb`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- **å‹•çš„é…åˆ—**: å¯å¤‰é•·é…åˆ—ã®åŸºæœ¬å®Ÿè£…

### é•·æœŸè¨ˆç”»
- **interface/trait**: æŠ½è±¡åŒ–æ©Ÿèƒ½
- **ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹**: å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ **: import/exportæ©Ÿèƒ½
- **Resultå‹**: å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

## ğŸ™ è¬è¾

ä»Šå›ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ˆã‚Šã€Cbè¨€èªã®å¤šæ¬¡å…ƒé…åˆ—å‡¦ç†ãŒå¤§å¹…ã«æ”¹å–„ã•ã‚Œã€ã‚ˆã‚Šå®Ÿç”¨çš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚è¡Œåˆ—è¨ˆç®—ã€ç”»åƒå‡¦ç†ã€ç§‘å­¦è¨ˆç®—ç­‰ã®åˆ†é‡ã§ã®æ´»ç”¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚

ç¶™ç¶šçš„ãªæ”¹å–„ã«ã”å”åŠ›ã„ãŸã ã„ã¦ã„ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®çš†æ§˜ã«æ„Ÿè¬ã„ãŸã—ã¾ã™ã€‚

---

**Cbè¨€èªé–‹ç™ºãƒãƒ¼ãƒ **  
2025å¹´9æœˆ29æ—¥
