# Cbè¨€èª v0.7.0 ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ

# Cbè¨€èª v0.7.0 ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ

## ğŸ‰ ãƒ¡ã‚¸ãƒ£ãƒ¼æ©Ÿèƒ½è¿½åŠ : å¤šæ¬¡å…ƒé…åˆ—æˆ»ã‚Šå€¤å‡¦ç†ã®å®Œå…¨å¯¾å¿œ

**ãƒªãƒªãƒ¼ã‚¹æ—¥**: 2025å¹´9æœˆ29æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.7.0  
**ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 100% (1116/1116 ãƒ†ã‚¹ãƒˆæˆåŠŸ)

---

## âœ¨ ä¸»ãªæ–°æ©Ÿèƒ½

### ğŸ”§ å¤šæ¬¡å…ƒé…åˆ—æˆ»ã‚Šå€¤å‡¦ç†ã®å®Œå…¨å®Ÿè£…

typedefé…åˆ—é–¢æ•°ã‹ã‚‰ã®å¤šæ¬¡å…ƒé…åˆ—æˆ»ã‚Šå€¤ãŒå®Œå…¨ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

#### ä¿®æ­£å‰ã®å•é¡Œ
```cb
typedef Matrix2D = int[2][2];

Matrix2D create_matrix() {
    Matrix2D result;
    result[0][0] = 1; result[0][1] = 2;
    result[1][0] = 3; result[1][1] = 4;
    return result;
}

int main() {
    Matrix2D matrix = create_matrix();
    // ä¿®æ­£å‰: ä»¥ä¸‹ã§å¢ƒç•Œã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
    printf("Row 1: [%d, %d]", matrix[1][0], matrix[1][1]);
    //     ^^^^^^^^^^^^^^^^
    //     Error: Array index out of bounds: flat_index=2
    return 0;
}
```

#### ä¿®æ­£å¾Œã®å‹•ä½œ
```cb
typedef Matrix2D = int[2][2];

Matrix2D create_matrix() {
    Matrix2D result;
    result[0][0] = 1; result[0][1] = 2;
    result[1][0] = 3; result[1][1] = 4;
    return result;
}

int main() {
    Matrix2D matrix = create_matrix();
    printf("Matrix (2x2):\n");
    printf("Row 0: [%d, %d]\n", matrix[0][0], matrix[0][1]);
    printf("Row 1: [%d, %d]\n", matrix[1][0], matrix[1][1]);
    
    // å‡ºåŠ›:
    // Matrix (2x2):
    // Row 0: [1, 2]
    // Row 1: [3, 4]  â† ä¿®æ­£ã«ã‚ˆã‚Šæ­£å¸¸å‹•ä½œ
    
    return 0;
}
```

---

## ğŸ”§ æŠ€è¡“çš„æ”¹å–„

### 1. Variable Manageræ”¹å–„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/backend/interpreter/managers/variable_manager.cpp`

**å•é¡Œ**: é…åˆ—æˆ»ã‚Šå€¤å‡¦ç†ã§`ret.int_array_3d[0][0]`ã¨ã—ã¦1æ¬¡å…ƒé…åˆ—ã®ã¿ã‚’å‡¦ç†
```cpp
// ä¿®æ­£å‰
if (!ret.int_array_3d.empty() && !ret.int_array_3d[0].empty() && 
    !ret.int_array_3d[0][0].empty()) {
    var.array_values = ret.int_array_3d[0][0];  // 1æ¬¡å…ƒã®ã¿
    var.array_size = var.array_values.size();
}
```

**è§£æ±º**: å¤šæ¬¡å…ƒé…åˆ—ã®å…¨è¦ç´ ã‚’å±•é–‹ã—ã¦`multidim_array_values`ã«è¨­å®š
```cpp
// ä¿®æ­£å¾Œ
std::string actual_type = interpreter_->type_manager_->resolve_typedef(ret.array_type_name);
bool is_multidim = (actual_type.find("[][]") != std::string::npos || 
                   ret.array_type_name.find("[][]") != std::string::npos ||
                   ret.int_array_3d.size() > 1 || 
                   (ret.int_array_3d.size() == 1 && ret.int_array_3d[0].size() > 1));

if (is_multidim) {
    // å¤šæ¬¡å…ƒé…åˆ—ã®å ´åˆ - å…¨è¦ç´ ã‚’å±•é–‹
    var.multidim_array_values.clear();
    for (const auto &plane : ret.int_array_3d) {
        for (const auto &row : plane) {
            for (const auto &element : row) {
                var.multidim_array_values.push_back(element);
            }
        }
    }
    var.array_size = var.multidim_array_values.size();
    var.is_multidimensional = true;
    
    // é…åˆ—ã®æ¬¡å…ƒæƒ…å ±ã‚’è¨­å®š
    if (!ret.int_array_3d[0].empty()) {
        var.array_dimensions.clear();
        var.array_dimensions.push_back(ret.int_array_3d[0].size());     // è¡Œæ•°
        var.array_dimensions.push_back(ret.int_array_3d[0][0].size()); // åˆ—æ•°
    }
}
```

### 2. Statement Executorå¼·åŒ–
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/backend/interpreter/executor/statement_executor.cpp`

**è¿½åŠ æ©Ÿèƒ½**: ReturnExceptionå‡¦ç†ã§å¤šæ¬¡å…ƒé…åˆ—åˆ¤å®šãƒ»æ¬¡å…ƒæƒ…å ±è¨­å®šã‚’å®Ÿè£…
```
å¹³å‡ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“: 13.77ms
æœ€é€Ÿãƒ†ã‚¹ãƒˆ: 7.20ms
ãƒ†ã‚¹ãƒˆæˆåŠŸç‡: 100%
ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸: Unionå‹æ©Ÿèƒ½å®Œå…¨ã‚«ãƒãƒ¼
```

## ğŸ¯ å…·ä½“çš„ãªå®Ÿè£…ä¾‹

### ãƒªãƒ†ãƒ©ãƒ«å€¤Union
```cb
typedef HttpStatus = 200 | 404 | 500;
typedef Direction = "up" | "down" | "left" | "right";

int main() {
    HttpStatus status = 200;  // OK
    Direction dir = "up";     // OK
    
    // HttpStatus invalid = 301; // ã‚¨ãƒ©ãƒ¼: è¨±å¯ã•ã‚Œã¦ã„ãªã„å€¤
    return 0;
}
```

### ã‚«ã‚¹ã‚¿ãƒ å‹Union with å†å¸°çš„typedef
```cb
typedef UserID = int;
typedef ProductID = string;
typedef ID = UserID | ProductID;

int main() {
    UserID uid = 12345;
    ID general_id = uid;  // OK: UserID â†’ ID ã¯äº’æ›æ€§ã‚ã‚Š
    
    return 0;
}
```

### æ§‹é€ ä½“Union
```cb
struct User { int id; string name; }
struct Product { string code; int price; }
typedef Entity = User | Product;

int main() {
    User alice = {id: 1, name: "Alice"};
    Entity entity = alice;  // OK: User â†’ Entity
    
    return 0;
}
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¾‹
```cb
typedef RestrictedUnion = int | string;

int main() {
    RestrictedUnion valid1 = 42;        // OK
    RestrictedUnion valid2 = "hello";   // OK
    
    bool flag = true;
    // RestrictedUnion invalid = flag;  // å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼: boolå‹ã¯è¨±å¯ã•ã‚Œã¦ã„ãªã„
    
    return 0;
}
```

## ğŸ› ãƒã‚°ä¿®æ­£

### å‹ã‚·ã‚¹ãƒ†ãƒ ã®ä¿®æ­£
- **å†å¸°çš„typedefè§£æ±º**: ç„¡é™ãƒ«ãƒ¼ãƒ—å›é¿ã¨ç¶™æ‰¿ãƒã‚§ãƒ¼ãƒ³å¯¾å¿œ
- **æ··åˆUnionæ¤œè¨¼**: ãƒªãƒ†ãƒ©ãƒ«å€¤ã¨å‹ã®æ­£ç¢ºãªåŒºåˆ¥
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ã‚ˆã‚Šå…·ä½“çš„ã§åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### ãƒ‘ãƒ¼ã‚µãƒ¼ã®æ”¹å–„
- **Union typedefæ§‹æ–‡**: å®Œå…¨ãªBNFå¯¾å¿œ
- **ASTç”Ÿæˆ**: Unionå‹å°‚ç”¨ãƒãƒ¼ãƒ‰è¿½åŠ 
- **æ§‹æ–‡ã‚¨ãƒ©ãƒ¼**: ä¸æ­£ãªUnionæ§‹æ–‡ã®é©åˆ‡ãªæ¤œå‡º

## ğŸ”„ äº’æ›æ€§

### å¾Œæ–¹äº’æ›æ€§ âœ…
- **æ—¢å­˜ã‚³ãƒ¼ãƒ‰**: v0.6.0ä»¥å‰ã®ã‚³ãƒ¼ãƒ‰ã¯å®Œå…¨ã«äº’æ›æ€§ç¶­æŒ
- **æ§‹é€ ä½“**: æ—¢å­˜ã®æ§‹é€ ä½“ã‚·ã‚¹ãƒ†ãƒ ã¯å¤‰æ›´ãªã—
- **åŸºæœ¬å‹**: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã®å‹•ä½œã¯å¤‰æ›´ãªã—

### æ–°æ©Ÿèƒ½ã®å½±éŸ¿
- **æ–°æ§‹æ–‡**: Union typedef ã¯æ–°æ©Ÿèƒ½ã®ãŸã‚æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ãªã—
- **ã‚¨ãƒ©ãƒ¼æ¤œè¨¼**: ã‚ˆã‚Šå³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚Šå®‰å…¨æ€§å‘ä¸Š
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å‹æ¤œè¨¼ã®æœ€é©åŒ–ã«ã‚ˆã‚Šé€Ÿåº¦å‘ä¸Š

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

### æ›´æ–°ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **README.md**: Unionå‹ã‚·ã‚¹ãƒ†ãƒ ã®èª¬æ˜ã¨ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ 
- **docs/spec.md**: è©³ç´°ãªä»•æ§˜ã¨BNFè¨˜æ³•è¿½åŠ 
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: 157å€‹ã®æ–°è¦ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ 

### æ–°è¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **Unionå‹ã‚¬ã‚¤ãƒ‰**: TypeScripté–‹ç™ºè€…å‘ã‘ç§»è¡Œã‚¬ã‚¤ãƒ‰
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: 13ç¨®é¡ã®ç•°å¸¸ç³»å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«

## ğŸš€ æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³äºˆå®š (v0.8.0)

### è¨ˆç”»ä¸­ã®æ©Ÿèƒ½
- **enumå‹ã®å®Œå…¨å®Ÿè£…**: Unionå‹ã¨ã®é€£æºå¼·åŒ–
- **interface/trait**: æŠ½è±¡åŒ–ã‚·ã‚¹ãƒ†ãƒ 
- **ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹**: å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–æ©Ÿèƒ½
- **Resultå‹**: å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æœ€é©åŒ–**: Unionå‹ã®é™çš„è§£æ±º
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸›**: å‹æƒ…å ±ã®åŠ¹ç‡çš„ãªæ ¼ç´
- **ä¸¦åˆ—å‹ãƒã‚§ãƒƒã‚¯**: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‹æ¤œè¨¼

## ğŸ™ è¬è¾

v0.7.0ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ãŸã‚Šã€TypeScripté¢¨Unionå‹ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨å®Ÿè£…ã‚’é”æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

### æŠ€è¡“çš„æˆæœ
- **925å€‹ã®ãƒ†ã‚¹ãƒˆ**: 100%æˆåŠŸç‡é”æˆ
- **å‹å®‰å…¨æ€§**: å®Ÿè¡Œæ™‚å‹ã‚¨ãƒ©ãƒ¼ã®å®Œå…¨ãªæ¤œå‡º
- **é–‹ç™ºè€…ä½“é¨“**: ç›´æ„Ÿçš„ãªUnionå‹æ§‹æ–‡ã®æä¾›

ã“ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€Cbè¨€èªã¯ã‚ˆã‚Šè¡¨ç¾åŠ›è±Šã‹ã§å®‰å…¨ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¨ã—ã¦å¤§ããå‰é€²ã—ã¾ã—ãŸã€‚

---

## ğŸ“– è©³ç´°æƒ…å ±

- **GitHub**: https://github.com/shadowlink0122/Cb
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [docs/spec.md](../docs/spec.md)
- **ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰**: [sample/](../sample/)
- **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**: [tests/cases/union/](../tests/cases/union/)

**Happy Coding with Union Types! ğŸ‰**
