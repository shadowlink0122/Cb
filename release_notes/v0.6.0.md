# Cb言語 v0.6.0 リリースノート

## 🎉 新機能: 構造体（Struct）システム完全実装

### ✨ 新しく実装された機能

#### 構造体（Struct）システム
- **構造体定義**: 複数の異なるデータ型をまとめて管理
- **メンバーアクセス**: ドット記法による構造体メンバーへのアクセス
- **構造体リテラル**: 初期化時の値設定をサポート
- **配列メンバー**: 構造体内での配列メンバーの定義と操作
- **多次元配列メンバー**: 2次元以上の配列も構造体メンバーとして対応

#### 高度な構造体機能
- **構造体配列**: 構造体の配列定義と操作
- **ネストした構造体**: 構造体内に他の構造体を含める
- **構造体リテラル配列**: 配列形式での構造体初期化
- **フラット構造体**: 複雑なネスト構造の簡潔な表現

### 📊 テスト結果
- **統合テスト**: 634/634 合格 ✅
- **単体テスト**: 26/26 合格 ✅
- **構造体テスト**: 30/30 合格 ✅

### 💡 使用例

```cb
// 基本的な構造体定義
struct Person {
    string name;
    int age;
    bool is_student;
}

// 構造体配列メンバー
struct Team {
    string team_name;
    int[5] scores;
    Person[3] members;
}

int main() {
    // 構造体リテラル初期化
    Person student = {
        .name = "田中太郎",
        .age = 20,
        .is_student = true
    };
    
    // メンバーアクセス
    print("名前: %s", student.name);
    print("年齢: %d", student.age);
    
    // 構造体配列
    Person[2] group = [
        {.name = "佐藤花子", .age = 22, .is_student = false},
        {.name = "鈴木一郎", .age = 19, .is_student = true}
    ];
    
    // 配列メンバーの操作
    Team my_team = {
        .team_name = "開発チーム",
        .scores = [85, 92, 78, 88, 91],
        .members = group
    };
    
    // 構造体メンバーの配列アクセス
    my_team.scores[0] = 95;
    print("チーム名: %s", my_team.team_name);
    print("最初のスコア: %d", my_team.scores[0]);
    
    return 0;
}
```

### 🔧 技術的な改善

#### アーキテクチャの大幅改善
- **DRY原則の徹底実装**: 重複コードの系統的削除
- **統一サービス層**: ArrayProcessingService, ExpressionService, DebugService
- **マネージャー統合**: 新バージョンマネージャーへの完全移行
- **デバッグシステム**: 統一されたカテゴリ別デバッグ出力

#### 構造体専用機能
- **StructManager**: 構造体定義と操作の一元管理
- **構造体AST**: 新しいASTノードタイプでの構造体サポート
- **型チェック**: 構造体メンバーの型安全性確保
- **メモリ管理**: 効率的な構造体メモリ割り当て

### 🛠️ バグ修正
- **DEBUGマクロ衝突**: コンパイラフラグとの衝突を解決
- **配列要素アクセス**: 重複コードの除去と統一
- **式評価**: ExpressionServiceへの統合によるバグ修正
- **デバッグ出力**: 混在していた出力方式の統一

### 🚀 パフォーマンス向上
- **重複処理削除**: Priority 1-3の配列処理重複除去
- **統一評価エンジン**: 式評価の効率化
- **メモリ最適化**: 構造体操作のメモリ使用量削減

### 📈 開発者体験の向上
- **統一デバッグ**: カテゴリ別のデバッグレベル制御
- **エラーハンドリング**: より明確なエラーメッセージ
- **テスト拡充**: 包括的なテストスイート

### 🧪 テスト範囲
- **基本構造体**: 定義、アクセス、初期化
- **構造体配列**: 配列としての構造体操作
- **ネスト構造体**: 複雑な構造体の階層
- **配列メンバー**: 構造体内配列の操作
- **多次元配列メンバー**: 2次元以上の配列サポート
- **リテラル初期化**: 様々な初期化パターン
- **エラーケース**: 型不整合などのエラー処理

### 🚧 今後の予定
- **構造体関数パラメータ**: 関数引数としての構造体（計画中）
- **構造体戻り値**: 関数戻り値としての構造体（計画中）
- **構造体継承**: より高度なオブジェクト指向機能（検討中）

---

## 📋 変更ログ

### Added
- 構造体システムの完全実装
- 統一サービス層アーキテクチャ
- DRY原則に基づく重複コード除去
- カテゴリ別デバッグシステム

### Changed
- 配列処理の統一（ArrayProcessingService）
- 式評価の統一（ExpressionService）
- マネージャーヘッダー構造の更新
- デバッグ出力システムの統一

### Fixed
- DEBUGマクロとコンパイラフラグの衝突
- 配列要素アクセスの重複処理
- 式評価における分散した処理
- 混在していたデバッグ出力方式

### Technical
- 634個の統合テスト全て合格維持
- 26個のユニットテスト全て合格維持
- デバッグビルドの完全対応
- クリーンアーキテクチャの実現

---
**Cb言語**: より構造化され、保守性の高いプログラミング言語を目指して
