// Vector<æ§‹é€ ä½“>ã®ãƒ†ã‚¹ãƒˆ
import stdlib.std.vector;

struct Point {
    int x;
    int y;
};

int main() {
    println("=== Vector<Point> Test ===");
    
    // å•é¡Œ: Vector<Point>ã®å®Ÿè£…ãŒã¾ã å­˜åœ¨ã—ãªã„
    // ã¾ãšã¯ã€ãƒã‚¤ãƒ³ã‚¿ãƒ™ãƒ¼ã‚¹ã§å®Ÿè£…ã‚’è©¦ã¿ã‚‹
    
    println("Creating points//.");
    
    // ãƒã‚¤ãƒ³ãƒˆ1
    Point p1;
    p1.x = 10;
    p1.y = 20;
    
    // ãƒã‚¤ãƒ³ãƒˆ2
    Point p2;
    p2.x = 30;
    p2.y = 40;
    
    // ãƒã‚¤ãƒ³ãƒˆ3
    Point p3;
    p3.x = 50;
    p3.y = 60;
    
    println("Points created:");
    println("  p1: ({p1.x}, {p1.y})");
    println("  p2: ({p2.x}, {p2.y})");
    println("  p3: ({p3.x}, {p3.y})");
    
    // æ‰‹å‹•ã§ãƒã‚¤ãƒ³ã‚¿é…åˆ—ã‚’ä½¿ç”¨
    println("\n--- Manual pointer array test ---");
    
    int capacity = 4;
    void* point_array = malloc(capacity * 8);  // sizeof(void*)
    int length = 0;
    
    // æ§‹é€ ä½“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
    void* p1_ptr = &p1;
    void* p2_ptr = &p2;
    void* p3_ptr = &p3;
    
    println("  p1 address: {hex(p1_ptr)}");
    println("  p2 address: {hex(p2_ptr)}");
    println("  p3 address: {hex(p3_ptr)}");
    
    // array_set_int ã§ãƒã‚¤ãƒ³ã‚¿ã‚’æ ¼ç´
    array_set_int(point_array, 0, p1_ptr);
    array_set_int(point_array, 1, p2_ptr);
    array_set_int(point_array, 2, p3_ptr);
    length = 3;
    
    println("âœ… Stored 3 point pointers");
    
    // ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰å–å¾—
    println("\nRetrieving p1//.");
    void* retrieved_ptr = array_get_int(point_array, 0);
    println("  Retrieved pointer: {hex(retrieved_ptr)}");
    
    // å‹ã‚­ãƒ£ã‚¹ãƒˆã—ã¦æ§‹é€ ä½“ãƒ¡ãƒ³ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹
    // Note: Cbã§ã¯ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰æ§‹é€ ä½“ã¸ã®ã‚­ãƒ£ã‚¹ãƒˆãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§
    
    println("Attempting to access Point members//.");
    
    // ä»£ã‚ã‚Šã«ã€å…ƒã®å¤‰æ•°ã‚’ç›´æ¥ä½¿ç”¨
    if (p1.x == 10 && p1.y == 20) {
        println("âœ… Original point data intact!");
    } else {
        println("âŒ Original point data corrupted");
        free(point_array);
        return 1;
    }
    
    // å…¨ãƒã‚¤ãƒ³ãƒˆã®ãƒã‚¤ãƒ³ã‚¿ã‚’ç¢ºèª
    println("\nVerifying all stored pointers:");
    int i = 0;
    while (i < length) {
        void* ptr = array_get_int(point_array, i);
        println("  Point {i} pointer: {hex(ptr)}");
        i = i + 1;
    }
    
    free(point_array);
    
    println("\nâœ… Pointer storage and retrieval works!");
    println("ğŸ‰ Vector<struct> with value copy would require:");
    println("  1. array_get_struct.array_set_struct (already implemented)");
    println("  2. Generic impl block for each struct type");
    println("  3. Or: Use pointer-based storage (Vector<Point*>)");
    
    return 0;
}
