// v0.12.1 Phase 2.0: interface/implメソッドでのasync/await
// interfaceとimplの両方でasyncキーワードをサポート

interface Worker {
    async int process_async(int value);
    int process_sync(int value);
}

struct AsyncProcessor {
    int multiplier;
};

impl Worker for AsyncProcessor {
    async int process_async(int value) {
        println("[Impl] Processing async: {value}");
        yield;
        println("[Impl] After yield");
        int result = value * 10;
        println("[Impl] Returning: {result}");
        return result;
    }
    
    int process_sync(int value) {
        println("[Impl] Processing sync: {value}");
        return value + self.multiplier;
    }
}

async void background_task() {
    for (int i = 0; i < 5; i = i + 1) {
        println("[BG] Step {i}");
    }
    return;
}

void main() {
    println("=== Async Interface/Impl Test ===\n");
    
    Future<void> bg = background_task();
    
    AsyncProcessor proc;
    proc.multiplier = 10;
    
    println("[Main] Calling sync method");
    int sync_result = proc.process_sync(3);
    println("[Main] Sync result: {sync_result}");
    
    println("[Main] Calling async method");
    Future<int> f = proc.process_async(5);
    
    println("[Main] Awaiting async result");
    int async_result = await f;
    println("[Main] Async result: {async_result}\n");
    
    await bg;
    println("[Main] Done");
}
