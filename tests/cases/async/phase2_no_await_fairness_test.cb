// Phase 2.0 Test: Fairness without await
// Background tasks should execute fairly even without explicit await

void helper_function(int task_id, int step) {
    println("[Helper T{task_id}] Step {step}");
}

async Future<int> task1() {
    println("[T1] Start");
    
    // Regular statements
    int x = 1;
    println("[T1] Variable x={x}");
    
    // Function call
    helper_function(1, 1);
    
    // If statement
    if (x > 0) {
        println("[T1] If branch executed");
    }
    
    // For loop
    for (int i = 0; i < 3; i++) {
        println("[T1] Loop i={i}");
    }
    
    println("[T1] Done");
    return 100;
}

async Future<int> task2() {
    println("[T2] Start");
    
    // Regular statements
    int y = 2;
    println("[T2] Variable y={y}");
    
    // Function call
    helper_function(2, 1);
    
    // If statement
    if (y > 0) {
        println("[T2] If branch executed");
    }
    
    // For loop
    for (int i = 0; i < 3; i++) {
        println("[T2] Loop i={i}");
    }
    
    println("[T2] Done");
    return 200;
}

void main() {
    println("=== No Await Fairness Test ===");
    
    // Register tasks but DON'T await immediately
    Future<int> f1 = task1();
    Future<int> f2 = task2();
    
    println("[Main] Tasks registered");
    println("[Main] Doing some work...");
    
    // Main does some work
    int sum = 0;
    for (int i = 0; i < 3; i++) {
        println("[Main] Loop i={i}");
        sum = sum + i;
    }
    
    println("[Main] Sum={sum}, now awaiting tasks...");
    
    // Now await the tasks
    int r1 = await f1;
    int r2 = await f2;
    
    println("[Main] Results: T1={r1}, T2={r2}");
}
