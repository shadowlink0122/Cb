// Week 3 Day 1: 構造体配列への代入バグ修正テスト

struct Task {
    int task_id;
    int priority;
    int callback_type;
    void* data;
};

void test_basic_assignment() {
    println("Test 1: Basic struct assignment to array element");
    
    Task[10] tasks;
    Task t = {42, 5, 1, nullptr};
    
    // バグ修正前: これが失敗していた
    tasks[0] = t;
    
    if (tasks[0].task_id == 42) {
        println("✓ tasks[0].task_id == 42");
    } else {
        println("✗ Expected 42, got: ", tasks[0].task_id);
    }
    
    if (tasks[0].priority == 5) {
        println("✓ tasks[0].priority == 5");
    } else {
        println("✗ Expected 5, got: ", tasks[0].priority);
    }
}

void test_literal_assignment() {
    println("\nTest 2: Struct literal assignment to array element");
    
    Task[5] tasks;
    
    // 構造体リテラルの直接代入
    tasks[0] = {100, 10, 2, nullptr};
    
    if (tasks[0].task_id == 100) {
        println("✓ tasks[0].task_id == 100");
    } else {
        println("✗ Expected 100, got: ", tasks[0].task_id);
    }
    
    if (tasks[0].priority == 10) {
        println("✓ tasks[0].priority == 10");
    } else {
        println("✗ Expected 10, got: ", tasks[0].priority);
    }
}

void test_loop_assignment() {
    println("\nTest 3: Loop assignment");
    
    Task[10] tasks;
    
    // ループ内での代入
    for (int i = 0; i < 10; i++) {
        Task t = {i, i * 2, 1, nullptr};
        tasks[i] = t;
    }
    
    // 検証
    int pass = 0;
    for (int i = 0; i < 10; i++) {
        if (tasks[i].task_id == i && tasks[i].priority == i * 2) {
            pass++;
        }
    }
    
    if (pass == 10) {
        println("✓ All 10 elements assigned correctly");
    } else {
        println("✗ Only ", pass, " out of 10 correct");
    }
}

void test_array_to_array_copy() {
    println("\nTest 4: Array element to array element copy");
    
    Task[5] src;
    Task[5] dst;
    
    // ソース配列を初期化
    src[0] = {1, 10, 1, nullptr};
    src[1] = {2, 20, 1, nullptr};
    
    // 配列要素間のコピー
    dst[0] = src[0];
    dst[1] = src[1];
    
    if (dst[0].task_id == 1 && dst[1].task_id == 2) {
        println("✓ Array element copy works");
    } else {
        println("✗ Array element copy failed");
    }
}

Task task_create(int id, int priority) {
    Task t = {id, priority, 1, nullptr};
    return t;
}

void test_function_return() {
    println("\nTest 5: Function return value assignment");
    
    Task[3] tasks;
    
    // 関数戻り値を配列要素に代入
    tasks[0] = task_create(999, 88);
    tasks[1] = task_create(888, 77);
    
    if (tasks[0].task_id == 999 && tasks[0].priority == 88) {
        println("✓ Function return assignment works");
    } else {
        println("✗ Expected 999/88, got: ", tasks[0].task_id, "/", tasks[0].priority);
    }
}

void main() {
    println("=== Struct Array Assignment Bug Fix Tests ===\n");
    
    test_basic_assignment();
    test_literal_assignment();
    test_loop_assignment();
    test_array_to_array_copy();
    test_function_return();
    
    println("\n=== All Tests Complete ===");
}
