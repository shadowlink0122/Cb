# C言語互換性テスト

このディレクトリには、Cb言語のC言語互換性を検証するためのテストケースが含まれています。

## 目的

Cb言語は、C言語のスーパーセットとして設計されており、有効なC言語コード（構文調整後）がCb言語でも正しく動作することを保証します。

## テストケース

### comprehensive.cb

包括的なC言語互換性テストスイート。以下の要素を検証します：

#### セクション1: 基本的なメンバーアクセス
- ドット演算子 (`.`)
- アロー演算子 (`->`)
- ポインタ経由のアクセス

#### セクション2: デリファレンスとメンバーアクセスの組み合わせ
- `(*ptr).member` パターン
- `(*ptr).member.member` パターン
- `(*ptr->member).member` パターン
- `(*ptr->member).member.member` パターン

#### セクション3: アロー演算子のチェーン
- `ptr->member->member` パターン
- 3レベル以上のアローチェーン

#### セクション4: 混合パターン
- `obj.ptr->member` パターン
- `ptr->obj.member` パターン
- `(*ptr).obj.ptr->member` パターン
- `ptr->ptr->obj.member` パターン

#### セクション5: 演算子優先順位
- `->` と `.` の優先順位（同じ、左結合）
- `->` は `*` より優先順位が高い
- 等価な表現の検証

#### セクション6: 実用的なパターン
- リンクリスト風のアクセス
- 複雑なネストした読み取り

## C言語との違い

現在のところ、以下の点でC言語と異なります：

1. **構文**: `struct` 定義の後にセミコロンが必要
2. **構造体リテラル**: 名前付きフィールド初期化 `{x: 1, y: 2}` を使用
3. **代入**: 複雑なネストパターンへの代入は一部未実装

## 演算子優先順位

Cb言語はC言語の演算子優先順位を完全に尊重します：

```
優先順位（高い順）:
1. () [] -> .              (後置演算子)
2. ++ -- + - ! ~ * & sizeof (前置演算子)
3. * / %                   (乗算・除算)
4. + -                     (加算・減算)
...
```

重要な点：
- `->` と `.` は同じ優先順位で、左から右に結合
- `*p->member` は `*(p->member)` として評価される
- `(*p).member` と `p->member` は等価

## 実装状況

✅ **完全実装**:
- 基本的なメンバーアクセス（`.`, `->`）
- デリファレンスとの組み合わせ (`(*ptr->member).field`)
- 任意の深さのネストアクセス
- 正しい演算子優先順位と結合性

⚠️ **部分実装**:
- 複雑なネストパターンへの代入（読み取りは完全対応）
- 構造体リテラルの深いネスト初期化

## テスト実行

```bash
./main tests/cases/c_compatibility/comprehensive.cb
```

期待される出力は `comprehensive.expected` ファイルに記載されています。

## C言語での検証

同等のCコードでの動作確認：

```bash
gcc /tmp/test_c_compatibility.c -o /tmp/test_c_compatibility
/tmp/test_c_compatibility
```

このテストにより、Cb言語の実装がISO C標準に準拠していることを確認できます。
