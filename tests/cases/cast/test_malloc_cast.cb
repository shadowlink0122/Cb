// mallocã¸ã®ã‚­ãƒ£ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆ

struct Point {
    int x;
    int y;
};

int main() {
    println("=== Testing malloc with cast ===\n");
    
    // ãƒ†ã‚¹ãƒˆ1: (Point*)malloc(sizeof(Point))
    println("--- Test 1: Cast to Point* ---");
    int point_size = sizeof(Point);
    println("sizeof(Point) = {point_size}");
    
    Point* p1 = (Point*)malloc(point_size);
    
    if (p1 == nullptr) {
        println("âŒ malloc failed");
        return 1;
    }
    
    println("âœ… malloc with cast succeeded: {hex(p1)}");
    
    // ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã™
    println("\nTrying to access p1->x...");
    p1->x = 42;
    println("âœ… Set p1->x = {p1->x}");
    
    p1->y = 99;
    println("âœ… Set p1->y = {p1->y}");
    
    free(p1);
    println("âœ… Freed p1");
    
    // ãƒ†ã‚¹ãƒˆ2: é…åˆ—ã®ã‚­ãƒ£ã‚¹ãƒˆ
    println("\n--- Test 2: Cast to Point[N] ---");
    int N = 3;
    Point* points = (Point*)malloc(point_size * N);
    
    if (points == nullptr) {
        println("âŒ malloc failed for array");
        return 1;
    }
    
    println("âœ… malloc array with cast succeeded: {hex(points)}");
    
    // æœ€åˆã®è¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹
    println("\nAccessing first element...");
    points->x = 10;
    points->y = 20;
    println("âœ… points[0] = ({points->x}, {points->y})");
    
    free(points);
    println("âœ… Freed points array");
    
    println("\nğŸ‰ All cast tests passed!");
    return 0;
}
