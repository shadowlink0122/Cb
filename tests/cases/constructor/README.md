# コンストラクタ/デストラクタ テストスイート

## 概要

Cb言語 v0.10.0 で導入されたコンストラクタ/デストラクタ機能の包括的なテストスイート。

## テストファイル構成

### 1. ユニットテスト (C++)

**場所**: `tests/unit/backend/test_constructor.hpp`

**目的**: コンストラクタシステムの基本的なAPI確認

**テストケース**:
- `test_default_constructor`: デフォルトコンストラクタの基本動作確認
- `test_multiple_default_constructors`: 複数インスタンスの独立性確認
- `test_constructor_independence`: 値変更の独立性確認
- `test_constructor_private_function`: プライベート関数の使用確認

**実行方法**:
```bash
make unit-test
```

**ステータス**: ✅ 全テスト成功 (4/4)

### 2. 統合テスト (Cb言語)

#### 2.1 デフォルトコンストラクタ

**場所**: `tests/cases/constructor/default_constructor_test.cb`

**機能**:
- 基本的なデフォルトコンストラクタ
- 複数インスタンスの作成
- 異なる構造体型
- 初期化後の値変更と独立性

**実行方法**:
```bash
./main tests/cases/constructor/default_constructor_test.cb
```

**ステータス**: ✅ 全テスト成功 (4/4)

#### 2.2 引数付きコンストラクタ

**場所**: `tests/cases/constructor/parameterized_constructor_test.cb`

**機能**:
- 引数付きコンストラクタ
- コンストラクタのオーバーロード（パラメータ数による）
- 異なる数のパラメータを持つコンストラクタ

**テスト要件**:
1. ✅ パーサー対応済み
2. ✅ インタープリタ実装完了
   - 構文: `Point p(10, 20);`
   - オーバーロード解決: パラメータ数でマッチング

**実装完了項目**:
- ✅ 引数付きコンストラクタ呼び出しの構文解析
- ✅ 引数マッチングとオーバーロード解決（パラメータ数ベース）
- ✅ 引数の評価と受け渡し
- ✅ `self`コンテキストでのメンバー初期化

**ステータス**: ✅ 実装完了 - 全テストパス

#### 2.3 コピーコンストラクタ (実装待ち)

**場所**: `tests/cases/constructor/copy_constructor_test.cb`

**機能**:
- コピーコンストラクタ（`self(const T& other)`）
- ディープコピーの検証
- 独立性の確認

**テスト要件**:
1. ✅ パーサー対応済み
2. ⏳ インタープリタ実装待ち
   - 構文: `Point p2 = p1;`
   - const参照の処理

**実装必要項目**:
- 代入によるコピー検出
- const参照パラメータの処理
- コピーコンストラクタの自動呼び出し

**ステータス**: ⏳ 実装待ち

#### 2.4 ムーブコンストラクタ (実装待ち)

**場所**: `tests/cases/constructor/move_constructor_test.cb`

**機能**:
- ムーブコンストラクタ（`self(T&& other)`）
- 所有権移動の検証
- ムーブ vs コピーの区別

**重要な仕様変更 (v0.10.0)**:
- `&&`: 右辺値参照（ムーブセマンティクス専用）
- `&`: 左辺値参照（コピーコンストラクタ用）
- `const * const`: ムーブ不可能

**テスト要件**:
1. ✅ パーサー対応済み（`&&`構文）
2. ⏳ インタープリタ実装待ち
   - 構文: `Buffer b2 = move(b1);`
   - `move()`関数または右辺値参照検出

**実装必要項目**:
- `&&`（右辺値参照）の実装
- `move()`関数または右辺値参照の検出
- ムーブコンストラクタの自動呼び出し
- const制約の処理

**ステータス**: ⏳ 実装待ち

## 実装状況まとめ

### 完了 ✅

1. **デフォルトコンストラクタ**
   - パーサー: ✅ 完了
   - インタープリタ: ✅ 完了
   - 自動呼び出し: ✅ 完了
   - テスト: ✅ 全て成功

2. **引数付きコンストラクタ** ✨ **NEW**
   - パーサー: ✅ 完了 - `Point p(10, 20);` 構文サポート
   - インタープリタ: ✅ 完了 - 引数評価と受け渡し
   - オーバーロード解決: ✅ 完了 - パラメータ数ベース
   - テスト: ✅ 全て成功

3. **コンストラクタ内での`self`アクセス**
   - `self.member = value`: ✅ 動作
   - メンバー初期化: ✅ 動作

4. **ドキュメント**
   - spec.md: ✅ コンストラクタ/デストラクタセクション追加
   - ムーブセマンティクス（`&&`）: ✅ 仕様更新

### 実装待ち ⏳

1. **デフォルト引数付きコンストラクタ**
   - デフォルト引数の処理
   - 部分的な引数指定

2. **コピーコンストラクタ**
   - 代入検出
   - const参照の処理
   - 自動呼び出し

3. **ムーブコンストラクタ**
   - `&&`（右辺値参照）の実装
   - `move()`関数
   - 所有権移動
   - const制約

4. **デストラクタ**
   - スコープ終了時の自動呼び出し
   - 逆順実行

## テスト実行方法

### 全テスト実行
```bash
make test
```

### ユニットテストのみ
```bash
make unit-test
```

### 特定の統合テスト
```bash
./main tests/cases/constructor/default_constructor_test.cb
./main tests/cases/constructor/parameterized_constructor_test.cb  # 実装後
./main tests/cases/constructor/copy_constructor_test.cb          # 実装後
./main tests/cases/constructor/move_constructor_test.cb          # 実装後
```

## 次のステップ

### Phase 2-B: 引数付きコンストラクタ

1. 構文解析: `Point p(10, 20);`
2. 引数マッチング
3. デフォルト引数の処理
4. オーバーロード解決
5. テストの有効化

### Phase 2-C: コピーコンストラクタ

1. 代入パターンの検出
2. const参照の処理
3. コピーコンストラクタの呼び出し
4. テストの有効化

### Phase 2-D: ムーブコンストラクタ

1. `&&`（右辺値参照）の実装
2. `move()`関数の実装
3. ムーブコンストラクタの呼び出し
4. const制約の検証
5. テストの有効化

### Phase 2-E: デストラクタ

1. スコープ追跡
2. 自動呼び出しタイミング
3. 逆順実行
4. テストの有効化

## 備考

- 各テストファイルには詳細なコメントと期待される動作が記載されています
- 実装待ちのテストはコメントアウトされており、実装後に有効化できます
- プライベート関数のテストケースも準備済みです
