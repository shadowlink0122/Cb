# Cb ユニットテスト

## 概要

このディレクトリには、Cbコンパイラの内部コンポーネントをテストするユニットテストが含まれています。

## テストの種類

### HIRテスト (hir/)
**High-level Intermediate Representation (HIR)** の生成と変換をテストします。

- **対象**: `src/backend/ir/hir/` のコード
- **目的**: ASTからHIRへの変換が正しく行われることを検証
- **実行方法**:
  ```bash
  make -f Makefile.hir test-hir
  ```

**テスト内容例**:
- リテラルのHIR変換
- 算術演算のHIR変換
- 制御フローのHIR変換
- 関数呼び出しのHIR変換

### MIRテスト (mir/)
**Mid-level Intermediate Representation (MIR)** の生成と最適化をテストします。

- **対象**: `src/backend/ir/mir/` のコード
- **目的**: HIRからMIRへの変換と最適化パスを検証

### LIRテスト (lir/)
**Low-level Intermediate Representation (LIR)** の生成とコード生成をテストします。

- **対象**: `src/backend/ir/lir/` のコード
- **目的**: MIRからLIR、そして機械語への変換を検証

### バックエンドテスト (backend/)
バックエンド固有の機能をテストします。

### 共通テスト (common/)
共通ユーティリティ（型システム、エラーレポーターなど）をテストします。

## 統合テストとの違い

| 項目 | ユニットテスト | 統合テスト |
|------|--------------|-----------|
| **目的** | 内部コンポーネントの検証 | Cb言語機能の検証 |
| **対象** | HIR/MIR/LIR、最適化パスなど | Cbプログラムの実行結果 |
| **視点** | 開発者視点 | ユーザー視点 |
| **粒度** | 細かい（関数/クラス単位） | 粗い（機能単位） |
| **実行方法** | C++テストコードを直接実行 | Cbファイルを実行 |

## テスト作成ガイドライン

### ユニットテストを書くべき場合
- HIR/MIR/LIRの生成ロジックをテストする
- 最適化パスの動作を検証する
- 内部データ構造の変換を検証する
- エッジケースや境界条件をテストする

### 統合テストを書くべき場合
- Cb言語の機能が正しく動作することを確認する
- エンドツーエンドの動作を検証する
- ユーザーが書くコードの動作を保証する

## 実行方法

### すべてのユニットテストを実行
```bash
cd tests/unit
make test
```

### 特定のテストのみ実行
```bash
# HIRテスト
make -f Makefile.hir test-hir

# その他のテストは個別のMakefileを参照
```

## テスト追加方法

1. 適切なディレクトリにテストファイルを作成
   - HIR関連: `hir/test_*.cpp`
   - MIR関連: `mir/test_*.cpp`
   - LIR関連: `lir/test_*.cpp`

2. テストフレームワークを使用（`TEST_ASSERT` マクロなど）

3. Makefileにテストを追加

4. テストを実行して動作確認

## 参考

- 統合テストについては `tests/integration/README.md` を参照
- テスト全体の方針については `tests/README.md` を参照
