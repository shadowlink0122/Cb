# Async関数の動作確認テスト結果

## テスト実行日
2025年11月8日

## テスト目的
`async`キーワードで定義された関数が並行実行されるか、順次実行されるかを確認する。

## テスト方法

### テスト1: 同一時間(500ms)のタスクを10個起動
- 10個の`task_with_id(id, 500)`を連続呼び出し
- 期待（並行実行の場合）: 約500-600msで全完了
- 期待（順次実行の場合）: 約5000ms（500ms × 10）

### テスト2: 異なる時間のタスクを5個起動
- `task_with_id(id, duration)`を5回呼び出し（500, 700, 600, 900, 800ms）
- 期待（並行実行の場合）: 約900ms（最長タスク時間）
- 期待（順次実行の場合）: 約3500ms（合計時間）

## テスト結果

### テスト1の結果
- **タスク起動時間**: 5054ms
- **総実行時間**: 6059ms
- **結論**: ⚠️ 順次実行されている

各タスクのタイムスタンプ:
```
[タスク1] 開始 337353ms → 完了 337859ms (506ms)
[タスク2] 開始 337859ms → 完了 338364ms (505ms)
[タスク3] 開始 338365ms → 完了 338870ms (505ms)
...
[タスク10] 開始 341902ms → 完了 342407ms (505ms)
```

→ 各タスクは前のタスク完了後に開始している

### テスト2の結果
- **タスク起動時間**: 3522ms
- **総実行時間**: 4524ms
- **結論**: ⚠️ 順次実行されている

各タスクのタイムスタンプ:
```
[タスク1] 開始 343419ms → 完了 343924ms (505ms) sleep(500)
[タスク2] 開始 343925ms → 完了 344627ms (702ms) sleep(700)
[タスク3] 開始 344627ms → 完了 345232ms (605ms) sleep(600)
[タスク4] 開始 345232ms → 完了 346137ms (905ms) sleep(900)
[タスク5] 開始 346138ms → 完了 346941ms (803ms) sleep(800)
```

→ 各タスクは前のタスク完了後に順次実行されている

## 現在の実装状況

### 確認された動作
- ✅ `async`キーワードは認識される
- ✅ `async void func()`形式の関数定義が可能
- ✅ async関数は通常の関数と同様に呼び出せる
- ⚠️ async関数はブロッキング（同期的）に実行される
- ⚠️ Event Loopによる並行実行は未実装

### 未実装の機能
- ❌ Event Loop: タスクのスケジューリングと並行実行
- ❌ Future型: 非同期処理の結果を表現
- ❌ await式: Future完了を待機
- ❌ タスク切り替え: await時の実行制御

## 将来の並行実行実装時の期待結果

### テスト1（500ms × 10個）の場合
```
期待されるタイムスタンプ:
[タスク1] 開始 0ms → 完了 506ms
[タスク2] 開始 0ms → 完了 506ms  // 同時開始
[タスク3] 開始 0ms → 完了 506ms  // 同時開始
...
[タスク10] 開始 0ms → 完了 506ms // 同時開始

タスク起動時間: <100ms（ほぼ瞬時）
総実行時間: 約1500ms（506ms並行実行 + 1000ms待機）
```

### テスト2（異なる時間 × 5個）の場合
```
期待されるタイムスタンプ:
[タスク1] 開始 0ms → 完了 505ms   (500ms)
[タスク2] 開始 0ms → 完了 702ms   (700ms) // 同時開始
[タスク3] 開始 0ms → 完了 605ms   (600ms) // 同時開始
[タスク4] 開始 0ms → 完了 905ms   (900ms) // 同時開始、最長
[タスク5] 開始 0ms → 完了 803ms   (800ms) // 同時開始

タスク起動時間: <100ms（ほぼ瞬時）
総実行時間: 約1900ms（905ms並行実行 + 1000ms待機）
```

## テストファイル

- `sample/time_async_behavior_test.cb`: 動作確認テスト
- `sample/test_async_minimal.cb`: 最小限のasyncテスト
- `sample/test_async2.cb`: 複数async関数呼び出しテスト

## 使用方法

```bash
# テスト実行
./main sample/time_async_behavior_test.cb

# 期待される出力
# - 順次実行の場合: タスク起動時間が数秒
# - 並行実行の場合: タスク起動時間が100ms未満
```

## まとめ

現在のCb言語では:
- `async`キーワードは構文として存在
- 実際の動作は同期的な順次実行
- Event Loopによる並行実行は今後の実装予定

このテストは将来の並行実行実装時の動作検証に使用できます。
