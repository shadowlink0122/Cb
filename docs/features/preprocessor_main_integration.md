# ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µ main.cpp çµ±åˆå®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

## ðŸ“‹ å®Ÿè£…æ¦‚è¦

Cbã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®`main.cpp`ã«ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’çµ±åˆã—ã€å®Ÿéš›ã®Cbã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ãƒžã‚¯ãƒ­ãŒä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## ðŸ”§ å®Ÿè£…å†…å®¹

### 1. main.cpp ã¸ã®çµ±åˆ

```cpp
#include "preprocessor/preprocessor.h"

// ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’å®Ÿè¡Œ
CbPreprocessor::Preprocessor preprocessor;
std::string preprocessed_source = preprocessor.process(source, filename);

if (preprocessor.hasError()) {
    std::fprintf(stderr, "%s\n", preprocessor.getLastError().c_str());
    return 1;
}

// ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹æ¸ˆã¿ã‚½ãƒ¼ã‚¹ã‚’ãƒ‘ãƒ¼ã‚µãƒ¼ã«æ¸¡ã™
RecursiveParser parser(preprocessed_source, filename);
```

### 2. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ•ãƒ­ãƒ¼

```
ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ« (*.cb)
    â†“
ã€ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µã€‘ â† æ–°è¦è¿½åŠ 
    â†“  #defineã‚’å±•é–‹
    â†“  ãƒžã‚¯ãƒ­ã‚’ç½®æ›
    â†“
ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹æ¸ˆã¿ã‚½ãƒ¼ã‚¹
    â†“
Lexer â†’ Parser â†’ AST â†’ Interpreter
```

### 3. æ–°ã—ã„ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
# é€šå¸¸ã®å®Ÿè¡Œ
./main program.cb

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
./main program.cb --debug

# ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹çµæžœã®ã¿å‡ºåŠ›ï¼ˆ-Eãƒ•ãƒ©ã‚°ï¼‰
./main program.cb -E
./main program.cb --preprocess
```

## âœ… å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆ1: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ãƒžã‚¯ãƒ­

**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰** (`macro_demo.cb`):
```cb
#define PI 3.14159
#define TRUE 1
#define FALSE 0

int main() {
    println("=== Cb Preprocessor Demo ===");
    print("PI = ");
    println(PI);
    print("TRUE = ");
    println(TRUE);
    print("FALSE = ");
    println(FALSE);
    return 0;
}
```

**å®Ÿè¡Œçµæžœ**:
```
=== Cb Preprocessor Demo ===
PI = 3.14159
TRUE = 1
FALSE = 0
```

âœ… **æˆåŠŸï¼**

---

### ãƒ†ã‚¹ãƒˆ2: é–¢æ•°å½¢å¼ãƒžã‚¯ãƒ­

**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰** (`function_macro_demo.cb`):
```cb
#define SQUARE(x) ((x) * (x))
#define MAX(a, b) ((a) > (b) ? (a) : (b))
#define MIN(a, b) ((a) < (b) ? (a) : (b))

int main() {
    println("=== Function Macro Demo ===");
    
    int a = 5;
    int b = 3;
    
    print("SQUARE(5) = ");
    println(SQUARE(a));
    
    print("MAX(5, 3) = ");
    println(MAX(a, b));
    
    print("MIN(5, 3) = ");
    println(MIN(a, b));
    
    print("SQUARE(2 + 3) = ");
    println(SQUARE(2 + 3));
    
    return 0;
}
```

**å®Ÿè¡Œçµæžœ**:
```
=== Function Macro Demo ===
SQUARE(5) = 25
MAX(5, 3) = 5
MIN(5, 3) = 3
SQUARE(2 + 3) = 25
```

âœ… **æˆåŠŸï¼**

---

### ãƒ†ã‚¹ãƒˆ3: ãƒã‚¹ãƒˆã—ãŸãƒžã‚¯ãƒ­

**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰** (`nested_macro_demo.cb`):
```cb
#define PI 3.14159
#define DOUBLE(x) ((x) * 2)
#define QUAD(x) DOUBLE(DOUBLE(x))
#define CIRCLE_AREA(r) (PI * (r) * (r))

int main() {
    println("=== Nested Macro Demo ===");
    
    print("DOUBLE(5) = ");
    println(DOUBLE(5));
    
    print("QUAD(5) = ");
    println(QUAD(5));
    
    print("CIRCLE_AREA(3.0) = ");
    println(CIRCLE_AREA(3.0));
    
    return 0;
}
```

**å®Ÿè¡Œçµæžœ**:
```
=== Nested Macro Demo ===
DOUBLE(5) = 10
QUAD(5) = 20
CIRCLE_AREA(3.0) = 28.27431
```

âœ… **æˆåŠŸï¼**

---

### ãƒ†ã‚¹ãƒˆ4: -Eãƒ•ãƒ©ã‚°ï¼ˆãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹çµæžœã®ç¢ºèªï¼‰

**ã‚³ãƒžãƒ³ãƒ‰**:
```bash
./main tests/cases/preprocessor/macro_demo.cb -E
```

**å‡ºåŠ›**:
```cb
// ãƒžã‚¯ãƒ­ãƒ†ã‚¹ãƒˆ: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ãƒžã‚¯ãƒ­
int main() {
    println("=== Cb Preprocessor Demo ===");
    print("3.14159 = ");
    println(3.14159);
    print("1 = ");
    println(1);
    print("0 = ");
    println(0);
    return 0;
}
```

âœ… **æˆåŠŸï¼** - ãƒžã‚¯ãƒ­ãŒæ­£ã—ãå±•é–‹ã•ã‚Œã¦ã„ã‚‹

## ðŸ“Š å®Ÿè£…çŠ¶æ³ã¾ã¨ã‚

| æ©Ÿèƒ½ | çŠ¶æ…‹ | å‚™è€ƒ |
|------|------|------|
| `#define` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ | âœ… å®Œäº† | å‹•ä½œç¢ºèªæ¸ˆã¿ |
| `#define` é–¢æ•°å½¢å¼ | âœ… å®Œäº† | å‹•ä½œç¢ºèªæ¸ˆã¿ |
| å¼•æ•°ãƒ‘ãƒ¼ã‚¹ | âœ… å®Œäº† | ãƒã‚¹ãƒˆæ‹¬å¼§å¯¾å¿œ |
| å†å¸°çš„ãƒžã‚¯ãƒ­å±•é–‹ | âœ… å®Œäº† | å‹•ä½œç¢ºèªæ¸ˆã¿ |
| `#undef` | âœ… å®Œäº† | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆæ¸ˆã¿ |
| main.cppçµ±åˆ | âœ… **å®Œäº†** | **å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆæˆåŠŸ** |
| `-E`ãƒ•ãƒ©ã‚° | âœ… **å®Œäº†** | **å‹•ä½œç¢ºèªæ¸ˆã¿** |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | âœ… å®Œäº† | 54/54ãƒ‘ã‚¹ |
| `#` æ¼”ç®—å­ï¼ˆæ–‡å­—åˆ—åŒ–ï¼‰ | â³ å°†æ¥å®Ÿè£… | Week 3äºˆå®š |
| `##` æ¼”ç®—å­ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³çµåˆï¼‰ | â³ å°†æ¥å®Ÿè£… | Week 3äºˆå®š |
| `#if/#else/#endif` | â³ å°†æ¥å®Ÿè£… | Week 4äºˆå®š |

## ðŸŽ¯ ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```bash
# ãƒžã‚¯ãƒ­ã‚’ä½¿ã£ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œ
./main myprogram.cb

# ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹çµæžœã‚’ç¢ºèª
./main myprogram.cb -E

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
./main myprogram.cb --debug
```

### ã‚ˆãã‚ã‚‹ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

1. **å®šæ•°å®šç¾©**
```cb
#define MAX_SIZE 100
#define DEFAULT_VALUE 42
```

2. **è¨ˆç®—ãƒžã‚¯ãƒ­**
```cb
#define SQUARE(x) ((x) * (x))
#define ABS(x) ((x) < 0 ? -(x) : (x))
```

3. **æ¡ä»¶ãƒžã‚¯ãƒ­ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ï¼‰**
```cb
#define DEBUG_MODE 1
#define PRODUCTION_MODE 0
```

## âš ï¸ æ—¢çŸ¥ã®å•é¡Œ

### 1. æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«å†…ã®ãƒžã‚¯ãƒ­å±•é–‹

**ç¾çŠ¶**: æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«å†…ã®è­˜åˆ¥å­ã‚‚ãƒžã‚¯ãƒ­å±•é–‹ã•ã‚Œã¦ã—ã¾ã†

**ä¾‹**:
```cb
#define PI 3.14159
println("PI =", PI);  // "3.14159 =" ã¨å±•é–‹ã•ã‚Œã‚‹
```

**å›žé¿ç­–**: 
```cb
print("PI = ");  // æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã«ãƒžã‚¯ãƒ­åã‚’å«ã‚ãªã„
println(PI);
```

**ä¿®æ­£äºˆå®š**: å°†æ¥çš„ã«æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«å†…ã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹å®Ÿè£…ã‚’è¿½åŠ 

## ðŸ“ æŠ€è¡“çš„è©³ç´°

### ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µã®å‡¦ç†é †åº

1. ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
2. ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µå®Ÿè¡Œ
   - `#define`ã‚’æ¤œå‡ºã—ã¦ç™»éŒ²
   - ãƒžã‚¯ãƒ­å‘¼ã³å‡ºã—ã‚’å±•é–‹
   - `#undef`ã‚’å‡¦ç†
3. ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹æ¸ˆã¿ã‚½ãƒ¼ã‚¹ã‚’ãƒ‘ãƒ¼ã‚µãƒ¼ã«æ¸¡ã™
4. é€šå¸¸ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ•ãƒ­ãƒ¼ç¶šè¡Œ

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```cpp
if (preprocessor.hasError()) {
    std::fprintf(stderr, "%s\n", preprocessor.getLastError().c_str());
    return 1;
}
```

ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µã®ã‚¨ãƒ©ãƒ¼ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã¨è¡Œç•ªå·ä»˜ãã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## ðŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… main.cppçµ±åˆ - **å®Œäº†**
2. âœ… -Eãƒ•ãƒ©ã‚°å®Ÿè£… - **å®Œäº†**
3. â³ æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«å†…ã®ãƒžã‚¯ãƒ­å±•é–‹ã‚¹ã‚­ãƒƒãƒ—
4. â³ ã‚³ãƒ¡ãƒ³ãƒˆå†…ã®ãƒžã‚¯ãƒ­å±•é–‹ã‚¹ã‚­ãƒƒãƒ—
5. â³ `#` æ¼”ç®—å­ï¼ˆæ–‡å­—åˆ—åŒ–ï¼‰ã®å®Ÿè£…
6. â³ `##` æ¼”ç®—å­ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³çµåˆï¼‰ã®å®Ÿè£…
7. â³ `#if/#else/#endif`æ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

---

**æ—¥ä»˜**: 2025å¹´10æœˆ13æ—¥  
**ãƒ–ãƒ©ãƒ³ãƒ**: feature/v0.10.1  
**çµ±åˆãƒ†ã‚¹ãƒˆ**: 3/3 æˆåŠŸ âœ…  
**ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: 54/54 ãƒ‘ã‚¹ âœ…
