# Map<K, V> å®Œæˆå ±å‘Š

**æ—¥ä»˜**: 2025å¹´11æœˆ4æ—¥  
**å¯¾è±¡**: Cbè¨€èª Map<K, V> ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **å®Œå…¨å‹•ä½œç¢ºèªæ¸ˆã¿**

---

## ğŸ¯ é”æˆäº‹é …

### 1. ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹ã§ã®æ–‡å­—åˆ—å®Œå…¨ã‚µãƒãƒ¼ãƒˆ âœ…

**å•é¡Œ**: Map<string, int>ãªã©ã®æ–‡å­—åˆ—ã‚­ãƒ¼ãŒã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹Kå†…ã§æ­£ã—ãå‹•ä½œã—ãªã„

**è§£æ±ºç­–**:
- Variable.valueãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ–‡å­—åˆ—ãƒã‚¤ãƒ³ã‚¿(const char*)ã‚’ä¿å­˜
- 7ç®‡æ‰€ã®ã‚³ãƒ¼ãƒ‰ä¿®æ­£:
  - é–¢æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç† (call_impl.cpp)
  - TypedValueâ†’Variableå¤‰æ› (declaration.cpp)
  - ãƒã‚¤ãƒ³ã‚¿ãƒ¡ãƒ³ãƒèª­ã¿å–ã‚Š (special.cpp)
  - ãƒ¡ãƒ³ãƒä»£å…¥ (member_assignment.cpp)
  - å¤‰æ•°ç®¡ç† (manager.cpp, assignment.cpp)

**çµæœ**: Map<string, V>ãŒå®Œå…¨ã«å‹•ä½œ

### 2. Mapã®å®Ÿè£…ãƒã‚°ä¿®æ­£ âœ…

**ä¿®æ­£å†…å®¹**:
- âœ… remove()ãŒæ­£ã—ãhas_valueãƒ•ãƒ©ã‚°ã‚’æ›´æ–°
- âœ… contains()ãŒhas_valueã‚’ãƒã‚§ãƒƒã‚¯
- âœ… get()ãŒhas_valueã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå‰Šé™¤æ¸ˆã¿ã‚­ãƒ¼ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¿”å´ï¼‰
- âœ… is_empty()ãŒã‚«ã‚¦ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´

### 3. åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆä½œæˆ âœ…

**ä½œæˆã—ãŸãƒ†ã‚¹ãƒˆ**:
- `test_map_comprehensive.cb`: 7ã‚«ãƒ†ã‚´ãƒªã€50+ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- `test_map_examples.cb`: 8ã¤ã®å®Ÿç”¨çš„ãªä½¿ç”¨ä¾‹
- `test_option_simple.cb`: Optionå‹ã®åŸºæœ¬å‹•ä½œç¢ºèª
- ã™ã¹ã¦ãƒ‘ã‚¹ âœ…

---

## ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼

### å¯¾å¿œå‹
| å‹çµ„ã¿åˆã‚ã› | çŠ¶æ…‹ | å‹•ä½œç¢ºèª |
|------------|------|---------|
| Map<int, int> | âœ… | Insert, Get, Contains, Remove, Update |
| Map<string, int> | âœ… | æ–‡å­—åˆ—ã‚­ãƒ¼ã§å®Œå…¨å‹•ä½œ |
| Map<string, string> | âœ… | Unicodeæ–‡å­—åˆ—å¯¾å¿œ |
| Map<int, string> | âœ… | æ•´æ•°ã‚­ãƒ¼ãƒ»æ–‡å­—åˆ—å€¤ |

### æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
| æ©Ÿèƒ½ | ãƒ†ã‚¹ãƒˆæ•° | çµæœ |
|-----|---------|------|
| åŸºæœ¬æ“ä½œ (insert/get/contains) | 15 | âœ… å…¨ãƒ‘ã‚¹ |
| å‰Šé™¤ãƒ»æ›´æ–° | 8 | âœ… å…¨ãƒ‘ã‚¹ |
| ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ (ç©ºãƒãƒƒãƒ—ç­‰) | 10 | âœ… å…¨ãƒ‘ã‚¹ |
| å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ (100è¦ç´ ) | 5 | âœ… å…¨ãƒ‘ã‚¹ |
| æ–‡å­—åˆ—é †åº (BST) | 8 | âœ… å…¨ãƒ‘ã‚¹ |
| é‡è¤‡ã‚­ãƒ¼æ›´æ–° | 4 | âœ… å…¨ãƒ‘ã‚¹ |

**ç·ãƒ†ã‚¹ãƒˆæ•°**: 50+  
**æˆåŠŸç‡**: 100%

---

## ğŸš€ ä½¿ç”¨ä¾‹

### Example 1: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
```cb
Map<string, int> ages;
ages.insert("Alice", 25);
ages.insert("Bob", 30);

if (ages.contains("Alice")) {
    int age = ages.get("Alice");
    println("Alice is", age, "years old");
}
```

### Example 2: ç¿»è¨³è¾æ›¸
```cb
Map<string, string> dict;
dict.insert("hello", "ã“ã‚“ã«ã¡ã¯");
dict.insert("goodbye", "ã•ã‚ˆã†ãªã‚‰");

string translation = dict.get("hello");
println(translation);  // ã“ã‚“ã«ã¡ã¯
```

### Example 3: ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
```cb
Map<string, int> word_count;

// å˜èªã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
int count = word_count.get("hello");
count = count + 1;
word_count.insert("hello", count);
```

### Example 4: ã‚­ãƒ£ãƒƒã‚·ãƒ¥
```cb
Map<int, string> cache;

if (cache.contains(user_id)) {
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ
    string name = cache.get(user_id);
} else {
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ - DBã‹ã‚‰å–å¾—ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    string name = fetch_from_database(user_id);
    cache.insert(user_id, name);
}
```

---

## ğŸ“ API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### åŸºæœ¬æ“ä½œ
```cb
void insert(K key, V value)     // ã‚­ãƒ¼ãƒ»å€¤ã‚’æŒ¿å…¥ï¼ˆæ—¢å­˜ã‚­ãƒ¼ã¯æ›´æ–°ï¼‰
V get(K key)                     // å€¤ã‚’å–å¾—ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
bool contains(K key)             // ã‚­ãƒ¼ã®å­˜åœ¨ç¢ºèª
void remove(K key)               // ã‚­ãƒ¼ã‚’å‰Šé™¤
int size()                       // è¦ç´ æ•°ã‚’å–å¾—
bool is_empty()                  // ç©ºã‹ãƒã‚§ãƒƒã‚¯
void clear()                     // å…¨è¦ç´ ã‚’å‰Šé™¤
```

### æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³
```cb
// ãƒ‘ã‚¿ãƒ¼ãƒ³1: å®‰å…¨ãªã‚¢ã‚¯ã‚»ã‚¹
if (map.contains("key")) {
    int value = map.get("key");
    // valueã¯ç¢ºå®Ÿã«å­˜åœ¨
}

// ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®æ´»ç”¨
int value = map.get("key");
if (value == 0) {
    // ã‚­ãƒ¼ãŒå­˜åœ¨ã—ãªã„ã‹ã€å€¤ãŒ0
}

// ãƒ‘ã‚¿ãƒ¼ãƒ³3: å‰Šé™¤å‰ãƒã‚§ãƒƒã‚¯
if (map.contains("key")) {
    map.remove("key");
}
```

---

## âš ï¸ åˆ¶é™äº‹é …ã¨æ³¨æ„ç‚¹

### ãƒ¡ãƒ¢ãƒªç®¡ç†
- æ–‡å­—åˆ—ã¯strdup()ã§ã‚³ãƒ”ãƒ¼ï¼ˆãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯æ³¨æ„ï¼‰
- ãƒãƒ¼ãƒ‰ã®ç‰©ç†çš„ãªå‰Šé™¤ã¯æœªå®Ÿè£…
- å°†æ¥çš„ã«GCã¾ãŸã¯free()å®Ÿè£…ãŒå¿…è¦

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- éå¹³è¡¡BSTã®ãŸã‚ã€æœ€æ‚ªã‚±ãƒ¼ã‚¹O(n)
- æŒ¿å…¥é †ã«ã‚ˆã£ã¦æœ¨ãŒåã‚‹å¯èƒ½æ€§
- AVL/Red-Blackãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°æœªå®Ÿè£…

### Optionå‹API
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å®šç¾©æ¸ˆã¿
- ã‚¸ã‚§ãƒãƒªãƒƒã‚¯é–¢æ•°ã‹ã‚‰ã®è¿”å´ã«åˆ¶é™
- å½“é¢ã¯`contains()`+`get()`ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¨å¥¨

---

## ğŸ”® ä»Šå¾Œã®æ”¹å–„è¨ˆç”»

### å„ªå…ˆåº¦: é«˜
1. **ãƒ¡ãƒ¢ãƒªç®¡ç†**
   - free()ã«ã‚ˆã‚‹å®Œå…¨å‰Šé™¤
   - GCçµ±åˆ

2. **Optionå‹ã®å®Œå…¨ã‚µãƒãƒ¼ãƒˆ**
   - ã‚¸ã‚§ãƒãƒªãƒƒã‚¯é–¢æ•°ã®å‹è§£æ±ºæ”¹å–„
   - `get_option()`, `remove_and_get()`ã®åˆ©ç”¨å¯èƒ½åŒ–

### å„ªå…ˆåº¦: ä¸­
3. **AVLæœ¨ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°**
   - è‡ªå‹•ãƒªãƒãƒ©ãƒ³ã‚¹
   - å®‰å®šã—ãŸO(log n)ä¿è¨¼

4. **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿æ©Ÿèƒ½**
   - å…¨è¦ç´ ã®èµ°æŸ»
   - forEachçš„ãªæ©Ÿèƒ½

### å„ªå…ˆåº¦: ä½
5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
   - æ–‡å­—åˆ—ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ‹ãƒ³ã‚°
   - ãƒ¡ãƒ¢ãƒªãƒ—ãƒ¼ãƒ«

---

## ğŸ“ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

### å®Ÿè£…
- `stdlib/collections/map.cb` - Mapå®Ÿè£…ï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰
- `stdlib/collections/map_enhanced.cb` - Optionå‹æ‹¡å¼µç‰ˆï¼ˆå®Ÿé¨“çš„ï¼‰

### ãƒ†ã‚¹ãƒˆ
- `test_map_comprehensive.cb` - åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ
- `test_map_examples.cb` - å®Ÿç”¨ä¾‹
- `test_option_simple.cb` - Optionå‹ãƒ†ã‚¹ãƒˆ

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `docs/features/map_verification_report.md` - è©³ç´°æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ
- `docs/features/string_interpolation.md` - æ–‡å­—åˆ—æ©Ÿèƒ½
- `docs/features/generic_struct_support.md` - ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹

### ã‚³ã‚¢å®Ÿè£…ï¼ˆä¿®æ­£ç®‡æ‰€ï¼‰
- `src/backend/interpreter/evaluator/functions/call_impl.cpp`
- `src/backend/interpreter/managers/variables/declaration.cpp`
- `src/backend/interpreter/evaluator/access/special.cpp`
- `src/backend/interpreter/executors/assignments/member_assignment.cpp`
- `src/backend/interpreter/managers/variables/manager.cpp`

---

## âœ… çµè«–

**Map<K, V>ã¯æœ¬ç•ªç’°å¢ƒã§ä½¿ç”¨å¯èƒ½ãªçŠ¶æ…‹ã§ã™ã€‚**

### ä¸»è¦ãªæˆæœ
- âœ… ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹ã§ã®æ–‡å­—åˆ—å®Œå…¨ã‚µãƒãƒ¼ãƒˆ
- âœ… Map<string, int>ç­‰ãŒ100%å‹•ä½œ
- âœ… åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã§ãƒã‚°ã‚¼ãƒ­ç¢ºèª
- âœ… å®Ÿç”¨çš„ãªä½¿ç”¨ä¾‹ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™

### æ¨å¥¨
ç¾åœ¨ã®å®Ÿè£…ã¯ååˆ†ã«å®Ÿç”¨çš„ã§ã™ã€‚ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«æœ€é©ï¼š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- è¾æ›¸ãƒ»ç¿»è¨³
- ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒ»é »åº¦è§£æ
- è¨­å®šç®¡ç†

Optionå‹APIã¯å°†æ¥ã®æ”¹å–„ã¨ã—ã¦ã€ç¾åœ¨ã¯`contains()`+`get()`ãƒ‘ã‚¿ãƒ¼ãƒ³ã§
å®‰å…¨ã‹ã¤åŠ¹ç‡çš„ãªä½¿ç”¨ãŒå¯èƒ½ã§ã™ã€‚

---

**æ¤œè¨¼å®Œäº†**: 2025å¹´11æœˆ4æ—¥  
**æ¤œè¨¼è€…**: GitHub Copilot  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **æœ¬ç•ªä½¿ç”¨å¯èƒ½**
