# é…åˆ—å¼•æ•°ã®æ¸¡ã—æ–¹æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

**æ¤œè¨¼æ—¥**: 2025å¹´10æœˆ10æ—¥  
**ç›®çš„**: é…åˆ—ã‚’é–¢æ•°å¼•æ•°ã¨ã—ã¦æ¸¡ã—ãŸæ™‚ã€ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ã®ã‹å‚ç…§ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã®ã‹ã‚’ç¢ºèª  
**çµè«–**: âœ… **ã™ã¹ã¦ã®é…åˆ—å‹ã¯å‚ç…§ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹ï¼ˆC/C++ã¨åŒæ§˜ã®å‹•ä½œï¼‰**

---

## ğŸ“Š æ¤œè¨¼çµæœã‚µãƒãƒªãƒ¼

| é…åˆ—ã®ç¨®é¡ | å‚ç…§æ¸¡ã— | ã‚³ãƒ”ãƒ¼æ¸¡ã— | æ¤œè¨¼çŠ¶æ³ |
|-----------|---------|-----------|---------|
| 1æ¬¡å…ƒé…åˆ—ï¼ˆ`int[N]`ï¼‰ | âœ… | âŒ | ç¢ºèªæ¸ˆã¿ |
| 2æ¬¡å…ƒé…åˆ—ï¼ˆ`int[N][M]`ï¼‰ | âœ… | âŒ | ç¢ºèªæ¸ˆã¿ |
| ãƒã‚¤ãƒ³ã‚¿é…åˆ—ï¼ˆ`int*[N]`ï¼‰ | âœ… | âŒ | ç¢ºèªæ¸ˆã¿ |
| æ§‹é€ ä½“é…åˆ—ï¼ˆ`Struct[N]`ï¼‰ | âœ… | âŒ | ç¢ºèªæ¸ˆã¿ |

**ç·åˆçµè«–**: Cbè¨€èªã§ã¯ã€C/C++ã¨åŒæ§˜ã«**é…åˆ—ã¯ã™ã¹ã¦å‚ç…§ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹**

---

## ğŸ§ª æ¤œè¨¼ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆ1: 1æ¬¡å…ƒæ•´æ•°é…åˆ—

**ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**:
```cb
void modify_array(int[3] arr) {
    arr[0] = 100;
    arr[1] = 200;
    arr[2] = 300;
}

void main() {
    int[3] original = [1, 2, 3];
    modify_array(original);
    // çµæœã‚’ç¢ºèª
}
```

**å®Ÿè¡Œçµæœ**:
```
=== Before function call ===
original[0] = 1
original[1] = 2
original[2] = 3

=== Inside function (after modification) ===
arr[0] = 100
arr[1] = 200
arr[2] = 300

=== After function call ===
original[0] = 100  âœ… å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹
original[1] = 200  âœ… å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹
original[2] = 300  âœ… å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹

âœ… Result: Array is passed by REFERENCE
```

**çµè«–**: 1æ¬¡å…ƒé…åˆ—ã¯å‚ç…§æ¸¡ã— âœ…

---

### ãƒ†ã‚¹ãƒˆ2: 2æ¬¡å…ƒé…åˆ—

**ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**:
```cb
void modify_2d_array(int[2][3] arr) {
    arr[0][0] = 99;
    arr[1][2] = 88;
}

void main() {
    int[2][3] matrix = [[1, 2, 3], [4, 5, 6]];
    modify_2d_array(matrix);
}
```

**å®Ÿè¡Œçµæœ**:
```
=== Before function call ===
matrix[0][0] = 1
matrix[1][2] = 6

=== After function call ===
matrix[0][0] = 99  âœ… å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹
matrix[1][2] = 88  âœ… å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹

âœ… 2D Array is passed by REFERENCE
```

**çµè«–**: 2æ¬¡å…ƒé…åˆ—ã‚‚å‚ç…§æ¸¡ã— âœ…

---

### ãƒ†ã‚¹ãƒˆ3: ãƒã‚¤ãƒ³ã‚¿é…åˆ—

**ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**:
```cb
void swap_pointers(int*[3] ptrs) {
    int* temp = ptrs[0];
    ptrs[0] = ptrs[1];
    ptrs[1] = temp;
}

void main() {
    int a = 10, b = 20, c = 30;
    int*[3] pointers = [&a, &b, &c];
    swap_pointers(pointers);
}
```

**å®Ÿè¡Œçµæœ**:
```
=== Before function call ===
*pointers[0] = 10 (pointing to a)
*pointers[1] = 20 (pointing to b)

=== After function call ===
*pointers[0] = 20  âœ… ã‚¹ãƒ¯ãƒƒãƒ—ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹
*pointers[1] = 10  âœ… ã‚¹ãƒ¯ãƒƒãƒ—ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹

âœ… Pointer Array is passed by REFERENCE
   Pointer swap affected the original array
```

**çµè«–**: ãƒã‚¤ãƒ³ã‚¿é…åˆ—ã‚‚å‚ç…§æ¸¡ã— âœ…

---

### ãƒ†ã‚¹ãƒˆ4: æ§‹é€ ä½“é…åˆ—

**ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**:
```cb
struct Point { int x; int y; };

void modify_struct_array(Point[3] points) {
    points[0].x = 999;
    points[1].y = 888;
}

void main() {
    Point[3] points = [{x: 10, y: 20}, {x: 30, y: 40}, {x: 50, y: 60}];
    modify_struct_array(points);
}
```

**å®Ÿè¡Œçµæœ**:
```
=== Before function call ===
points[0].x = 0
points[1].y = 0

=== After function call ===
points[0].x = 999  âœ… å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹
points[1].y = 888  âœ… å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹

âœ… Struct Array is passed by REFERENCE
```

**çµè«–**: æ§‹é€ ä½“é…åˆ—ã‚‚å‚ç…§æ¸¡ã— âœ…

---

## ğŸ”§ å®Ÿè£…ã®è©³ç´°

### ã‚³ãƒ¼ãƒ‰å®Ÿè£…ç®‡æ‰€

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/backend/interpreter/managers/variables/manager.cpp`  
**é–¢æ•°**: `assign_array_parameter()`  
**è¡Œæ•°**: 1368-1410

### å®Ÿè£…ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ

```cpp
void VariableManager::assign_array_parameter(const std::string &name,
                                             const Variable &source_array,
                                             TypeInfo type) {
    // é…åˆ—ã¯å‚ç…§ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹ï¼ˆC/C++ã®å‹•ä½œã¨åŒã˜ï¼‰
    Variable array_ref;
    array_ref.is_reference = true;       // å‚ç…§ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
    array_ref.is_assigned = true;
    array_ref.type = source_array.type;  // å‹æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼
    
    // å…ƒã®é…åˆ—å¤‰æ•°ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’ä¿å­˜
    array_ref.value = reinterpret_cast<int64_t>(const_cast<Variable *>(&source_array));
    
    // é…åˆ—ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼
    array_ref.is_array = source_array.is_array;
    array_ref.is_multidimensional = source_array.is_multidimensional;
    array_ref.array_size = source_array.array_size;
    array_ref.array_dimensions = source_array.array_dimensions;
    array_ref.array_type_info = source_array.array_type_info;
    
    // ãƒã‚¤ãƒ³ã‚¿é…åˆ—æƒ…å ±ã‚‚ã‚³ãƒ”ãƒ¼
    array_ref.is_pointer = source_array.is_pointer;
    array_ref.pointer_depth = source_array.pointer_depth;
    array_ref.pointer_base_type = source_array.pointer_base_type;
    
    // structé…åˆ—æƒ…å ±ã‚‚ã‚³ãƒ”ãƒ¼
    array_ref.is_struct = source_array.is_struct;
    array_ref.struct_type_name = source_array.struct_type_name;
    
    current_scope().variables[name] = array_ref;
}
```

### å®Ÿè£…ã®ä»•çµ„ã¿

1. **å‚ç…§ãƒ•ãƒ©ã‚°ã®è¨­å®š**:
   - `is_reference = true` ã«ã‚ˆã‚Šã€å¤‰æ•°ãŒå‚ç…§ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™

2. **ãƒã‚¤ãƒ³ã‚¿ã®ä¿å­˜**:
   - `array_ref.value` ã«å…ƒã®é…åˆ—å¤‰æ•°ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’ä¿å­˜
   - `reinterpret_cast<int64_t>()` ã§ãƒã‚¤ãƒ³ã‚¿ã‚’æ•´æ•°å€¤ã¨ã—ã¦æ ¼ç´

3. **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã‚³ãƒ”ãƒ¼**:
   - é…åˆ—ã®ã‚µã‚¤ã‚ºã€æ¬¡å…ƒã€å‹æƒ…å ±ãªã©ã‚’ã‚³ãƒ”ãƒ¼
   - ã“ã‚Œã«ã‚ˆã‚Šã€å‚ç…§å…ˆã®é…åˆ—ã®æ§‹é€ ã‚’æ­£ã—ãèªè­˜ã§ãã‚‹

4. **ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®å‚ç…§è§£æ±º**:
   - é…åˆ—è¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã€`is_reference` ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯
   - å‚ç…§ã®å ´åˆã€`value` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰ãƒã‚¤ãƒ³ã‚¿ã‚’å–ã‚Šå‡ºã—ã¦å…ƒã®é…åˆ—ã«ã‚¢ã‚¯ã‚»ã‚¹

---

## ğŸ“ C/C++ã¨ã®æ¯”è¼ƒ

### Cè¨€èªã®å‹•ä½œ
```c
void modify(int arr[3]) {
    arr[0] = 100;  // å…ƒã®é…åˆ—ãŒå¤‰æ›´ã•ã‚Œã‚‹
}

int main() {
    int nums[3] = {1, 2, 3};
    modify(nums);  // é…åˆ—ã¯å¸¸ã«ãƒã‚¤ãƒ³ã‚¿ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹
    // nums[0] == 100
}
```

### Cbè¨€èªã®å‹•ä½œ
```cb
void modify(int[3] arr) {
    arr[0] = 100;  // å…ƒã®é…åˆ—ãŒå¤‰æ›´ã•ã‚Œã‚‹
}

void main() {
    int[3] nums = [1, 2, 3];
    modify(nums);  // é…åˆ—ã¯å‚ç…§ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹
    // nums[0] == 100
}
```

### å‹•ä½œã®ä¸€è‡´
âœ… **C/C++ã¨å®Œå…¨ã«ä¸€è‡´**:
- é…åˆ—ã‚’é–¢æ•°ã«æ¸¡ã™ã¨ã€å…ƒã®é…åˆ—ã¸ã®å‚ç…§ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹
- é–¢æ•°å†…ã§ã®å¤‰æ›´ãŒå‘¼ã³å‡ºã—å…ƒã«åæ˜ ã•ã‚Œã‚‹
- ã‚³ãƒ”ãƒ¼ã¯ç™ºç”Ÿã—ãªã„ï¼ˆãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒè‰¯ã„ï¼‰

---

## ğŸ¯ é‡è¦ãªçµè«–

### 1. ã™ã¹ã¦ã®é…åˆ—ã¯å‚ç…§æ¸¡ã—
Cbè¨€èªã§ã¯ã€é…åˆ—å‹ã®å¼•æ•°ã¯ã™ã¹ã¦å‚ç…§ã¨ã—ã¦æ¸¡ã•ã‚Œã¾ã™ï¼š
- `int[N]` â†’ å‚ç…§æ¸¡ã—
- `int[N][M]` â†’ å‚ç…§æ¸¡ã—
- `int*[N]` â†’ å‚ç…§æ¸¡ã—
- `Struct[N]` â†’ å‚ç…§æ¸¡ã—

### 2. C/C++ã¨ã®äº’æ›æ€§
ã“ã®å‹•ä½œã¯C/C++ã¨å®Œå…¨ã«ä¸€è‡´ã—ã¦ãŠã‚Šã€ç§»æ¤æ€§ãŒé«˜ã„ï¼š
```c
// Cè¨€èª
void func(int arr[10]) { ... }  // ãƒã‚¤ãƒ³ã‚¿ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹

// Cbè¨€èª
void func(int[10] arr) { ... }  // å‚ç…§ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹ï¼ˆåŒã˜å‹•ä½œï¼‰
```

### 3. ãƒ¡ãƒ¢ãƒªåŠ¹ç‡
é…åˆ—ã‚’ã‚³ãƒ”ãƒ¼ã›ãšã«å‚ç…§ã¨ã—ã¦æ¸¡ã™ãŸã‚ï¼š
- âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå°‘ãªã„
- âœ… é–¢æ•°å‘¼ã³å‡ºã—ãŒé«˜é€Ÿ
- âœ… å¤§ããªé…åˆ—ã§ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ãªã—

### 4. æ„å›³ã—ãªã„å¤‰æ›´ã«æ³¨æ„
å‚ç…§æ¸¡ã—ã®ãŸã‚ã€é–¢æ•°å†…ã§ã®å¤‰æ›´ãŒå‘¼ã³å‡ºã—å…ƒã«å½±éŸ¿ã—ã¾ã™ï¼š
```cb
void func(int[10] arr) {
    arr[0] = 999;  // âš ï¸ å…ƒã®é…åˆ—ãŒå¤‰æ›´ã•ã‚Œã‚‹
}
```

èª­ã¿å–ã‚Šå°‚ç”¨ã«ã—ãŸã„å ´åˆã¯ã€`const`ä¿®é£¾å­ã‚’ä½¿ç”¨ï¼š
```cb
void func(const int[10] arr) {
    arr[0] = 999;  // âŒ ã‚¨ãƒ©ãƒ¼: consté…åˆ—ã¸ã®æ›¸ãè¾¼ã¿
}
```

---

## ğŸ”„ v0.10.0ã§ã®æ”¹å–„äºˆå®š

### é…åˆ—å‚ç…§å‹ï¼ˆ`int[N]&`ï¼‰ã®æ˜ç¤ºçš„å®£è¨€
ç¾åœ¨ã¯è‡ªå‹•çš„ã«å‚ç…§ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ãŒã€v0.10.0ã§ã¯æ˜ç¤ºçš„ãªå‹å®£è¨€ã‚’ã‚µãƒãƒ¼ãƒˆäºˆå®šï¼š

```cb
// v0.9.2ï¼ˆç¾åœ¨ï¼‰: è‡ªå‹•çš„ã«å‚ç…§æ¸¡ã—
void modify(int[3] arr) { ... }

// v0.10.0ï¼ˆäºˆå®šï¼‰: æ˜ç¤ºçš„ãªå‚ç…§å‹å®£è¨€
void modify(int[3]& arr) { ... }
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- å‹å®‰å…¨æ€§ã®å‘ä¸Š
- æ„å›³ãŒã‚³ãƒ¼ãƒ‰ã‹ã‚‰æ˜ç¢ºã«ãªã‚‹
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚ˆã‚‹å‹ãƒã‚§ãƒƒã‚¯ã®å¼·åŒ–

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `release_notes/v0.9.2.md` - v0.9.2ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ
- `docs/spec.md` - è¨€èªä»•æ§˜æ›¸ï¼ˆå‚ç…§å‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- `docs/todo/v0.10.0_implementation_plan.md` - v0.10.0å®Ÿè£…è¨ˆç”»
- `src/backend/interpreter/managers/variables/manager.cpp` - å®Ÿè£…ã‚³ãƒ¼ãƒ‰

---

## âœ… æ¤œè¨¼å®Œäº†

**æ—¥æ™‚**: 2025å¹´10æœˆ10æ—¥  
**æ¤œè¨¼é …ç›®**: 4ç¨®é¡ã®é…åˆ—å‹  
**çµæœ**: ã™ã¹ã¦å‚ç…§æ¸¡ã—ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª âœ…  
**å®Ÿè£…**: ã‚³ãƒŸãƒƒãƒˆ `e1a0431` ã§å®Ÿè£…æ¸ˆã¿

---

**ã“ã®æ¤œè¨¼ã«ã‚ˆã‚Šã€Cbè¨€èªã®é…åˆ—å¼•æ•°ãŒC/C++ã¨åŒæ§˜ã«å‚ç…§ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚**
