# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°å®Ÿè£…è¨ˆç”»

**ä½œæˆæ—¥**: 2025å¹´10æœˆ9æ—¥  
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.10.0  
**å„ªå…ˆåº¦**: ğŸ”´ é«˜

---

## ğŸ“‹ æ¦‚è¦

é–¢æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã—ã€å‘¼ã³å‡ºã—æ™‚ã«å¼•æ•°ã‚’çœç•¥å¯èƒ½ã«ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

---

## ğŸ¯ ç›®çš„

1. **é–¢æ•°å‘¼ã³å‡ºã—ã®æŸ”è»Ÿæ€§å‘ä¸Š**: é »ç¹ã«ä½¿ã†å€¤ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦è¨­å®š
2. **APIè¨­è¨ˆã®æ”¹å–„**: å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¡ãªãŒã‚‰æ©Ÿèƒ½æ‹¡å¼µãŒå¯èƒ½
3. **ã‚³ãƒ¼ãƒ‰ã®ç°¡æ½”åŒ–**: åŒã˜å€¤ã‚’ç¹°ã‚Šè¿”ã—æŒ‡å®šã™ã‚‹å¿…è¦ãŒãªããªã‚‹

---

## ğŸ“ åŸºæœ¬ä»•æ§˜

### æ§‹æ–‡

```cb
func int add(int a, int b = 10, int c = 20) {
    return a + b + c;
}

void main() {
    println(add(1));        // 1 + 10 + 20 = 31
    println(add(1, 2));     // 1 + 2 + 20 = 23
    println(add(1, 2, 3));  // 1 + 2 + 3 = 6
}
```

### åˆ¶ç´„

1. **å³å´ã‹ã‚‰é€£ç¶š**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã¯å³å´ã‹ã‚‰é€£ç¶šã—ã¦æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹
   ```cb
   // âœ… æ­£ã—ã„
   func void f1(int a, int b = 1, int c = 2);
   
   // âŒ ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã®å¾Œã«éãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°
   func void f2(int a = 1, int b, int c = 2);
   
   // âŒ ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ãŒé€£ç¶šã—ã¦ã„ãªã„
   func void f3(int a = 1, int b, int c);
   ```

2. **å®šæ•°å¼ã®ã¿**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯å®šæ•°å¼ï¼ˆãƒªãƒ†ãƒ©ãƒ«ã€å®šæ•°å¤‰æ•°ï¼‰ã®ã¿
   ```cb
   const int DEFAULT_SIZE = 10;
   
   // âœ… æ­£ã—ã„
   func void f1(int size = 10);
   func void f2(int size = DEFAULT_SIZE);
   func void f3(string name = "default");
   
   // âŒ ã‚¨ãƒ©ãƒ¼: å¤‰æ•°ã‚’ä½¿ç”¨
   int x = 10;
   func void f4(int size = x);
   
   // âŒ ã‚¨ãƒ©ãƒ¼: é–¢æ•°å‘¼ã³å‡ºã—
   func void f5(int size = get_size());
   ```

3. **ã‚¹ã‚­ãƒƒãƒ—ä¸å¯**: ä¸­é–“ã®å¼•æ•°ã‚’ã‚¹ã‚­ãƒƒãƒ—ã§ããªã„
   ```cb
   func void draw(int x = 0, int y = 0, int color = 255);
   
   // âœ… æ­£ã—ã„
   draw();
   draw(10);
   draw(10, 20);
   draw(10, 20, 128);
   
   // âŒ ã‚¨ãƒ©ãƒ¼: å¼•æ•°ã®ã‚¹ã‚­ãƒƒãƒ—
   draw(10, , 128);  // y ã‚’ã‚¹ã‚­ãƒƒãƒ—ã§ããªã„
   ```

4. **å‹ä¸€è‡´**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å‹ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹ã¨ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
   ```cb
   // âœ… æ­£ã—ã„
   func void f1(int x = 10);
   func void f2(string s = "hello");
   
   // âŒ ã‚¨ãƒ©ãƒ¼: å‹ä¸ä¸€è‡´
   func void f3(int x = "hello");
   func void f4(string s = 123);
   ```

---

## ğŸ”§ å®Ÿè£…è¦ä»¶

### 1. æ§‹æ–‡æ‹¡å¼µ

**Parser**:
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®£è¨€ã§ `= å¼` ã‚’è§£æ
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ä½ç½®æ¤œè¨¼ï¼ˆå³å´ã‹ã‚‰é€£ç¶šï¼‰

**ASTæ‹¡å¼µ**:
```cpp
struct Parameter {
    std::string name;
    TypeInfo type;
    std::unique_ptr<ExpressionNode> default_value;  // NEW: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    bool has_default;  // NEW: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒã‚ã‚‹ã‹
};

struct FunctionDef {
    std::string name;
    std::vector<Parameter> parameters;
    int first_default_param_index;  // NEW: æœ€åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    // ...
};
```

### 2. é–¢æ•°å®šç¾©ã®æ¤œè¨¼

**æ¤œè¨¼é …ç›®**:
1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ãŒå³å´ã‹ã‚‰é€£ç¶šã—ã¦ã„ã‚‹ã‹
2. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒå®šæ•°å¼ã‹
3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å‹ãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‹ã¨ä¸€è‡´ã™ã‚‹ã‹

**å®Ÿè£…ä¾‹**:
```cpp
void TypeChecker::validate_function_definition(FunctionDef* func) {
    bool found_default = false;
    
    for (size_t i = 0; i < func->parameters.size(); i++) {
        auto& param = func->parameters[i];
        
        if (param.has_default) {
            found_default = true;
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å‹ãƒã‚§ãƒƒã‚¯
            auto default_type = infer_type(param.default_value.get());
            if (default_type != param.type) {
                throw std::runtime_error(
                    "Default value type mismatch for parameter: " + param.name
                );
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒå®šæ•°å¼ã‹ç¢ºèª
            if (!is_constant_expression(param.default_value.get())) {
                throw std::runtime_error(
                    "Default value must be a constant expression"
                );
            }
        } else if (found_default) {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã®å¾Œã«éãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°
            throw std::runtime_error(
                "Non-default parameter after default parameter: " + param.name
            );
        }
    }
}
```

### 3. é–¢æ•°å‘¼ã³å‡ºã—ã®å¼•æ•°è£œå®Œ

**è£œå®Œãƒ­ã‚¸ãƒƒã‚¯**:
```cpp
void Interpreter::call_function(FunctionCallNode* call) {
    FunctionDef* func = find_function(call->function_name);
    
    // å¼•æ•°æ•°ã®æ¤œè¨¼
    size_t provided_args = call->arguments.size();
    size_t required_args = func->first_default_param_index;
    size_t total_params = func->parameters.size();
    
    if (provided_args < required_args || provided_args > total_params) {
        throw std::runtime_error("Invalid number of arguments");
    }
    
    // å¼•æ•°ãƒªã‚¹ãƒˆã‚’æ§‹ç¯‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§è£œå®Œï¼‰
    std::vector<int64_t> actual_args;
    
    for (size_t i = 0; i < total_params; i++) {
        if (i < provided_args) {
            // æä¾›ã•ã‚ŒãŸå¼•æ•°ã‚’è©•ä¾¡
            actual_args.push_back(evaluate(call->arguments[i].get()));
        } else {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è©•ä¾¡
            actual_args.push_back(evaluate(func->parameters[i].default_value.get()));
        }
    }
    
    // é–¢æ•°ã‚’å®Ÿè¡Œ
    execute_function(func, actual_args);
}
```

### 4. å‹ãƒã‚§ãƒƒã‚¯

**å®šæ•°å¼ã®åˆ¤å®š**:
```cpp
bool is_constant_expression(ExpressionNode* expr) {
    switch (expr->type) {
    case NodeType::INTEGER_LITERAL:
    case NodeType::FLOAT_LITERAL:
    case NodeType::STRING_LITERAL:
    case NodeType::BOOLEAN_LITERAL:
    case NodeType::NULLPTR_LITERAL:
        return true;
    
    case NodeType::IDENTIFIER:
        // constå¤‰æ•°ã®å‚ç…§ã¯è¨±å¯
        Variable* var = find_variable(expr->name);
        return var && var->is_const;
    
    case NodeType::BINARY_EXPRESSION:
        // ä¸¡è¾ºãŒå®šæ•°å¼ãªã‚‰å®šæ•°å¼
        return is_constant_expression(expr->left.get()) &&
               is_constant_expression(expr->right.get());
    
    default:
        return false;
    }
}
```

---

## ğŸ“Š å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Phase 1: æ§‹æ–‡è§£æï¼ˆ1é€±é–“ï¼‰
- [ ] Parseræ‹¡å¼µ: `= å¼` ã®è§£æ
- [ ] ASTæ§‹é€ ã®æ‹¡å¼µ
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ä½ç½®æ¤œè¨¼

### Phase 2: å‹ãƒã‚§ãƒƒã‚¯ï¼ˆ1é€±é–“ï¼‰
- [ ] å®šæ•°å¼ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å‹ãƒã‚§ãƒƒã‚¯
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®Ÿè£…

### Phase 3: å®Ÿè¡Œæ™‚å‡¦ç†ï¼ˆ1é€±é–“ï¼‰
- [ ] å¼•æ•°è£œå®Œãƒ­ã‚¸ãƒƒã‚¯
- [ ] é–¢æ•°å‘¼ã³å‡ºã—ã®ä¿®æ­£
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è©•ä¾¡

### Phase 4: ãƒ†ã‚¹ãƒˆã¨æ¤œè¨¼ï¼ˆ1é€±é–“ï¼‰
- [ ] åŸºæœ¬çš„ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 1. åŸºæœ¬çš„ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°
```cb
func int add(int a, int b = 10, int c = 20) {
    return a + b + c;
}

void main() {
    assert(add(1) == 31);
    assert(add(1, 2) == 23);
    assert(add(1, 2, 3) == 6);
}
```

### 2. æ§˜ã€…ãªå‹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
```cb
func void test(
    int n = 42,
    float f = 3.14,
    string s = "hello",
    bool b = true
) {
    println(n);
    println(f);
    println(s);
    println(b);
}

void main() {
    test();              // ã™ã¹ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    test(100);           // n ã®ã¿æŒ‡å®š
    test(100, 2.71);     // n, f ã‚’æŒ‡å®š
}
```

### 3. constå®šæ•°ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ä½¿ç”¨
```cb
const int DEFAULT_WIDTH = 800;
const int DEFAULT_HEIGHT = 600;

func void create_window(int w = DEFAULT_WIDTH, int h = DEFAULT_HEIGHT) {
    println("Window size: " + w + "x" + h);
}

void main() {
    create_window();           // 800x600
    create_window(1024);       // 1024x600
    create_window(1024, 768);  // 1024x768
}
```

### 4. æ§‹é€ ä½“ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°
```cb
struct Point {
    int x;
    int y;
};

impl Point {
    Point(int px = 0, int py = 0) {
        this.x = px;
        this.y = py;
    }
}

void main() {
    Point p1;              // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ä½¿ç”¨
    Point p2(10);          // px=10, py=0
    Point p3(10, 20);      // px=10, py=20
    
    assert(p1.x == 0 && p1.y == 0);
    assert(p2.x == 10 && p2.y == 0);
    assert(p3.x == 10 && p3.y == 20);
}
```

### 5. ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹
```cb
// ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã®å¾Œã«éãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°
func void error1(int a = 1, int b);  // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼

// ã‚¨ãƒ©ãƒ¼: å¤‰æ•°ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ä½¿ç”¨
int x = 10;
func void error2(int n = x);  // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼

// ã‚¨ãƒ©ãƒ¼: å‹ä¸ä¸€è‡´
func void error3(int n = "hello");  // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼

// ã‚¨ãƒ©ãƒ¼: å¼•æ•°æ•°ä¸è¶³
func int add(int a, int b = 10) { return a + b; }
void main() {
    add();  // ã‚¨ãƒ©ãƒ¼: å¿…é ˆå¼•æ•° a ãŒä¸è¶³
}
```

---

## ğŸ”— é–¢é€£æ©Ÿèƒ½

### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ã®çµ±åˆ

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã‚‚ä½¿ç”¨å¯èƒ½:

```cb
struct Rectangle {
    int width;
    int height;
};

impl Rectangle {
    Rectangle(int w = 100, int h = 100) {
        this.width = w;
        this.height = h;
    }
}

void main() {
    Rectangle r1;           // 100x100
    Rectangle r2(200);      // 200x100
    Rectangle r3(200, 150); // 200x150
}
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯æ¯å›è©•ä¾¡ã•ã‚Œã‚‹ï¼ˆå®šæ•°ã§ã‚‚ï¼‰
2. **ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰**: ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¨çµ„ã¿åˆã‚ã›ãŸå ´åˆã®æ›–æ˜§æ€§
3. **é–¢æ•°ãƒã‚¤ãƒ³ã‚¿**: é–¢æ•°ãƒã‚¤ãƒ³ã‚¿å‹ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°æƒ…å ±ã‚’å«ã‚ã‚‹ã‹

---

## ğŸ”„ å°†æ¥ã®æ‹¡å¼µ

1. **åå‰ä»˜ãå¼•æ•°**: `draw(x: 10, color: 255)` ã®ã‚ˆã†ã«æŒ‡å®š
2. **å¯å¤‰é•·å¼•æ•°ã¨ã®çµ„ã¿åˆã‚ã›**: `func void log(string msg, ...args)`
3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å¼**: ã‚ˆã‚Šè¤‡é›‘ãªå¼ã‚’è¨±å¯

---

**æ›´æ–°å±¥æ­´**:
- 2025/10/09: åˆç‰ˆä½œæˆ
