# v0.12.0 æœªå®Ÿè£…é …ç›®ã‚µãƒãƒªãƒ¼

**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ27æ—¥  
**ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.11.0  
**æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.12.0

---

## ğŸ¯ v0.12.0 ã§ã®å®Ÿè£…ç›®æ¨™

### æœ€å„ªå…ˆ: ãƒ ãƒ¼ãƒ–ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®å®Œå…¨å®Ÿè£…

v0.10.0ã§æ§‹æ–‡ãƒ¬ãƒ™ãƒ«ã®å®Ÿè£…ã‚’å®Œäº†ã—ãŸãƒ ãƒ¼ãƒ–ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’ã€å®Ÿç”¨ãƒ¬ãƒ™ãƒ«ã¾ã§å¼•ãä¸Šã’ã‚‹ã€‚

---

## ğŸ“‹ æœªå®Ÿè£…æ©Ÿèƒ½ä¸€è¦§

### 1. ãƒ ãƒ¼ãƒ–ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹é–¢é€£ï¼ˆv0.10.1ã‹ã‚‰ç¹°ã‚Šè¶Šã—ï¼‰

#### 1.1 returnæ–‡ã§ã®è‡ªå‹•ãƒ ãƒ¼ãƒ– (NRVO)
**å„ªå…ˆåº¦**: ğŸ”´ æœ€å„ªå…ˆ  
**æ¨å®šå·¥æ•°**: 1é€±é–“

```cb
// ç¾åœ¨ï¼ˆæ˜ç¤ºçš„ãªmove()ãŒå¿…è¦ï¼‰
Point create_point() {
    Point p(10, 20);
    return move(p);  // â† move()ãŒå¿…é ˆ
}

// ç›®æ¨™ï¼ˆè‡ªå‹•ãƒ ãƒ¼ãƒ–ï¼‰
Point create_point() {
    Point p(10, 20);
    return p;  // â† è‡ªå‹•çš„ã«ãƒ ãƒ¼ãƒ–ã•ã‚Œã‚‹
}
```

**å®Ÿè£…ç®‡æ‰€**:
- `src/backend/interpreter/handlers/control/return.cpp`
- `src/backend/interpreter/core/interpreter.cpp`

**å®Ÿè£…å†…å®¹**:
- ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã®æ¤œå‡º
- ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®æœ‰ç„¡ç¢ºèª
- Named Return Value Optimization (NRVO)
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆã‚³ãƒ”ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼‰

---

#### 1.2 ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­
**å„ªå…ˆåº¦**: ğŸ”´ æœ€å„ªå…ˆ  
**æ¨å®šå·¥æ•°**: 1é€±é–“

```cb
struct Resource {
    int* data;
    
    // ã‚³ãƒ”ãƒ¼ä»£å…¥æ¼”ç®—å­ï¼ˆæ—¢å­˜ï¼‰
    self& operator=(const Resource& other) { /* ... */ }
    
    // ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­ï¼ˆæœªå®Ÿè£…ï¼‰
    self& operator=(Resource&& other) {
        if (self.data != nullptr) {
            free(self.data);
        }
        self.data = other.data;
        other.data = nullptr;
        return self;
    }
}

void main() {
    Resource r1(100);
    Resource r2(200);
    r1 = move(r2);  // â† ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­ã‚’å‘¼ã¶
}
```

**å®Ÿè£…ç®‡æ‰€**:
- `src/frontend/recursive_parser/parsers/interface_parser.cpp`
- `src/backend/interpreter/executors/assignments/*.cpp`
- `src/backend/interpreter/managers/variables/assignment.cpp`

**å®Ÿè£…å†…å®¹**:
- `operator=(T&&)` æ§‹æ–‡ã®ãƒ‘ãƒ¼ã‚¹
- å³è¾ºå€¤/å·¦è¾ºå€¤ã«ã‚ˆã‚‹ä»£å…¥æ¼”ç®—å­ã®é¸æŠ
- è‡ªå·±ä»£å…¥ãƒã‚§ãƒƒã‚¯

---

#### 1.3 å³è¾ºå€¤ã®è‡ªå‹•æ¤œå‡º
**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜  
**æ¨å®šå·¥æ•°**: 1é€±é–“

```cb
Point create_point() {
    return Point(10, 20);
}

void main() {
    // ä¸€æ™‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯è‡ªå‹•çš„ã«rvalueã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹
    Point p1 = create_point();  // â† è‡ªå‹•çš„ã«ãƒ ãƒ¼ãƒ–
    
    Point p2(30, 40);
    Point p3 = p2;              // â† lvalue ãªã®ã§ã‚³ãƒ”ãƒ¼
}
```

**å®Ÿè£…ç®‡æ‰€**:
- `src/common/ast.h` (å€¤ã‚«ãƒ†ã‚´ãƒªã®è¿½åŠ )
- `src/backend/interpreter/evaluator/core/*.cpp`
- `src/backend/interpreter/managers/variables/*.cpp`

**å®Ÿè£…å†…å®¹**:
- å€¤ã‚«ãƒ†ã‚´ãƒªï¼ˆlvalue/xvalue/prvalueï¼‰ã®è¿½è·¡
- ASTãƒãƒ¼ãƒ‰ã¸ã®å€¤ã‚«ãƒ†ã‚´ãƒªæƒ…å ±ä»˜åŠ 
- ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é¸æŠæ™‚ã®å€¤ã‚«ãƒ†ã‚´ãƒªå‚ç…§
- ã‚³ãƒ”ãƒ¼çœç•¥ï¼ˆCopy Elisionï¼‰

---

### 2. å‚ç…§ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰

#### 2.1 å‚ç…§ãƒãƒƒãƒ—ã®å®Ÿè£…
**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜  
**æ¨å®šå·¥æ•°**: 3æ—¥

```cb
Point p1;
Point&& ref1 = p1;
ref1.x = 100;        // â† p1.x ãŒæ›´æ–°ã•ã‚Œã‚‹ã¹ãï¼ˆç¾åœ¨ã¯æœªå¯¾å¿œï¼‰
```

**å®Ÿè£…å†…å®¹**:
- `Interpreter::reference_maps_` ã®è¿½åŠ 
- `resolve_reference()` ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- ã‚¹ã‚³ãƒ¼ãƒ—ã”ã¨ã®å‚ç…§ãƒãƒƒãƒ—ç®¡ç†

---

#### 2.2 ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚¯ã‚»ã‚¹/ä»£å…¥ã§ã®å‚ç…§è§£æ±º
**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜  
**æ¨å®šå·¥æ•°**: 2æ—¥

```cb
Point p;
Point&& ref = p;
ref.x = 10;      // â† å‚ç…§å…ˆ (p.x) ã‚’æ›´æ–°
println(p.x);    // â† 10 ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¹ã
```

**å®Ÿè£…ç®‡æ‰€**:
- `src/backend/interpreter/evaluator/access/member.cpp`
- `src/backend/interpreter/executors/assignments/member_assignment.cpp`

---

#### 2.3 å‚ç…§ã®ã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°
**å„ªå…ˆåº¦**: ğŸŸ¢ ä¸­  
**æ¨å®šå·¥æ•°**: 1æ—¥

```cb
Point p1;
Point&& ref1 = p1;
Point&& ref2 = ref1;  // â† ref2ã¯ ref1 ã§ã¯ãªã p1 ã‚’å‚ç…§ã™ã¹ã
```

---

### 3. ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿/ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰

#### 3.1 ã‚³ãƒ”ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®è‡ªå‹•ç”Ÿæˆ
**å„ªå…ˆåº¦**: ğŸŸ¢ ä¸­  
**æ¨å®šå·¥æ•°**: 3æ—¥

```cb
struct Point {
    int x, y;
    
    // ã‚³ãƒ”ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒæœªå®šç¾©ã®å ´åˆã€è‡ªå‹•ç”Ÿæˆ
}

Point p1;
p1.x = 10;
Point p2 = p1;  // â† ã‚³ãƒ”ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è‡ªå‹•å‘¼ã³å‡ºã—
```

---

#### 3.2 ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å®Ÿè£…
**å„ªå…ˆåº¦**: ğŸŸ¢ ä¸­  
**æ¨å®šå·¥æ•°**: 3æ—¥

```cb
struct Resource {
    int* data;
    
    Resource(Resource&& other) {
        self.data = other.data;
        other.data = nullptr;  // â† å…ƒã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ç„¡åŠ¹åŒ–
    }
}
```

---

#### 3.3 ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®è‡ªå‹•å‘¼ã³å‡ºã—å¼·åŒ–
**å„ªå…ˆåº¦**: ğŸŸ¢ ä¸­  
**æ¨å®šå·¥æ•°**: 2æ—¥

```cb
void test() {
    Resource r1;
    if (condition) {
        Resource r2;
        return;  // â† r2, r1 ã®ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‘¼ã¶ã¹ã
    }
}
```

**å¯¾å¿œç®‡æ‰€**:
- returnæ–‡
- breakæ–‡
- continueæ–‡

---

### 4. ãã®ä»–ã®æ©Ÿèƒ½ï¼ˆä½å„ªå…ˆåº¦ï¼‰

#### 4.1 åˆæœŸåŒ–ãƒªã‚¹ãƒˆæ§‹æ–‡
**å„ªå…ˆåº¦**: ğŸŸ£ ä½  
**æ¨å®šå·¥æ•°**: 1é€±é–“

```cb
struct Point {
    int x, y;
    
    Point(int x_, int y_) : x(x_), y(y_) {  // â† åˆæœŸåŒ–ãƒªã‚¹ãƒˆ
        // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æœ¬ä½“
    }
}
```

---

#### 4.2 ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°
**å„ªå…ˆåº¦**: ğŸŸ£ ä½  
**æ¨å®šå·¥æ•°**: 3æ—¥

```cb
void foo(int x = 10) {  // â† ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°
    println(x);
}

foo();     // x = 10
foo(20);   // x = 20
```

---

#### 4.3 é–¢æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰
**å„ªå…ˆåº¦**: ğŸŸ£ ä½  
**æ¨å®šå·¥æ•°**: 1é€±é–“

```cb
void println(string message);
void println(int value);
void println(double value);
```

---

#### 4.4 æ¼”ç®—å­ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰
**å„ªå…ˆåº¦**: ğŸŸ£ ä½  
**æ¨å®šå·¥æ•°**: 2é€±é–“

```cb
struct Point {
    int x, y;
    
    Point operator+(Point& other) {
        Point result;
        result.x = self.x + other.x;
        result.y = self.y + other.y;
        return result;
    }
}
```

---

#### 4.5 constexpr
**å„ªå…ˆåº¦**: ğŸŸ£ ä½  
**æ¨å®šå·¥æ•°**: 1é€±é–“

```cb
constexpr int BUFFER_SIZE = 1024;
constexpr int square(int x) {
    return x * x;
}
```

---

## ğŸ“Š v0.12.0 å®Ÿè£…è¨ˆç”»

### Phase 1: ãƒ ãƒ¼ãƒ–ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆ4é€±é–“ï¼‰

#### Week 1: returnæ–‡ã§ã®è‡ªå‹•ãƒ ãƒ¼ãƒ–
- [ ] returnæ–‡ã®è§£æå¼·åŒ–
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã®æ¤œå‡º
- [ ] NRVOå®Ÿè£…
- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ

#### Week 2: ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­
- [ ] æ§‹æ–‡è§£æ
- [ ] ä»£å…¥å‡¦ç†ã®åˆ†å²
- [ ] è‡ªå·±ä»£å…¥ãƒã‚§ãƒƒã‚¯
- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ

#### Week 3: å³è¾ºå€¤ã®è‡ªå‹•æ¤œå‡º
- [ ] å€¤ã‚«ãƒ†ã‚´ãƒªã®è¨­è¨ˆ
- [ ] ASTãƒãƒ¼ãƒ‰ã¸ã®æƒ…å ±ä»˜åŠ 
- [ ] è©•ä¾¡å™¨ã®ä¿®æ­£
- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ

#### Week 4: çµ±åˆã¨ãƒ†ã‚¹ãƒˆ
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆã®äº’æ›æ€§ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

---

### Phase 2ä»¥é™: ãã®ä»–ã®æ©Ÿèƒ½ï¼ˆv0.13.0ä»¥é™ï¼‰

å‚ç…§ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿/ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼·åŒ–ã¯æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè£…äºˆå®šã€‚

---

## ğŸ¯ æˆåŠŸåŸºæº–

### v0.12.0
1. âœ… å…¨3,211ãƒ†ã‚¹ãƒˆãŒå¼•ãç¶šã PASS
2. âœ… returnæ–‡ã§ã®è‡ªå‹•ãƒ ãƒ¼ãƒ–ãŒå‹•ä½œ
3. âœ… ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­ãŒå®Ÿè£…ã•ã‚Œã‚‹
4. âœ… å³è¾ºå€¤ã®è‡ªå‹•æ¤œå‡ºãŒå‹•ä½œ
5. âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãŒ10%ä»¥å†…
6. âœ… ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãªã—

---

## ğŸ“š å‚è€ƒè³‡æ–™

### C++æ¨™æº–
- [Value categories (cppreference)](https://en.cppreference.com/w/cpp/language/value_category)
- [Copy elision (cppreference)](https://en.cppreference.com/w/cpp/language/copy_elision)
- [Move assignment (cppreference)](https://en.cppreference.com/w/cpp/language/move_assignment)

### è¨­è¨ˆç›®æ¨™
1. C++ã¨ã®äº’æ›æ€§ã‚’æœ€å¤§åŒ–
2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–
3. ä½¿ã„ã‚„ã™ã•ã¨å®‰å…¨æ€§ã®ãƒãƒ©ãƒ³ã‚¹

---

## ğŸ”š ã¾ã¨ã‚

v0.11.0ã§ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã¨æ–‡å­—åˆ—è£œé–“ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚  
v0.12.0ã§ã¯ã€v0.10.1ã‹ã‚‰ç¹°ã‚Šè¶Šã—ãŸãƒ ãƒ¼ãƒ–ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®å®Œå…¨å®Ÿè£…ã«é›†ä¸­ã—ã¾ã™ã€‚

**æœ€é‡è¦é …ç›®**:
1. returnæ–‡ã§ã®è‡ªå‹•ãƒ ãƒ¼ãƒ–ï¼ˆNRVOï¼‰
2. ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­
3. å³è¾ºå€¤ã®è‡ªå‹•æ¤œå‡º

ã“ã‚Œã‚‰ã«ã‚ˆã‚Šã€Cbè¨€èªã¯C++ã«åŒ¹æ•µã™ã‚‹åŠ¹ç‡çš„ãªãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥  
**ä½œæˆè€…**: shadowlink0122
