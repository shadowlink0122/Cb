<section class="left-align">
  <h2>Event Loop - 協調的スケジューリング</h2>
  <div style="display: flex; gap: 1.5em; width: 95%; margin: 0.3em auto 0">
    <div style="flex: 1">
      <h3 style="font-size: 0.8em; margin-bottom: 0.25em">アーキテクチャ</h3>
      <ul style="font-size: 0.63em; line-height: 1.3; margin: 0 0 0.5em 0; padding-left: 1.3em">
        <li>Event Loop: タスクキューで管理</li>
        <li>Future&lt;T&gt;: 非同期タスクを表現</li>
        <li>await: 協調的に制御を譲渡</li>
        <li>タスクの優先度管理</li>
        <li>タイムアウト処理</li>
      </ul>
      <h3 style="font-size: 0.8em; margin-bottom: 0.25em">特徴</h3>
      <ul style="font-size: 0.63em; line-height: 1.3; margin: 0; padding-left: 1.3em">
        <li>シングルスレッド、軽量</li>
        <li>Python asyncio/JS風</li>
        <li>デッドロックなし</li>
        <li>予測可能な実行順序</li>
      </ul>
    </div>
    <div style="flex: 1">
      <h3 style="font-size: 0.8em; margin-bottom: 0.25em">簡略化した実装</h3>
      <pre style="font-size: 0.45em; margin: 0.3em 0"><code class="language-cpp" data-trim data-noescape>
<span style="color: #c586c0; font-weight: bold;">class</span> <span style="color: #4ec9b0;">SimpleEventLoop</span> {
    std::<span style="color: #4ec9b0;">deque</span>&lt;<span style="color: #4ec9b0;">Task</span>&gt; task_queue;
    std::<span style="color: #4ec9b0;">map</span>&lt;<span style="color: #4ec9b0;">int</span>, <span style="color: #4ec9b0;">Future</span>*&gt; futures;

    <span style="color: #4ec9b0;">void</span> run() {
        <span style="color: #c586c0; font-weight: bold;">while</span> (!task_queue.empty()) {
            <span style="color: #4ec9b0;">Task</span> task = task_queue.front();
            task_queue.pop_front();

            <span style="color: #c586c0; font-weight: bold;">if</span> (task.is_waiting) {
                <span style="color: #c586c0; font-weight: bold;">if</span> (current_time() >=
                    task.wake_time) {
                    execute_task(task);
                } <span style="color: #c586c0; font-weight: bold;">else</span> {
                    <span style="color: #6a9955;">// まだ待機中</span>
                    task_queue.push_back(task);
                }
            } <span style="color: #c586c0; font-weight: bold;">else</span> {
                execute_task(task);
            }
        }
    }
};
                        </code></pre>
    </div>
  </div>
</section>
