<section class="left-align">
  <h2>async/awaitパターン 3: エラーハンドリング</h2>
  <div style="width: 95%; margin: 0.5em auto 0">
    <pre style="font-size: 0.42em; margin: 0.3em 0"><code class="language-cpp" data-trim data-noescape><span style="color: #6a9955;">// Result型で型安全なエラーハンドリング</span>
<span style="color: #c586c0; font-weight: bold;">async</span> <span style="color: #4ec9b0;">Result</span>&lt;<span style="color: #4ec9b0;">int</span>, <span style="color: #4ec9b0;">string</span>&gt; divide_async(<span style="color: #4ec9b0;">int</span> a, <span style="color: #4ec9b0;">int</span> b) {
    <span style="color: #c586c0; font-weight: bold;">await</span> sleep(<span style="color: #b5cea8;">100</span>);
    <span style="color: #c586c0; font-weight: bold;">if</span> (b == <span style="color: #b5cea8;">0</span>) {
        <span style="color: #c586c0; font-weight: bold;">return</span> <span style="color: #4ec9b0;">Result</span>&lt;<span style="color: #4ec9b0;">int</span>, <span style="color: #4ec9b0;">string</span>&gt;::<span style="color: #4ec9b0;">Err</span>(<span style="color: #ce9178;">"Division by zero"</span>);
    }
    <span style="color: #c586c0; font-weight: bold;">return</span> <span style="color: #4ec9b0;">Result</span>&lt;<span style="color: #4ec9b0;">int</span>, <span style="color: #4ec9b0;">string</span>&gt;::<span style="color: #4ec9b0;">Ok</span>(a / b);
}

<span style="color: #c586c0; font-weight: bold;">async</span> <span style="color: #4ec9b0;">void</span> calculate_all() {
    <span style="color: #6a9955;">// 成功ケース</span>
    <span style="color: #4ec9b0;">Result</span>&lt;<span style="color: #4ec9b0;">int</span>, <span style="color: #4ec9b0;">string</span>&gt; r1 = <span style="color: #c586c0; font-weight: bold;">await</span> divide_async(<span style="color: #b5cea8;">10</span>, <span style="color: #b5cea8;">2</span>);
    <span style="color: #c586c0; font-weight: bold;">match</span> (r1) {
        <span style="color: #4ec9b0;">Ok</span>(value) => println(<span style="color: #ce9178;">"Result 1: {value}"</span>),  <span style="color: #6a9955;">// 5</span>
        <span style="color: #4ec9b0;">Err</span>(msg) => println(<span style="color: #ce9178;">"Error 1: {msg}"</span>)
    }
    
    <span style="color: #6a9955;">// エラーケース</span>
    <span style="color: #4ec9b0;">Result</span>&lt;<span style="color: #4ec9b0;">int</span>, <span style="color: #4ec9b0;">string</span>&gt; r2 = <span style="color: #c586c0; font-weight: bold;">await</span> divide_async(<span style="color: #b5cea8;">20</span>, <span style="color: #b5cea8;">0</span>);
    <span style="color: #c586c0; font-weight: bold;">match</span> (r2) {
        <span style="color: #4ec9b0;">Ok</span>(value) => println(<span style="color: #ce9178;">"Result 2: {value}"</span>),
        <span style="color: #4ec9b0;">Err</span>(msg) => println(<span style="color: #ce9178;">"Error 2: {msg}"</span>)  <span style="color: #6a9955;">// Division by zero</span>
    }
}

<span style="color: #4ec9b0;">void</span> main() {
    calculate_all();
}</code></pre>
    <p style="font-size: 0.65em; margin-top: 0.5em">
      <strong class="highlight">v0.13.0の革新</strong>
      : async/awaitとResult型の統合で型安全な非同期エラーハンドリング
    </p>
  </div>
</section>
