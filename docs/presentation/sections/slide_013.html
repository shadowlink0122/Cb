<section class="left-align">
  <h2>リソース管理 - コンストラクタ/デストラクタ/defer</h2>
  <div style="display: flex; gap: 1em; width: 95%; margin: 0.3em auto 0">
    <div style="flex: 1">
      <h3 style="font-size: 0.75em; margin-bottom: 0.2em">コンストラクタ/デストラクタ（C++/Rust）</h3>
      <pre
        style="font-size: 0.42em; margin: 0.3em 0"
      ><code class="language-cpp" data-trim data-noescape><span style="color: #c586c0; font-weight: bold;">struct</span> <span style="color: #4ec9b0;">Resource</span> {
    <span style="color: #4ec9b0;">int</span> id;
}
<span style="color: #c586c0; font-weight: bold;">impl</span> <span style="color: #4ec9b0;">Resource</span> {
    <span style="color: #6a9955;">// コンストラクタ</span>
    self(<span style="color: #4ec9b0;">int</span> resource_id) {
        self.<span style="color: #dcdcaa;">id</span> = resource_id;
        println(<span style="color: #ce9178;">"Resource {resource_id} acquired"</span>);
    }
    <span style="color: #6a9955;">// デストラクタ（RAII）</span>
    ~self() {
        println(<span style="color: #ce9178;">"Resource {self.<span style="color: #dcdcaa;">id</span>} released"</span>);
    }
}
<span style="color: #4ec9b0;">void</span> main() {
    <span style="color: #4ec9b0;">Resource</span> r1(<span style="color: #b5cea8;">1</span>);
    <span style="color: #4ec9b0;">Resource</span> r2(<span style="color: #b5cea8;">2</span>);
    println(<span style="color: #ce9178;">"Using resources"</span>);
    <span style="color: #6a9955;">// スコープ終了で自動的に</span>
    <span style="color: #6a9955;">// r2, r1の順でデストラクタ実行</span>
}</code></pre>
    </div>
    <div style="flex: 1">
      <h3 style="font-size: 0.75em; margin-bottom: 0.2em">defer（Go風）</h3>
      <pre style="font-size: 0.42em; margin: 0.3em 0"><code class="language-cpp" data-trim data-noescape>
<span style="color: #4ec9b0;">void</span> process_file() {
    <span style="color: #4ec9b0;">File</span>* f = open(<span style="color: #ce9178;">"data.txt"</span>);
    <span style="color: #c586c0; font-weight: bold;">defer</span> close(f);  <span style="color: #6a9955;">// スコープ終了時に実行</span>
    
    <span style="color: #c586c0; font-weight: bold;">defer</span> println(<span style="color: #ce9178;">"処理完了"</span>);
    <span style="color: #c586c0; font-weight: bold;">defer</span> println(<span style="color: #ce9178;">"ファイルクローズ"</span>);
    
    println(<span style="color: #ce9178;">"ファイル処理中"</span>);
    <span style="color: #6a9955;">// 複雑な処理...</span>
    
    <span style="color: #6a9955;">// スコープ終了時に逆順で実行:</span>
    <span style="color: #6a9955;">// 1. println("ファイルクローズ")</span>
    <span style="color: #6a9955;">// 2. println("処理完了")</span>
    <span style="color: #6a9955;">// 3. close(f)</span>
}

<span style="color: #4ec9b0;">void</span> main() {
    process_file();
}
<span style="color: #6a9955;">// 出力:</span>
<span style="color: #6a9955;">// ファイル処理中</span>
<span style="color: #6a9955;">// ファイルクローズ</span>
<span style="color: #6a9955;">// 処理完了</span>
                        </code></pre>
    </div>
  </div>
</section>
