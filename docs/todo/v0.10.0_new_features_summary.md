# v0.10.0 新機能追加サマリー

**追加日**: 2025年10月9日  
**対象バージョン**: v0.10.0

---

## 📋 追加された機能

v0.10.0の実装計画に以下の5つの新機能を追加しました:

### 1. コンストラクタ/デストラクタ 🔴 高優先度

**目的**: オブジェクトのライフサイクル管理を自動化

**主な機能**:
- impl内で構造体名と同名の関数をコンストラクタとして認識
- impl内で `~構造体名` の関数をデストラクタとして認識
- `this` ポインタによるメンバーアクセス
- スコープ終了時の自動デストラクタ呼び出し
- 配列要素ごとのコンストラクタ/デストラクタ呼び出し

**設計原則**:
- 構造体 (`struct`) はデータのみを定義
- コンストラクタ/デストラクタ/メソッドは `impl` ブロック内で定義

**使用例**:
```cb
// データ定義
struct Point {
    int x;
    int y;
};

// 実装定義（コンストラクタ/デストラクタ/メソッド）
impl Point {
    Point(int px, int py) {
        this.x = px;
        this.y = py;
    }
    
    ~Point() {
        // クリーンアップ処理
    }
}

void main() {
    Point p(10, 20);  // コンストラクタ呼び出し
    // スコープ終了時にデストラクタ自動呼び出し
}
```

**詳細**: [v0.10.0_constructor_destructor.md](v0.10.0_constructor_destructor.md)

---

### 2. デフォルト引数 🔴 高優先度

**目的**: 関数呼び出しの柔軟性向上、API設計の改善

**主な機能**:
- 関数パラメータにデフォルト値を設定
- 呼び出し時に引数を省略可能
- 右側から連続してデフォルト値を指定
- 定数式のみ許可

**使用例**:
```cb
func int add(int a, int b = 10, int c = 20) {
    return a + b + c;
}

void main() {
    println(add(1));        // 1 + 10 + 20 = 31
    println(add(1, 2));     // 1 + 2 + 20 = 23
    println(add(1, 2, 3));  // 1 + 2 + 3 = 6
}
```

**詳細**: [v0.10.0_default_arguments.md](v0.10.0_default_arguments.md)

---

### 3. デフォルトメンバ（default修飾子） 🔴 高優先度

**目的**: 構造体の利便性向上、型安全なラッパー型の実現

**主な機能**:
- 構造体に1つだけ `default` メンバーを設定可能
- 型推論による暗黙的アクセス（読み取り/書き込み）
- 構造体リテラル `{}` と基本型の代入を区別
- 関数引数での自動変換

**使用例**:
```cb
struct String {
    default string value;
};

void main() {
    String s = {"Hello"};
    
    // 暗黙的参照
    println(s);  // "Hello" (s.value として解釈)
    
    // 暗黙的代入
    s = "World";  // s.value = "World" として解釈
    println(s);   // "World"
    
    // 明示的アクセスも可能
    s.value = "Direct";
    
    // 構造体リテラル
    s = {"Explicit"};
}
```

**詳細**: [v0.10.0_default_member.md](v0.10.0_default_member.md)

---

### 4. 無名関数（ラムダ式） 🔴 高優先度

**目的**: 高階関数のサポート、コールバック関数の簡潔な記述

**主な機能**:
- `func` キーワードを式として使用
- 内部識別子の自動生成（重複エラーなし）
- 関数ポインタへの自動変換
- 高階関数やコールバックでの使用

**使用例**:
```cb
void main() {
    // 関数ポインタへの代入
    int* add = int func(int a, int b) {
        return a + b;
    };
    
    println(add(5, 3));  // 8
    
    // 関数引数として
    apply(int func(int x) { return x * 2; }, 10);
    
    // 配列要素として
    int*[3] ops = [
        int func(int x) { return x + 1; },
        int func(int x) { return x * 2; },
        int func(int x) { return x * x; }
    ];
}
```

**詳細**: [v0.10.0_lambda_functions.md](v0.10.0_lambda_functions.md)

---

### 5. 無名変数（_ 識別子） 🟡 中優先度

**目的**: 将来のタプル実装への布石、意図の明確化

**主な機能**:
- `_` を無名変数として認識
- 代入・参照不可（値を無視する専用）
- 複数の `_` が同じスコープに存在可能
- 将来的なタプル分解での使用

**使用例**:
```cb
void main() {
    // 戻り値を無視（関数は実行される）
    int _ = compute();
    
    // 複数の無名変数
    int _ = 10;      // 内部: __discard_1
    string _ = "a";  // 内部: __discard_2
    
    // ❌ エラー: 参照不可
    // println(_);
    
    // ❌ エラー: 代入不可
    // _ = 20;
}

// 将来的な使用例（タプル実装後）
// (int value, _, float pi) = get_data();  // 第2戻り値を無視
```

**詳細**: [v0.10.0_discard_variable.md](v0.10.0_discard_variable.md)

---

## 📅 実装スケジュール

### Phase 2: 高優先度機能（新規追加）

1. **コンストラクタ/デストラクタ** - 推定6週間
   - Phase 1: 基本構造（2週間）
   - Phase 2: コンストラクタ実装（2週間）
   - Phase 3: デストラクタ実装（2週間）
   - Phase 4: テストと検証（1週間）

2. **デフォルト引数** - 推定4週間
   - Phase 1: 構文解析（1週間）
   - Phase 2: 型チェック（1週間）
   - Phase 3: 実行時処理（1週間）
   - Phase 4: テストと検証（1週間）

3. **デフォルトメンバ** - 推定5週間
   - Phase 1: 基本構造（1週間）
   - Phase 2: 型チェック（1週間）
   - Phase 3: 暗黙的変換（2週間）
   - Phase 4: テストと検証（1週間）

4. **無名関数（ラムダ式）** - 推定6週間
   - Phase 1: 基本構造（2週間）
   - Phase 2: 式としての統合（2週間）
   - Phase 3: 型チェック（1週間）
   - Phase 4: テストと検証（1週間）

5. **無名変数（_ 識別子）** - 推定4週間
   - Phase 1: 基本実装（1週間）
   - Phase 2: エラー検出（1週間）
   - Phase 3: 最適化（1週間）
   - Phase 4: テストと検証（1週間）

**合計**: 約25週間（約6ヶ月）

---

## 🎯 期待される効果

### コンストラクタ/デストラクタ
- ✅ リソース管理の自動化
- ✅ 初期化忘れの防止
- ✅ オブジェクト指向プログラミングの基盤

### デフォルト引数
- ✅ API設計の柔軟性向上
- ✅ 後方互換性を保った機能拡張
- ✅ コードの簡潔化

### デフォルトメンバ
- ✅ 型安全なラッパー型の実現
- ✅ 構造体の透過的な使用
- ✅ ドメイン固有型の簡潔な記述

### 無名関数（ラムダ式）
- ✅ 高階関数のサポート
- ✅ コールバック関数の簡潔な記述
- ✅ 関数型プログラミングスタイルの導入

### 無名変数（_ 識別子）
- ✅ 意図の明確化（値を使わないことを明示）
- ✅ 未使用変数警告の回避
- ✅ 将来のタプル分解への布石

---

## 📚 関連ドキュメント

- [v0.10.0 実装計画](v0.10.0_implementation_plan.md) - メインの実装計画
- [v0.10.0 コンストラクタ/デストラクタ](v0.10.0_constructor_destructor.md) - 詳細設計
- [v0.10.0 デフォルト引数](v0.10.0_default_arguments.md) - 詳細設計
- [v0.10.0 デフォルトメンバ](v0.10.0_default_member.md) - 詳細設計
- [v0.10.0 無名関数（ラムダ式）](v0.10.0_lambda_functions.md) - 詳細設計
- [v0.10.0 無名変数（_ 識別子）](v0.10.0_discard_variable.md) - 詳細設計

---

## 🔄 更新履歴

- 2025/10/09: 初版作成 - 3つの新機能を追加
  - コンストラクタ/デストラクタ
  - デフォルト引数
  - デフォルトメンバ（default修飾子）
- 2025/10/09: コンストラクタ/デストラクタをimpl内定義に変更
  - 構造体はデータのみを定義する設計方針に統一
- 2025/10/09: 2つの新機能を追加
  - 無名関数（ラムダ式）
  - 無名変数（_ 識別子）
