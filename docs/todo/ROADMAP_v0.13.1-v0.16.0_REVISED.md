# Cb言語開発ロードマップ v0.13.1 - v0.16.0 改訂版

**作成日**: 2025年11月14日  
**更新日**: 2025年11月14日  
**対象期間**: 約15-17ヶ月
**ステータス**: ✅ 改訂完了

---

## 📊 エグゼクティブサマリー

このドキュメントは、Cb言語の次期5つのバージョン（v0.13.1〜v0.16.0）の実装計画をまとめた改訂版です。

### 🔄 主な変更点（2025年11月14日）

1. **バージョン番号の再編成**: v0.14.0（テストカバレッジ）を v0.13.1 にパッチバージョンとして変更
2. **バージョンの前倒し**: v0.14.0〜v0.17.0 を v0.14.0〜v0.16.0 に1つずつ繰り上げ
3. **合理的なバージョニング**: マイナーバージョンは新機能、パッチバージョンはバグ修正・改善に統一

### 🎯 各バージョンの目標

| バージョン | 種別 | 期間 | 主要目標 |
|-----------|------|------|---------|
| **v0.13.1** | パッチ | 2-3ヶ月 | テストカバレッジ改善＋バグ修正 |
| **v0.14.0** | マイナー | 3-4ヶ月 | Generic配列サポート＋IR基盤実装 |
| **v0.14.0** | マイナー | 3-4ヶ月 | 複数バックエンド対応 |
| **v0.15.0** | マイナー | 2-3ヶ月 | 標準ライブラリ化（組み込み関数ゼロ） |
| **v0.16.0** | マイナー | 2-3ヶ月 | パッケージエコシステム |

**総期間**: 15-17ヶ月

---

## 📅 全体タイムライン

```
Month 1-3:   v0.13.1 - テストカバレッジ改善＋バグ修正（パッチ）
Month 4-7:   v0.14.0 - Generic配列サポート＋IR基盤実装
Month 8-11:  v0.14.0 - 複数バックエンド対応
Month 12-14: v0.15.0 - 標準ライブラリの完全ライブラリ化
Month 15-17: v0.16.0 - パッケージエコシステム
```

---

## 🎯 v0.13.1: テストカバレッジ改善とバグ修正（2-3ヶ月）

### 概要

v0.13.0のレビューで発見された問題を解決し、Async/Await機能とジェネリクス機能の成熟を目指します。
**パッチバージョン**として、既存機能の改善と安定性向上に焦点を当てます。

### 主要な実装内容

#### 1. Integration Testカバレッジ改善
- **目標**: 67% → 100%
- **追加テスト**: 19個のAsync testケース
- **期間**: Week 1-2

#### 2. Async機能拡張（バグ修正）
- ✨ **Async関数型**: `async int() callback` 構文
- ✨ **Asyncラムダ式**: `async int() { ... }` 構文
- ✨ **構造体内asyncメソッド**: `struct { async T get() {...} }`
- ✨ **Generic Interface impl構文**: `impl<T> Container<T> for Box<T>`
- **期間**: Week 3-6

#### 3. パターンマッチングの強化
- ネストしたMatch式のサポート（2段階、3段階以上）
- 深いネストジェネリック型のテスト（3〜5レベル）
- **期間**: Week 7

#### 4. ドキュメント整備
- BNF更新、言語仕様書更新、チュートリアル作成
- **期間**: Week 8

### 成功指標（KPI）
- Integration testカバレッジ: **67% → 100%**
- 全テスト: **750+ → 850+**
- 後方互換性: **100%**

### 完了条件
- [ ] Integration testカバレッジ100%
- [ ] Async機能拡張完了
- [ ] パターンマッチング強化完了
- [ ] VSCode拡張機能v0.14.0対応

### 詳細ドキュメント
- [`docs/todo/v0.14.0/v0.14.0_implementation_plan.md`](./v0.14.0/v0.14.0_implementation_plan.md)

---

## 🎯 v0.14.0: IR基盤とコンパイラ最適化（3-4ヶ月）🆕

### 概要

**注**: 旧v0.15.0のIR部分を前倒して実装

3層IR構造（HIR/MIR/LIR）を設計・実装し、将来の最適化とコード生成への基盤を構築します。

### 主要な実装内容

#### 1. HIR (High-level IR) - 高レベル中間表現
- ASTに型情報とスコープ情報を付加
- 制御フロー構造を保持
- ジェネリクスの単相化（Monomorphization）
- **期間**: Month 1

#### 2. MIR (Mid-level IR) - 中レベル中間表現
- **SSA形式（Static Single Assignment）**
- **制御フローグラフ（CFG）**
- **データフロー解析**（生存変数解析、到達定義解析）
- **支配木（Lengauer-Tarjanアルゴリズム）**
- **期間**: Month 2

#### 3. LIR (Low-level IR) - 低レベル中間表現
- 3アドレスコード形式
- 仮想レジスタ管理
- アセンブリ生成への準備
- **期間**: Month 3 (Week 1-2)

#### 4. IRビューワーとデバッグツール
- HIR/MIR/LIRのテキストダンプ
- GraphVizによるCFG可視化
- IR検証ツール
- **期間**: Month 3 (Week 3-4)

### 成功指標（KPI）
- ユニットテスト: **155個以上**
- 統合テスト: **25個以上**
- コードカバレッジ: **> 85%**
- パフォーマンス目標達成（1000行 < 200ms）

### 完了条件
- [ ] HIR/MIR/LIR完全実装
- [ ] SSA形式とデータフロー解析完了
- [ ] IRビューワー完成
- [ ] 全テスト成功

### 詳細ドキュメント
- [`docs/todo/v0.14.0/README.md`](./v0.14.0/README.md)

---

## 🎯 v0.15.0: 複数バックエンド対応＋v0.16.0準備機能（3-4ヶ月）

### 概要

複数バックエンド（Native/WASM/TypeScript）を実装し、**v0.16.0での標準ライブラリ完全ライブラリ化のための必須機能**を実装します。

### 主要な実装内容

#### 1. ネイティブバックエンド
- x86-64/ARM64コード生成
- ELF/Mach-O/PE形式サポート
- ベアメタル実行サポート
- **期間**: Month 1 (Week 1-2)

#### 2. v0.16.0準備機能（重要！）

**✨ インラインアセンブラ**（v0.16.0で必須）:
```cb
export void println_linux(string s) {
    long len = strlen(s);
    asm volatile (
        "mov $1, %rax\n"       // SYS_WRITE
        "syscall"
        : : "r"(s), "r"(len)
        : "rax", "rdi", "rsi", "rdx", "r11", "rcx", "memory"
    );
}
```
- **期間**: Month 1 (Week 3)

**✨ 条件付きコンパイル**（v0.16.0で必須）:
```cb
#[cfg(target_os = "linux")]
export void* alloc(long size) {
    // Linux: mmap システムコール
}

#[cfg(target_os = "windows")]
export void* alloc(long size) {
    // Windows: HeapAlloc FFI
}
```
- **期間**: Month 2 (Week 1-2)

**✨ ベアメタル実行サポート**:
- カスタムエントリーポイント
- リンカースクリプト生成
- **期間**: Month 1 (Week 4)

**✨ メモリマップドIO**:
```cb
void uart_send(char c) {
    UART* uart = 0x40000000 as UART*;
    volatile { uart->data = c as int; }
}
```
- **期間**: Month 2 (Week 3)

**✨ モジュールシステム強化**:
- `mod` キーワード
- Re-export機能
- 選択的インポート
- **期間**: Month 3 (Week 4)

#### 3. Webバックエンド
- WASMバイナリ生成
- TypeScript変換
- HTML/CSS生成機能
- **期間**: Month 3 (Week 1-3)

### 成功指標（KPI）
- ユニットテスト: **200個以上**
- 統合テスト: **80個以上**
- 全バックエンド動作確認
- **v0.16.0準備機能完全実装** ✅

### 完了条件
- [ ] ネイティブバックエンド動作
- [ ] インラインアセンブラ完全実装
- [ ] 条件付きコンパイル完全実装
- [ ] モジュールシステム強化完了
- [ ] **v0.16.0で標準ライブラリをライブラリ化できる状態** 🎯

### 詳細ドキュメント
- [`docs/todo/v0.15.0/v0.15.0_revised_roadmap.md`](./v0.15.0/v0.15.0_revised_roadmap.md)

---

## 🎯 v0.16.0: 標準ライブラリの完全ライブラリ化（2-3ヶ月）

### 概要

**組み込み関数をゼロにする** - 全てのOS依存機能を標準ライブラリとして分離

### 現状（v0.15.0まで）

```cb
void main() {
    println("Hello");  // ← コンパイラ組み込み関数
    int* ptr = malloc(100);  // ← コンパイラ組み込み関数
}
```

### v0.16.0以降

```cb
import std::io::println;
import std::mem::alloc;

void main() {
    println("Hello");  // ← std/io/stdio.cb の実装
    void* ptr = alloc(100);  // ← std/mem/alloc.cb の実装
}
```

### 主要な実装内容

#### 1. 入出力ライブラリ（std/io/stdio.cb）

**Linux実装（インラインアセンブラ）**:
```cb
#[cfg(target_os = "linux")]
export void println(string s) {
    // write(1, s, len) システムコール
    asm volatile ("syscall" ...);
}
```

**Windows実装（FFI）**:
```cb
#[cfg(target_os = "windows")]
extern "C" {
    int WriteFile(...);
}
export void println(string s) {
    WriteFile(...);
}
```

**ベアメタル実装（UART）**:
```cb
#[cfg(target_os = "none")]
export void println(string s) {
    UART* uart = 0x40000000 as UART*;
    // UART出力...
}
```

- **期間**: Month 1 (Week 1-2)

#### 2. メモリ管理ライブラリ（std/mem/alloc.cb）

**Linux**: mmap/munmap (インラインアセンブラ)
**Windows**: HeapAlloc/HeapFree (FFI)
**Baremetal**: バンプアロケーター

- **期間**: Month 1 (Week 3)

#### 3. プラットフォーム固有実装
- Linux実装（Month 2, Week 1）
- Windows実装（Month 2, Week 2）
- macOS実装（Month 2, Week 3）
- ベアメタル実装（Month 2, Week 4）

#### 4. 移行とテスト
- コンパイラから組み込み関数削除
- 自動インポート機能（後方互換性）
- 既存コード動作確認
- **期間**: Month 3

### 標準ライブラリ構造

```
std/
├── io/
│   └── stdio.cb       # println, print, readln
├── mem/
│   └── alloc.cb       # alloc, free, realloc
├── sys/
│   ├── linux.cb       # Linux固有実装
│   ├── macos.cb       # macOS固有実装
│   ├── windows.cb     # Windows固有実装
│   └── none/          # ベアメタル実装
└── runtime/
    ├── panic.cb       # パニックハンドラ
    └── start.cb       # エントリーポイント
```

### 成功指標（KPI）
- **コンパイラ組み込み関数ゼロ** ✅
- **4プラットフォームで動作**（Linux/Windows/macOS/Baremetal） ✅
- ライブラリテスト: **100個以上**
- **後方互換性100%**（自動インポート）

### 完了条件
- [ ] 組み込み関数完全削除
- [ ] 全プラットフォームで動作
- [ ] 後方互換性確保
- [ ] メモリリークゼロ

### 詳細ドキュメント
- [`docs/todo/v0.16.0/v0.16.0_stdlib_library_complete.md`](./v0.16.0/v0.16.0_stdlib_library_complete.md)

---

## 🎯 v0.17.0: パッケージエコシステム（2-3ヶ月）

### 概要

**変更なし** - 旧ロードマップから変更なし

パッケージマネージャー（cbpkg）とパッケージレジストリを実装します。

### 主要な実装内容

#### 1. パッケージマネージャー（cbpkg）

```bash
# プロジェクト管理
cbpkg new my-project
cbpkg init

# 依存関係管理
cbpkg add http-client
cbpkg add json-parser@1.2.3

# ビルドと実行
cbpkg build
cbpkg run
cbpkg test

# パッケージ公開
cbpkg publish
```

- **期間**: Month 1

#### 2. プロジェクト設定（cb.toml）

```toml
[package]
name = "my-project"
version = "0.1.0"

[dependencies]
http-client = "^1.0.0"
json-parser = "^1.2.0"
```

#### 3. 依存関係解決
- セマンティックバージョニング
- 依存関係グラフ構築
- 競合解決
- **期間**: Month 1 (Week 3)

#### 4. パッケージレジストリ
- REST API実装
- パッケージ検索
- バージョン管理
- Web UI
- **期間**: Month 2

#### 5. ワークスペース
- 複数パッケージの管理
- **期間**: Month 3

### 成功指標（KPI）
- cbpkgコマンド完全動作
- 依存関係解決正常動作
- パッケージレジストリ稼働
- **10個以上のパッケージ公開**

### 完了条件
- [ ] cbpkg全機能動作
- [ ] パッケージレジストリ稼働
- [ ] エコシステム確立（10パッケージ以上）

### 詳細ドキュメント
- [`docs/todo/v0.17.0/README.md`](./v0.17.0/README.md)

---

## 🔗 統合されたビジョン

### v0.14.0完了時点

✓ テストカバレッジ100%
✓ Async機能成熟
✓ ジェネリクス成熟
✓ パターンマッチング強化

**Cb言語でできること**:
- 既存機能の完全な動作確認
- 高品質なコード保証

---

### v0.14.0完了時点

✓ 3層IR構造（HIR/MIR/LIR）
✓ SSA形式とデータフロー解析
✓ IRビューワーと可視化ツール

**Cb言語でできること**:
- v0.14.0の全て
- + コンパイラ最適化の基盤
- + 将来の高度な最適化への準備

---

### v0.15.0完了時点

✓ ネイティブコンパイラ
✓ 複数バックエンド（Native/WASM/TypeScript）
✓ OS開発・組み込みシステム対応
✓ Webフロントエンド開発対応
✓ インラインアセンブラ、条件付きコンパイル

**Cb言語でできること**:
- v0.14.0の全て
- + OS開発（ベアメタル、インラインアセンブラ）
- + 高性能ネイティブアプリ（Linux/macOS/Windows）
- + Webアプリ開発（WASM、TypeScript、HTML/CSS生成）
- + 組み込みシステム開発（ARM Cortex-M、RISC-V）
- + **v0.16.0への準備完了**

---

### v0.16.0完了時点

✓ 標準ライブラリのライブラリ化
✓ プラットフォーム独立実装
✓ OS抽象化レイヤ
✓ **組み込み関数ゼロ**

**Cb言語でできること**:
- v0.15.0の全て
- + ポータブルな標準ライブラリ
- + プラットフォーム固有の最適化実装
- + カスタムアロケーター
- + 完全なプラットフォーム独立性

---

### v0.17.0完了時点

✓ パッケージエコシステム
✓ パッケージマネージャー
✓ 依存関係管理

**Cb言語でできること**:
- v0.16.0の全て
- + ライブラリの簡単な共有・利用
- + 依存関係の自動解決
- + プロジェクト管理の簡素化
- + 充実したエコシステム

---

## 📊 リスク管理

### 技術的リスク

| リスク | 影響 | 対策 |
|--------|------|------|
| SSA変換の複雑性 | 高 | Lengauer-Tarjanアルゴリズムの実績ある実装を参考 |
| 複数バックエンドの保守コスト | 中 | 共通インターフェース設計、テスト自動化 |
| 標準ライブラリの移行リスク | 高 | 自動インポート機能で後方互換性確保 |
| パッケージレジストリのスケーラビリティ | 中 | CDN活用、キャッシュ戦略 |

### スケジュールリスク

| リスク | 確率 | 対策 |
|--------|------|------|
| IR実装の遅延 | 中 | 段階的実装、早期プロトタイピング |
| v0.16.0準備機能の遅延 | 高 | v0.15.0で最優先実装 |
| 標準ライブラリのテスト不足 | 中 | CI/CD自動化、プラットフォーム別テスト |

---

## 🎯 成功指標（総合KPI）

### v0.14.0〜v0.17.0全体

- [ ] 全バージョンで後方互換性100%
- [ ] 総テスト数: 750+ → 1500+
- [ ] コードカバレッジ: 85% → 90%
- [ ] メモリリークゼロ（全バージョン）
- [ ] ドキュメント完備（全バージョン）

---

## 📝 まとめ

### 改訂版ロードマップのハイライト

1. **v0.14.0の新設**: IR実装を前倒し、コンパイラ基盤を早期構築
2. **v0.15.0の強化**: v0.16.0準備機能を追加、段階的な実装を実現
3. **v0.16.0の明確化**: 組み込み関数ゼロという明確な目標
4. **実現可能性の向上**: 各バージョンの依存関係を明確化

### 総期間

**15-17ヶ月**（約1年5ヶ月）

### 総テスト数

**1500+テスト**

### 総ドキュメント

**30+ドキュメント**

---

**作成者**: Cb Language Team
**最終更新**: 2025年11月14日
**ステータス**: ✅ 改訂完了・承認待ち
