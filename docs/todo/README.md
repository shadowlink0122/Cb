# Cb言語 TODO・実装計画

このディレクトリには、Cb言語の今後の実装計画、未実装機能の分析、開発ロードマップが含まれています。

**実装完了したドキュメントは以下にアーカイブされています:**
- `docs/archive/releases/v0.13.0/` - v0.13.0 FFI/プリプロセッサ/マクロ実装記録
- `docs/archive/todo/v0.12.0_async_await/` - v0.12.0 async/await計画・タスク管理

---

## 📊 現在のバージョン状態

### ✅ v0.13.0 完了（2025年11月14日）

**リリース**: Production Ready

1. **VSCode拡張機能**
   - フルシンタックスハイライト
   - コード補完・自動インデント
   - カスタムファイルアイコン

2. **FFI (Foreign Function Interface)**
   - C/C++/Rust/Zig/Goライブラリとの統合
   - dlopen/dlsymベースの動的ロード
   - 型安全なC ABI呼び出し

3. **プリプロセッサ**
   - 条件付きコンパイル（#ifdef, #ifndef, #else, #endif）
   - マクロ定義（#define, #undef）
   - 組み込みマクロ（__FILE__, __LINE__, __DATE__, __TIME__, __VERSION__）

4. **C風マクロ**
   - 定数マクロ
   - 関数マクロ
   - 可変長引数マクロ（__VA_ARGS__）

**品質指標**:
- テスト: 740+個（100%成功）
- 後方互換性: 完全維持
- ドキュメント: 24ファイル整理完了

**完了ドキュメント**: `../archive/releases/v0.13.0/` に移動済み

---

## 🎯 次期バージョン計画

### 📋 バージョン戦略（2025年11月14日 第2版）

**重要な方針転換**: 基本機能実装とコンパイラ実装を明確に分離

**v0.13.xパッチバージョン**: 基本機能の完成  
**v0.14.0以降マイナーバージョン**: コンパイラ実装

- `VERSION_REORGANIZATION.md` - 詳細な再編成ドキュメント
- `ROADMAP_v0.13.x-v0.16.0_LATEST.md` - 最新ロードマップ（第2版）

### v0.13.1（パッチ - 次期リリース）

**期間**: 2-3ヶ月  
**種別**: パッチバージョン  
**ステータス**: Planning  
**フェーズ**: 基本機能完成

#### 主要目標

1. **テストカバレッジ改善** (67% → 100%)
   - 19個のAsync testケース追加
   - 統合テスト強化

2. **Async機能のバグ修正**
   - Async関数型サポート
   - Asyncラムダ式サポート
   - 構造体内asyncメソッド
   - Generic Interface impl構文

3. **パターンマッチング強化**
   - ネストしたMatch式のサポート
   - 深いネストジェネリック型のテスト

4. **ドキュメント整備**
   - BNF更新
   - 言語仕様書更新
   - チュートリアル作成

**詳細**: `v0.13.1/v0.13.1_implementation_plan.md`

---

### v0.13.2（パッチ）

**期間**: 1-2ヶ月  
**種別**: パッチバージョン  
**ステータス**: Future  
**フェーズ**: 基本機能完成

#### 主要目標

1. **Generic配列サポート**
   - `T[N]` 形式のジェネリック配列
   - 配列ジェネリクスの完全サポート

2. **ジェネリクス機能の成熟**
   - 深いネストジェネリック型のサポート
   - より複雑なジェネリクス構文

**詳細**: `v0.13.2/v0.13.2_implementation_plan.md`

---

### v0.13.3（パッチ）

**期間**: 1-2ヶ月  
**種別**: パッチバージョン  
**ステータス**: Future  
**フェーズ**: 基本機能完成

#### 主要目標

1. **追加の言語機能**（必要に応じて）
2. **バグ修正**
3. **パフォーマンス改善**
4. **ドキュメント整備**

**詳細**: `v0.13.3/README.md`

**重要**: v0.13.3完了時点で基本機能実装フェーズ完結

---

### v0.14.0（マイナー - コンパイラ実装開始）

**期間**: 3-4ヶ月  
**種別**: マイナーバージョン  
**ステータス**: Future  
**フェーズ**: コンパイラ実装

**重要な転換点**: インタプリタ→コンパイラベースへ

#### 主要目標

1. **IR基盤の構築**
   - HIR (High-level IR)
   - MIR (Mid-level IR)
   - LIR (Low-level IR)

2. **最適化パス**
   - 定数畳み込み
   - デッドコード削除
   - インライン展開

3. **IRインタプリタ**
   - IRを直接実行できる仕組み

**詳細**: `v0.14.0/v0.14.0_implementation_plan.md`

---

### v0.15.0（マイナー）

**期間**: 3-4ヶ月  
**種別**: マイナーバージョン  
**ステータス**: Future  
**フェーズ**: コンパイラ実装

#### 主要目標

1. **複数バックエンド対応**
   - ネイティブコード生成（x86-64, ARM64）
   - WASM バックエンド
   - TypeScript バックエンド

**詳細**: `v0.15.0/`

---

### v0.16.0（マイナー）

**期間**: 2-3ヶ月  
**種別**: マイナーバージョン  
**ステータス**: Future  
**フェーズ**: 完成

#### 主要目標

1. **標準ライブラリ完全化**
   - 組み込み関数ゼロ化
   - すべての機能をライブラリとして提供

**詳細**: `v0.16.0/`

---

## 📚 主要ドキュメント

### ロードマップ

- `ROADMAP_v0.13.1-v0.17.0_REVISED.md` - 全体ロードマップ（改訂版）
- `ROADMAP_v0.15.0-v0.17.0_SUMMARY.md` - v0.15.0以降のサマリー
- `VERSION_REORGANIZATION.md` - バージョン番号再編成ドキュメント

### 設計ドキュメント

- `native_compiler_roadmap.md` - ネイティブコンパイラ設計
- `language_vs_library_design.md` - 言語機能とライブラリの境界
- `bare_metal_support_design.md` - ベアメタルサポート設計

### 実装ステータス

- `IMPLEMENTATION_STATUS.md` - 全体的な実装状況
- `default_member_implementation_progress.md` - デフォルトメンバー実装進捗

---

## 🎯 長期目標（v1.0.0）

### 目標

- ネイティブコンパイラ
- 実行ファイル生成
- インラインアセンブリ
- 完全な標準ライブラリ
- パッケージエコシステム

### 期間

v0.17.0完了後、約6-12ヶ月

---

## 📂 ディレクトリ構造

```
docs/todo/
├── v0.12.1/                    # v0.12.1実装記録
├── v0.13.1/                    # v0.13.1実装計画（次期リリース）- 基本機能
├── v0.13.2/                    # v0.13.2実装計画 - Generic配列
├── v0.13.3/                    # v0.13.3実装計画 - 追加機能・完成度向上
├── v0.14.0/                    # v0.14.0実装計画 - IR基盤実装（コンパイラ開始）
├── v0.15.0/                    # v0.15.0実装計画 - 複数バックエンド
├── v0.16.0/                    # v0.16.0実装計画 - 標準ライブラリ完全化
├── ROADMAP_*.md                # 全体ロードマップ
├── ROADMAP_v0.13.x-v0.16.0_LATEST.md  # 最新ロードマップ（第2版）
├── VERSION_REORGANIZATION.md   # バージョン再編成（第1版）
└── *.md                        # 各種設計ドキュメント
```

---

## 🔄 更新履歴

### 2025年11月14日（第2版）
- ✅ バージョン戦略の大幅変更
- ✅ v0.13.x（パッチ）で基本機能完結
- ✅ v0.14.0（マイナー）からコンパイラ実装開始
- ✅ v0.13.2, v0.13.3 追加
- ✅ ROADMAP_v0.13.x-v0.16.0_LATEST.md 作成

### 2025年11月14日（第1版）
- ✅ v0.13.0完了、アーカイブ化
- ✅ バージョン番号再編成（v0.14.0 → v0.13.1）
- ✅ ロードマップ更新（v0.13.1〜v0.17.0）
- ✅ VERSION_REORGANIZATION.md 作成

### 2025年11月9日
- ✅ v0.12.0完了、アーカイブ化

### 2025年11月5日
- ✅ v0.11.0完了

---

**次のステップ**: `v0.13.1/v0.13.1_implementation_plan.md` を参照して開発を開始してください。

1. **ジェネリクス配列サポート**
   - `Future<T>[]`の完全サポート
   - 配列要素の型情報保持
   - ジェネリクス構造体配列の正しい型推論

2. **並行実行の強化**
   - spawn()関数
   - タスクの優先度制御
   - タスクキャンセル

3. **非同期I/O**
   - 非同期ファイル読み書き
   - ネットワーク通信（将来）

4. **エラーハンドリング強化**
   - Result<T, E>とasync/awaitの統合
   - ?オペレーター

5. **auto型推論**
   - C++/Rust風の型推論
   - `auto`キーワード

**目標リリース**: 2026年2月

**詳細ドキュメント**:
- `v0.13.0_generic_array_support.md`
- `auto_type_inference.md`

---

## 📚 現在のTODOドキュメント一覧

### v0.13.0以降の計画

| ファイル | 内容 | 優先度 |
|---------|------|--------|
| `v0.13.0_generic_array_support.md` | ジェネリクス配列サポート | 🔴 高 |
| `auto_type_inference.md` | auto型推論 | 🟡 中 |
| `future_features.md` | 将来の機能候補 | 🟢 低 |

### 技術設計・分析

| ファイル | 内容 | 優先度 |
|---------|------|--------|
| `implementation_gaps.md` | 未実装機能の詳細分析 | 🟡 中 |
| `implementation_roadmap.md` | 長期実装ロードマップ | 🟡 中 |
| `bare_metal_support_design.md` | ベアメタルサポート設計 | 🟢 低 |
| `ownership_semantics_discussion.md` | 所有権セマンティクス議論 | 🟢 低 |
| `language_vs_library_design.md` | 言語vs.ライブラリ設計 | 🟢 低 |
| `dry_optimization_analysis.md` | DRY原則最適化分析 | 🟢 低 |

### Week計画（旧）

| ファイル | 内容 | 状態 |
|---------|------|------|
| `week1_interface_bounds_plan.md` | インターフェース境界計画 | 📝 設計中 |
| `week2_cast_implementation_design.md` | キャスト実装設計 | 📝 設計中 |
| `week2_day1_vector_operations.md` | Vector操作 | 📝 設計中 |
| `week2_day3_ptr_array_access_plan.md` | ポインタ配列アクセス | 📝 設計中 |

### その他

| ファイル | 内容 | 状態 |
|---------|------|------|
| `default_member_implementation_progress.md` | デフォルトメンバー実装進捗 | ✅ 完了 |
| `multidim_array_pointer_implementation.md` | 多次元配列ポインタ | 📝 設計中 |

---

## 🚀 実装の優先順位

### Phase 1: v0.13.0 コア機能（2026年2月予定）

1. **ジェネリクス配列サポート** 🔴
   - `Future<T>[]`の完全実装
   - await式での配列要素の型情報保持
   - 配列アクセス式の型情報保持

2. **auto型推論** 🟡
   - C++/Rust風の型推論
   - ジェネリクス型の冗長性削減

3. **並行実行強化** 🟡
   - spawn()関数
   - タスク管理の改善

### Phase 2: v0.13.0 エコシステム強化（2026年夏予定）

1. **非同期I/O** 🟡
   - 非同期ファイル操作
   - ストリーミング

2. **エラーハンドリング** 🟡
   - ?オペレーター
   - Result<T, E>統合

3. **パフォーマンス最適化** 🟢
   - インライン化
   - 定数畳み込み

### Phase 3: 将来（2026年後半以降）

1. **ベアメタルサポート** 🟢
   - 組み込みシステム対応
   - NO_STDモード

2. **所有権セマンティクス** 🟢
   - Rust風の所有権システム
   - ボローチェッカー

---

## 📝 ドキュメント更新ガイドライン

### 新機能実装時

1. 実装計画ドキュメントを作成（`vX.Y.Z_feature_name.md`）
2. `implementation_gaps.md`から該当項目を削除
3. 実装完了後、リリースノートに追加
4. 完了ドキュメントを`archive/todo/vX.Y.Z_*/`に移動

### バグ修正時

1. 修正内容をリリースノートに記載
2. 関連する実装計画ドキュメントを更新

### リファクタリング時

1. `dry_optimization_analysis.md`を参照
2. 変更内容を記録
3. アーキテクチャドキュメントを更新

---

## 🔗 関連ドキュメント

### リリースノート
- `release_notes/v0.12.0.md` - async/await完全実装
- `release_notes/v0.11.0.md` - ジェネリクス、文字列補間、defer
- `release_notes/v0.10.1.md` - デフォルトメンバー、defer修正

### アーカイブ
- `docs/archive/features/async_await_v0.12.0/` - async/await実装ドキュメント
- `docs/archive/features/v0.11.0_implemented/` - v0.11.0実装済み機能
- `docs/archive/todo/v0.12.0_async_await/` - v0.12.0計画・タスク管理

### その他
- `docs/spec.md` - 言語仕様書
- `docs/architecture.md` - アーキテクチャ設計
- `README.md` - プロジェクト概要

---

## 📊 進捗追跡

### v0.12.0完了率（2025年11月9日）
```
完了項目: 6/6 (100%) ✅
- async/await構文
- Future<T>ビルトイン型
- 非ブロッキングsleep
- yield機能（明示的・自動）
- SimpleEventLoop
- デバッグ出力統一
- テスト完全合格（3,889件）
```

### v0.11.0完了率（2025年11月5日）
```
完了項目: 5/5 (100%) ✅
- ジェネリクスシステム
- 文字列補間
- デストラクタとRAII
- 標準コレクション（Vector, Queue, Map）
- 標準ライブラリ再編成
```

### v0.13.0予定（2026年2月）
```
実装予定: 3項目
- ジェネリクス配列サポート
- auto型推論
- 並行実行強化

期待完了率: ~80%
```

---

**最終更新**: 2025年11月9日  
**現在のバージョン**: v0.12.0  
**次期バージョン**: v0.13.0（計画中）


**完了ドキュメント**: `../archive/v0.11.0/`に移動済み

### ✅ v0.9.2で完了した項目

1. **Long型オーバーフロー修正**
   - TYPE_LONG配列の64bit読み取り実装
   - 大きな整数リテラルの自動型推論
   - Fibonacci(92)まで正確に計算可能

2. **Const型安全性の部分実装**
   - `const T*` と `T* const` のチェック
   - 関数パラメータでのconst違反検出
   - テストケース8件追加

3. **配列の参照渡し**
   - 関数引数として配列を自動的に参照として渡す実装
   - C/C++と同様の動作を実現
   - ポインタ配列のスワップテスト成功

4. **構造体メンバの再帰的代入**
   - ネストした構造体メンバへの直接代入をサポート
   - 4レベル以上の深いネストに対応
   - 新しいヘルパークラスで実装を整理

5. **ネスト構造体の宣言時初期化**
   - 宣言時のメンバーアクセス初期化: `Middle mid = o1.val;`
   - 再帰的なネストメンバー変数の作成
   - 14個の新規テスト追加

6. **テスト完全合格**
   - 統合テスト: 2,379件 ✅
   - ユニットテスト: 30件 ✅
   - 合計: 2,409件 ✅

**完了ドキュメント**: `../archive/releases/v0.9.2/`に移動済み

---

## 🎯 v0.12.0実装計画

### 主要機能

1. **非同期処理（async/await）**
   - Event Loop
   - Future<T>型
   - async/await構文
   - ?オペレーター

2. **パターンマッチング**
   - match式
   - Result<T, E>型との統合
   - Option<T>型との統合

3. **ムーブセマンティクス**
   - 右辺値参照（`T&&`）
   - ムーブコンストラクタ
   - 所有権移動

**目標リリース**: 2026年3月中旬

**詳細ドキュメント**:
- `v0.12.0_implementation_roadmap.md`
- `v0.12.0_async_await_design.md`
- `v0.12.0_move_semantics_implementation.md`

---

## 🎯 v0.10.0実装計画（参考）

### 最優先項目

#### 1. 配列参照型（`int[N]&`形式）
**現在の状態**: 配列の参照渡しは実装済みだが、明示的な型宣言は未実装

**実装内容**:
- [ ] パーサーでの`int[N]&`構文サポート
- [ ] 配列参照型の型システム統合
- [ ] 関数パラメータでの明示的な配列参照型宣言

**構文例**:
```cb
void modify_array(int[3]& arr) {  // 明示的な配列参照型
    arr[0] = 100;
}
```

**技術詳細**:
- 現在は配列を関数に渡すと自動的に参照として扱われる
- 明示的な型宣言により、型安全性が向上
- パーサーレベルでの実装が必要

**関連ファイル**:
- `v0.10.0_advanced_pointer_features.md` - 詳細な実装計画

#### 2. Const型安全性の完全実装
**現在の制限**: 関数戻り値でのconst情報が失われる

**実装内容**:
- [ ] 関数戻り値でのconst情報保持
- [ ] 完全なRust Pin<&T>相当の保証
- [ ] const修飾子の完全な型システム統合

**関連ファイル**:
- `const_pointer_type_safety_plan.md` - 詳細な実装計画
- `v0.10.0_implementation_plan.md` - 全体計画

#### 3. スタックトレース機能
**目的**: 実行時エラーのデバッグ改善

**実装内容**:
- [ ] 関数呼び出し履歴の記録
- [ ] エラー発生時のスタック表示
- [ ] ファイル名・行番号の表示

**技術詳細**:
- ErrorContextクラスは既に実装済み
- push_stack_frame/pop_stack_frameの統合が必要
- メモリ管理の改善が必要（セグメンテーションフォルト修正）

#### 4. 高度なポインタ機能
**実装内容**:
- [ ] ポインタ演算の境界チェック改善
- [ ] 動的メモリ管理（`new`/`delete`）
- [ ] ポインタキャスト（`static_cast<T>()`）

**関連ファイル**:
- `v0.10.0_advanced_pointer_features.md`

---

## 📚 計画ドキュメント一覧

### v0.10.0関連

| ファイル | 内容 | 優先度 |
|---------|------|--------|
| `v0.10.0_implementation_plan.md` | v0.10.0全体計画 | 🔴 高 |
| `v0.10.0_advanced_pointer_features.md` | 高度なポインタ機能 | 🟡 中 |
| `v0.10.0_new_features_summary.md` | 新機能サマリー | 🟡 中 |
| `v0.10.0_constructor_destructor.md` | コンストラクタ/デストラクタ | 🟢 低 |
| `v0.10.0_default_arguments.md` | デフォルト引数 | 🟢 低 |
| `v0.10.0_default_member.md` | デフォルトメンバ | 🟢 低 |
| `v0.10.0_discard_variable.md` | 破棄変数 | 🟢 低 |
| `v0.10.0_lambda_functions.md` | ラムダ関数 | 🟢 低 |

### 実装ギャップ分析

| ファイル | 内容 |
|---------|------|
| `implementation_gaps.md` | 未実装機能の詳細分析 |
| `implementation_roadmap.md` | 長期実装ロードマップ |
| `future_features.md` | 将来の機能候補 |

### 技術詳細

| ファイル | 内容 |
|---------|------|
| `const_pointer_type_safety_plan.md` | Const型安全性の完全実装計画 |
| `multidim_array_pointer_implementation.md` | 多次元配列ポインタ実装 |
| `string_null_terminator_implementation.md` | 文字列null終端実装 |
| `dry_optimization_analysis.md` | DRY原則最適化分析 |

### アーカイブ済み

- `../archive/releases/v0.9.2/` - v0.9.2関連の完了ドキュメント
  - 実装検証、機能レポート、ドキュメント完了報告など
- `../archive/planning/` - 過去の開発計画
  - phase2/8計画、文字列null終端、未実装機能まとめなど

---

## 🚀 実装の優先順位

### Phase 1: v0.10.0 コア機能（2025年10月予定）

1. **Const型安全性の完全実装** 🔴
   - 関数境界でのconst保証
   - Rust Pin相当の不変性保証

2. **スタックトレース** 🔴
   - ErrorContext統合
   - 実行時エラーのデバッグ改善

3. **高度なポインタ機能** 🟡
   - 境界チェック
   - 動的メモリ管理

### Phase 2: v0.11.0 言語機能強化（2025年11月予定）

1. **コンストラクタ/デストラクタ** 🟡
   - RAIIパターンの完全サポート
   - 自動リソース管理

2. **ラムダ関数** 🟡
   - クロージャサポート
   - 関数型プログラミング機能

3. **デフォルト引数** 🟢
   - 関数オーバーロードの簡略化

### Phase 3: v0.12.0 最適化と改善（2025年12月予定）

1. **パフォーマンス最適化** 🟡
   - インライン化
   - 定数畳み込み

2. **エラーメッセージ改善** 🟢
   - より詳細なエラー情報
   - サジェスチョン機能

---

## 📝 ドキュメント更新ガイドライン

### 新機能実装時

1. 実装計画ドキュメントを作成（`vX.Y.Z_feature_name.md`）
2. `implementation_gaps.md`から該当項目を削除
3. 実装完了後、リリースノートに追加
4. 完了ドキュメントを`archive/vX.Y.Z_completed/`に移動

### バグ修正時

1. 修正内容をリリースノートに記載
2. 関連する実装計画ドキュメントを更新

### リファクタリング時

1. `dry_optimization_analysis.md`を参照
2. 変更内容を記録
3. アーキテクチャドキュメントを更新

---

## 🔗 関連ドキュメント

- `../spec.md` - 言語仕様書（v0.9.2）
- `../architecture.md` - アーキテクチャ設計
- `../../release_notes/` - リリースノート
- `../../README.md` - プロジェクト概要

---

## 📊 進捗追跡

### v0.9.2完了率
```
完了項目: 4/4 (100%) ✅
- Long型オーバーフロー修正
- Const型安全性の部分実装
- 配列の参照渡し
- ネスト構造体の宣言時初期化
- テスト完全合格（2,409件）
```

### v0.10.0予定
```
実装予定: 3項目
- Const型安全性完全実装
- スタックトレース
- 高度なポインタ機能

期待完了率: ~70-80%
```

---

**最終更新**: 2025年10月11日  
**現在のバージョン**: v0.9.2  
**次期バージョン**: v0.10.0（計画中）
