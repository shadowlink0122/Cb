# Cb言語 TODO・実装計画

このディレクトリには、Cb言語の今後の実装計画、未実装機能の分析、開発ロードマップが含まれています。

---

## 📋 現在の状態（v0.11.0完了）

### ✅ v0.11.0で完了した項目

1. **ジェネリクスシステム**
   - ジェネリック構造体（`Box<T>`, `Option<T>`, `Result<T, E>`）
   - ジェネリック関数
   - ジェネリック列挙型
   - ネストしたジェネリック型

2. **文字列補間機能**
   - `{expression:format}` 構文
   - フォーマット指定子（`:x`, `:.2`, `:05`, `:b`）
   - エスケープシーケンス

3. **デストラクタとRAII**
   - `~self()` 構文
   - スコープ終了時の自動クリーンアップ
   - break/continue文との統合

4. **標準コレクションライブラリ**
   - `Vector<T>` - 双方向リンクリスト
   - `Queue<T>` - 循環バッファ
   - `Map<K, V>` - AVL自己平衡木

5. **標準ライブラリ再編成**
   - `stdlib.std.*` への統合
   - 組み込み型（Option, Result）の実装
   - 完全なドキュメント体系（`docs/stdlib/std/`）

6. **テスト完全合格**
   - 統合テスト: 3,341件 ✅
   - stdlibテスト: 28件 ✅
   - 合計: 3,369件 ✅

**完了ドキュメント**: `../archive/v0.11.0/`に移動済み

### ✅ v0.9.2で完了した項目

1. **Long型オーバーフロー修正**
   - TYPE_LONG配列の64bit読み取り実装
   - 大きな整数リテラルの自動型推論
   - Fibonacci(92)まで正確に計算可能

2. **Const型安全性の部分実装**
   - `const T*` と `T* const` のチェック
   - 関数パラメータでのconst違反検出
   - テストケース8件追加

3. **配列の参照渡し**
   - 関数引数として配列を自動的に参照として渡す実装
   - C/C++と同様の動作を実現
   - ポインタ配列のスワップテスト成功

4. **構造体メンバの再帰的代入**
   - ネストした構造体メンバへの直接代入をサポート
   - 4レベル以上の深いネストに対応
   - 新しいヘルパークラスで実装を整理

5. **ネスト構造体の宣言時初期化**
   - 宣言時のメンバーアクセス初期化: `Middle mid = o1.val;`
   - 再帰的なネストメンバー変数の作成
   - 14個の新規テスト追加

6. **テスト完全合格**
   - 統合テスト: 2,379件 ✅
   - ユニットテスト: 30件 ✅
   - 合計: 2,409件 ✅

**完了ドキュメント**: `../archive/releases/v0.9.2/`に移動済み

---

## 🎯 v0.12.0実装計画

### 主要機能

1. **非同期処理（async/await）**
   - Event Loop
   - Future<T>型
   - async/await構文
   - ?オペレーター

2. **パターンマッチング**
   - match式
   - Result<T, E>型との統合
   - Option<T>型との統合

3. **ムーブセマンティクス**
   - 右辺値参照（`T&&`）
   - ムーブコンストラクタ
   - 所有権移動

**目標リリース**: 2026年3月中旬

**詳細ドキュメント**:
- `v0.12.0_implementation_roadmap.md`
- `v0.12.0_async_await_design.md`
- `v0.12.0_move_semantics_implementation.md`

---

## 🎯 v0.10.0実装計画（参考）

### 最優先項目

#### 1. 配列参照型（`int[N]&`形式）
**現在の状態**: 配列の参照渡しは実装済みだが、明示的な型宣言は未実装

**実装内容**:
- [ ] パーサーでの`int[N]&`構文サポート
- [ ] 配列参照型の型システム統合
- [ ] 関数パラメータでの明示的な配列参照型宣言

**構文例**:
```cb
void modify_array(int[3]& arr) {  // 明示的な配列参照型
    arr[0] = 100;
}
```

**技術詳細**:
- 現在は配列を関数に渡すと自動的に参照として扱われる
- 明示的な型宣言により、型安全性が向上
- パーサーレベルでの実装が必要

**関連ファイル**:
- `v0.10.0_advanced_pointer_features.md` - 詳細な実装計画

#### 2. Const型安全性の完全実装
**現在の制限**: 関数戻り値でのconst情報が失われる

**実装内容**:
- [ ] 関数戻り値でのconst情報保持
- [ ] 完全なRust Pin<&T>相当の保証
- [ ] const修飾子の完全な型システム統合

**関連ファイル**:
- `const_pointer_type_safety_plan.md` - 詳細な実装計画
- `v0.10.0_implementation_plan.md` - 全体計画

#### 3. スタックトレース機能
**目的**: 実行時エラーのデバッグ改善

**実装内容**:
- [ ] 関数呼び出し履歴の記録
- [ ] エラー発生時のスタック表示
- [ ] ファイル名・行番号の表示

**技術詳細**:
- ErrorContextクラスは既に実装済み
- push_stack_frame/pop_stack_frameの統合が必要
- メモリ管理の改善が必要（セグメンテーションフォルト修正）

#### 4. 高度なポインタ機能
**実装内容**:
- [ ] ポインタ演算の境界チェック改善
- [ ] 動的メモリ管理（`new`/`delete`）
- [ ] ポインタキャスト（`static_cast<T>()`）

**関連ファイル**:
- `v0.10.0_advanced_pointer_features.md`

---

## 📚 計画ドキュメント一覧

### v0.10.0関連

| ファイル | 内容 | 優先度 |
|---------|------|--------|
| `v0.10.0_implementation_plan.md` | v0.10.0全体計画 | 🔴 高 |
| `v0.10.0_advanced_pointer_features.md` | 高度なポインタ機能 | 🟡 中 |
| `v0.10.0_new_features_summary.md` | 新機能サマリー | 🟡 中 |
| `v0.10.0_constructor_destructor.md` | コンストラクタ/デストラクタ | 🟢 低 |
| `v0.10.0_default_arguments.md` | デフォルト引数 | 🟢 低 |
| `v0.10.0_default_member.md` | デフォルトメンバ | 🟢 低 |
| `v0.10.0_discard_variable.md` | 破棄変数 | 🟢 低 |
| `v0.10.0_lambda_functions.md` | ラムダ関数 | 🟢 低 |

### 実装ギャップ分析

| ファイル | 内容 |
|---------|------|
| `implementation_gaps.md` | 未実装機能の詳細分析 |
| `implementation_roadmap.md` | 長期実装ロードマップ |
| `future_features.md` | 将来の機能候補 |

### 技術詳細

| ファイル | 内容 |
|---------|------|
| `const_pointer_type_safety_plan.md` | Const型安全性の完全実装計画 |
| `multidim_array_pointer_implementation.md` | 多次元配列ポインタ実装 |
| `string_null_terminator_implementation.md` | 文字列null終端実装 |
| `dry_optimization_analysis.md` | DRY原則最適化分析 |

### アーカイブ済み

- `../archive/releases/v0.9.2/` - v0.9.2関連の完了ドキュメント
  - 実装検証、機能レポート、ドキュメント完了報告など
- `../archive/planning/` - 過去の開発計画
  - phase2/8計画、文字列null終端、未実装機能まとめなど

---

## 🚀 実装の優先順位

### Phase 1: v0.10.0 コア機能（2025年10月予定）

1. **Const型安全性の完全実装** 🔴
   - 関数境界でのconst保証
   - Rust Pin相当の不変性保証

2. **スタックトレース** 🔴
   - ErrorContext統合
   - 実行時エラーのデバッグ改善

3. **高度なポインタ機能** 🟡
   - 境界チェック
   - 動的メモリ管理

### Phase 2: v0.11.0 言語機能強化（2025年11月予定）

1. **コンストラクタ/デストラクタ** 🟡
   - RAIIパターンの完全サポート
   - 自動リソース管理

2. **ラムダ関数** 🟡
   - クロージャサポート
   - 関数型プログラミング機能

3. **デフォルト引数** 🟢
   - 関数オーバーロードの簡略化

### Phase 3: v0.12.0 最適化と改善（2025年12月予定）

1. **パフォーマンス最適化** 🟡
   - インライン化
   - 定数畳み込み

2. **エラーメッセージ改善** 🟢
   - より詳細なエラー情報
   - サジェスチョン機能

---

## 📝 ドキュメント更新ガイドライン

### 新機能実装時

1. 実装計画ドキュメントを作成（`vX.Y.Z_feature_name.md`）
2. `implementation_gaps.md`から該当項目を削除
3. 実装完了後、リリースノートに追加
4. 完了ドキュメントを`archive/vX.Y.Z_completed/`に移動

### バグ修正時

1. 修正内容をリリースノートに記載
2. 関連する実装計画ドキュメントを更新

### リファクタリング時

1. `dry_optimization_analysis.md`を参照
2. 変更内容を記録
3. アーキテクチャドキュメントを更新

---

## 🔗 関連ドキュメント

- `../spec.md` - 言語仕様書（v0.9.2）
- `../architecture.md` - アーキテクチャ設計
- `../../release_notes/` - リリースノート
- `../../README.md` - プロジェクト概要

---

## 📊 進捗追跡

### v0.9.2完了率
```
完了項目: 4/4 (100%) ✅
- Long型オーバーフロー修正
- Const型安全性の部分実装
- 配列の参照渡し
- ネスト構造体の宣言時初期化
- テスト完全合格（2,409件）
```

### v0.10.0予定
```
実装予定: 3項目
- Const型安全性完全実装
- スタックトレース
- 高度なポインタ機能

期待完了率: ~70-80%
```

---

**最終更新**: 2025年10月11日  
**現在のバージョン**: v0.9.2  
**次期バージョン**: v0.10.0（計画中）
