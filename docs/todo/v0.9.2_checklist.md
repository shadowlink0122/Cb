# v0.9.2 実装チェックリスト

## 📋 Phase 1: 基盤整備（1-2週間）

### Week 1: コード分割とリファクタリング

#### Day 1-2: interpreter.cpp分割
- [ ] 分割設計ドキュメント作成
- [ ] initialization.cpp作成
  - [ ] コンストラクタ処理
  - [ ] グローバル変数初期化
  - [ ] 組み込み関数登録
- [ ] cleanup.cpp作成
  - [ ] デストラクタ処理
  - [ ] メモリ解放処理
- [ ] utility.cpp作成
  - [ ] ヘルパー関数
  - [ ] デバッグ出力関数
- [ ] Makefile更新
- [ ] ビルド確認（`make clean && make -j4`）
- [ ] 全テスト実行（`make test`）

#### Day 3-4: TypeHelpers拡充
- [x] `needsExplicitCast()`実装（canImplicitCastの代わり）
- [x] `getCommonNumericType()`実装（getCommonTypeの代わり）
- [x] `getTypeSize()`実装
- [x] `getTypeAlignment()`実装
- [x] `isSignedInteger()`実装
- [x] `getTypeMinValue()`実装
- [x] `getTypeMaxValue()`実装
- [ ] `getArrayDimensions()`実装（将来実装）
- [ ] `getBaseType()`実装（将来実装）
- [ ] `getPointerLevel()`実装（既存の改善）（将来実装）
- [ ] 単体テスト追加（10個）（将来実装）
- [ ] 既存コードの置き換え（段階的に実施）
- [x] 全テスト実行（2497テスト合格）

#### Day 5-7: エラーメッセージ改善
- [x] SourceLocation構造体作成
  - [x] ファイル名、行番号、列番号の追跡
  - [x] `isValid()`, `toString()` メソッド
- [x] SourceSpan構造体作成
  - [x] エラー範囲の表現（開始〜終了）
  - [x] 単一行/複数行判定
- [x] SourceLocationUtils実装
  - [x] `extractLine()` - ソースコード1行抽出
  - [x] `extractLinesWithContext()` - エラー周辺の文脈表示
  - [x] `createCaret()` - エラー位置指示 (^)
  - [x] `levenshteinDistance()` - 文字列類似度計算
  - [x] `findSimilarStrings()` - "Did you mean?"提案
- [x] ErrorReporter クラス実装
  - [x] 4段階の重要度レベル (NOTE, WARNING, ERROR, FATAL)
  - [x] `report()` - 単一位置エラー報告
  - [x] `reportSpan()` - 範囲指定エラー報告
  - [x] `reportSimple()` - 簡易エラー報告
  - [x] `findSuggestions()` - 修正候補自動提案
- [x] ユニットテスト追加（9個）
- [x] 全テスト実行（2497テスト合格）
- [ ] Token構造体に列番号追加（次のタスク）
- [ ] Tokenizerで列番号記録（次のタスク）
- [ ] インタープリターのエラー処理をErrorReporterに置き換え（次のタスク）

### Week 2: テストとドキュメント

#### Day 8-9: テストカバレッジ向上
- [x] 既存テストのレビュー
- [x] 不足しているテストケース洗い出し
- [x] エッジケーステスト追加（3個追加、目標20個は段階的に）
- [x] エラーハンドリングテスト追加（5個追加）
- [x] リグレッションテスト追加（2個追加）
- [x] 関数ポインタ・型変換テスト追加（3個）
- [x] 全テスト実行（556テストケース、全て合格）
- [ ] カバレッジ計測ツール導入検討（将来実装）

#### Day 10-11: ドキュメント作成（Phase 1）
- [ ] チュートリアル作成開始
  - [ ] 基本構文ガイド
  - [ ] サンプルコード集
  - [ ] よくある間違い
- [ ] README.md更新
  - [ ] インストール手順
  - [ ] クイックスタート
  - [ ] ビルド手順
- [ ] アーキテクチャドキュメント更新
  - [ ] interpreter.cpp分割後の構造
  - [ ] TypeHelpersの説明

#### Day 12-14: Phase 1レビューとバッファ
- [ ] コードレビュー
- [ ] パフォーマンステスト
- [ ] メモリリークチェック
- [ ] ドキュメントレビュー
- [ ] Phase 1完了判定
- [ ] Phase 2準備

---

## 📋 Phase 2: 新機能実装（2-3週間）

### Week 3-4: 配列参照型実装

#### Day 1-2: 設計とプロトタイプ
- [ ] 配列参照型の仕様確定
  ```cb
  int[5]& ref = arr;
  ref[0] = 100;
  ```
- [ ] AST拡張設計
- [ ] 型システム拡張設計
- [ ] テストケース設計（15個）
- [ ] プロトタイプ実装

#### Day 3-5: パーサー実装
- [ ] `ast.h`にフラグ追加
  ```cpp
  bool is_array_reference;
  ```
- [ ] `type_parser.cpp`拡張
  - [ ] `int[N]&`構文の解析
  - [ ] 型情報の構築
- [ ] `recursive_parser.cpp`拡張
  - [ ] 配列参照型の変数宣言
  - [ ] 関数引数での使用
- [ ] パーサーテスト（10個）

#### Day 6-8: インタープリター実装
- [ ] 配列参照の宣言処理
  ```cpp
  void handleArrayReferenceDeclaration(
      const std::string& name,
      const TypeInfo& type,
      ASTNode* initializer);
  ```
- [ ] 配列参照の代入処理
- [ ] 配列参照経由のアクセス
- [ ] 型チェック強化
  - [ ] サイズ一致確認
  - [ ] 型互換性確認
- [ ] エラーメッセージ追加
- [ ] 統合テスト（15個）

#### Day 9-10: テストと最適化
- [ ] 全テスト実行
- [ ] パフォーマンステスト
- [ ] エッジケーステスト追加
- [ ] ドキュメント更新（spec.md）

### Week 5: 構造体・多次元配列機能

#### Day 1-3: 構造体配列メンバー代入
- [ ] 仕様確定
  ```cb
  struct Data { int[5] values; }
  int[5] get_values() { return {1,2,3,4,5}; }
  Data d;
  d.values = get_values();
  ```
- [ ] 代入処理拡張
- [ ] メモリコピー処理実装
- [ ] 型チェック拡張
- [ ] テスト追加（10個）

#### Day 4-7: 多次元配列戻り値代入
- [ ] 仕様確定
  ```cb
  int[3][3] get_matrix() { return {{1,2,3},{4,5,6},{7,8,9}}; }
  int x = get_matrix()[1][1];
  ```
- [ ] 一時オブジェクト管理実装
- [ ] チェーン処理実装
- [ ] メモリ安全性確保
- [ ] テスト追加（12個）

---

## 📋 Phase 3: 品質向上（1-2週間）

### Week 6: 警告システム

#### Day 1-3: 基本警告機能
- [ ] WarningSystem クラス作成
- [ ] 警告レベル定義
- [ ] コマンドラインオプション
  - [ ] `-Wall`
  - [ ] `-Werror`
  - [ ] `-Wno-xxx`
- [ ] 基本的な警告実装
  - [ ] 未使用変数警告
  - [ ] 型の暗黙変換警告

#### Day 4-5: 高度な警告機能
- [ ] 符号付き/符号なし比較警告
- [ ] 到達不可能コード警告
- [ ] 未初期化変数警告
- [ ] 警告の抑制機能
- [ ] テスト追加（20個）

### Week 7: 最適化と仕上げ

#### Day 1-2: メモリ最適化
- [ ] スコープ管理の統一化
- [ ] 不要なコピーの削減
- [ ] メモリアクセスパターン最適化
- [ ] パフォーマンステスト
- [ ] ベンチマーク比較

#### Day 3-4: パーサー最適化
- [ ] 頻繁に呼ばれる関数の特定
- [ ] インライン化検討
- [ ] トークン先読みの最適化
- [ ] エラーメッセージ生成の遅延評価
- [ ] パフォーマンステスト

#### Day 5-7: 総合テストとドキュメント
- [ ] 全統合テスト実行（600個目標）
- [ ] 全ユニットテスト実行（100個目標）
- [ ] カバレッジ確認（80%目標）
- [ ] パフォーマンステスト
  - [ ] 実行速度計測
  - [ ] メモリ使用量計測
- [ ] ドキュメント完成
  - [ ] チュートリアル完成
  - [ ] APIリファレンス
  - [ ] リリースノート作成

---

## 📋 Phase 4: リリース準備（3-5日）

### Day 1-2: 最終チェック
- [ ] コードレビュー
  - [ ] 全変更のレビュー
  - [ ] コーディング規約チェック
  - [ ] コメントの充実度確認
- [ ] テスト実行
  - [ ] 全統合テスト
  - [ ] 全ユニットテスト
  - [ ] リグレッションテスト
  - [ ] パフォーマンステスト
- [ ] ドキュメントレビュー
  - [ ] 誤字脱字チェック
  - [ ] サンプルコードの動作確認
  - [ ] リンク切れチェック

### Day 3: リリースノート作成
- [ ] リリースノート作成
  - [ ] 新機能の説明
  - [ ] 変更内容の詳細
  - [ ] パフォーマンス改善
  - [ ] 既知の問題
  - [ ] アップグレードガイド
- [ ] README.md更新
  - [ ] バージョン番号
  - [ ] 新機能の説明
  - [ ] インストール手順
- [ ] CHANGELOGの更新

### Day 4-5: リリース作業
- [ ] バージョンタグ作成
  ```bash
  git tag -a v0.9.2 -m "Release v0.9.2"
  ```
- [ ] GitHubリリース作成
  - [ ] リリースノート添付
  - [ ] バイナリ添付（オプション）
- [ ] ドキュメントサイト更新（将来）
- [ ] リリースアナウンス

---

## ✅ 各Phase完了チェックリスト

### Phase 1完了確認
- [ ] interpreter.cpp 1,000行以下
- [ ] TypeHelpers拡充完了（7関数追加）
- [ ] エラーメッセージに列番号表示
- [ ] テスト追加（45個以上）
- [ ] 全テスト合格
- [ ] ドキュメント更新

### Phase 2完了確認
- [ ] 配列参照型実装完了
- [ ] 構造体配列メンバー代入実装完了
- [ ] 多次元配列戻り値代入実装完了
- [ ] テスト追加（37個以上）
- [ ] 全テスト合格
- [ ] spec.md更新

### Phase 3完了確認
- [ ] 警告システム実装完了
- [ ] メモリ最適化完了
- [ ] パーサー最適化完了
- [ ] 実行速度5-10%向上
- [ ] テスト追加（20個以上）
- [ ] 全テスト合格
- [ ] チュートリアル完成

### v0.9.2リリース確認
- [ ] 全Phase完了
- [ ] 統合テスト600個以上
- [ ] ユニットテスト100個以上
- [ ] コードカバレッジ80%以上
- [ ] 全ドキュメント更新完了
- [ ] リリースノート作成完了
- [ ] バージョンタグ作成完了

---

## 🎯 毎日の作業フロー

### 朝（作業開始時）
1. [ ] git pull（最新コード取得）
2. [ ] 今日のタスク確認
3. [ ] ビルド確認（`make clean && make -j4`）
4. [ ] テスト実行（`make test`）

### 作業中
1. [ ] 小さな単位でコミット
2. [ ] コミットメッセージは明確に
3. [ ] 定期的にテスト実行
4. [ ] ドキュメント更新

### 夕方（作業終了時）
1. [ ] 全テスト実行
2. [ ] 変更をコミット
3. [ ] 進捗をメモ
4. [ ] 明日のタスク確認

---

## 📊 進捗トラッキング

### Week 1
- [ ] Day 1完了
- [ ] Day 2完了
- [ ] Day 3完了
- [ ] Day 4完了
- [ ] Day 5完了
- [ ] Day 6完了
- [ ] Day 7完了

### Week 2
- [ ] Day 8完了
- [ ] Day 9完了
- [ ] Day 10完了
- [ ] Day 11完了
- [ ] Day 12完了
- [ ] Day 13完了
- [ ] Day 14完了

### Week 3-4
（配列参照型実装）
- [ ] Week 3完了
- [ ] Week 4完了

### Week 5
（構造体・多次元配列機能）
- [ ] Week 5完了

### Week 6
（警告システム）
- [ ] Week 6完了

### Week 7
（最適化と仕上げ）
- [ ] Week 7完了

### リリース準備
- [ ] 最終チェック完了
- [ ] リリースノート作成完了
- [ ] リリース作業完了

---

## 🚀 クイックコマンド

```bash
# ビルド
make clean && make -j4

# テスト実行
make test

# 特定のテスト実行
./main tests/cases/array_reference/test_basic.cb

# カバレッジ計測（gcov使用）
make clean
make CFLAGS="-fprofile-arcs -ftest-coverage" -j4
make test
gcov src/**/*.cpp

# パフォーマンステスト
time make test

# メモリリークチェック（valgrind）
valgrind --leak-check=full ./main tests/cases/basic/hello.cb

# コミット
git add -A
git commit -m "feat(interpreter): split interpreter.cpp into multiple files"
git push origin feature/v0.9.2
```

---

**作成日**: 2025年10月9日  
**最終更新**: 2025年10月9日  
**次の更新**: 毎日の進捗に応じて  
**ステータス**: 準備完了 - 実装開始可能
