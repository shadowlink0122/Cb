# Cb言語 v0.11.0 実装ロードマップ

**作成日**: 2025年10月26日  
**対象バージョン**: v0.11.0  
**目標リリース**: 2026年2月中旬

---

## 📋 実装概要

v0.11.0では、ジェネリクス、文字列補間、非同期処理（async/await）、そしてRust風のエラーハンドリング（Result型）を段階的に導入します。

### v0.11.0の構成

#### Part 1: 基盤機能（✅ 完了）
1. **ジェネリクスシステム** - 構造体、関数、列挙型のジェネリクス
2. **文字列補間** - `{expression:format}` 構文

#### Part 2: 非同期処理（🔵 進行中）
3. **Event Loop** - 非同期タスクのスケジューリング
4. **Future<T>型** - 非同期処理の結果を表現
5. **Result<T, E>型** - 明示的なエラーハンドリング
6. **パターンマッチング** - Result型との統合
7. **async/await構文** - TypeScript/Rust風の非同期構文
8. **?オペレーター** - エラー伝播の簡潔な記法

**注**: Part 1は2025年10月27日に完了。Part 2は引き続き実装中。

---

## 🗓️ 実装スケジュール

### 全体スケジュール（16週間）

| Phase | 機能 | 期間 | 開始日 | 完了予定 | ステータス |
|-------|-----|------|--------|---------|----------|
| **0** | ジェネリクス + 文字列補間 | 4週間 | 2025/10/01 | 2025/10/27 | ✅ 完了 |
| **1** | Event Loop + タイマー | 2週間 | 2025/10/28 | 2025/11/10 | 🔵 進行中 |
| **2** | Future<T>型 | 1週間 | 2025/11/11 | 2025/11/17 | ⚪ 未着手 |
| **3** | Result<T, E> + パターンマッチング | 3週間 | 2025/11/18 | 2025/12/8 | ⚪ 未着手 |
| **4** | async/await構文 | 3週間 | 2025/12/9 | 2025/12/29 | ⚪ 未着手 |
| **5** | ?オペレーター | 1週間 | 2025/12/30 | 2026/1/5 | ⚪ 未着手 |
| **6** | 並行実行 + ライブラリ | 2週間 | 2026/1/6 | 2026/1/19 | ⚪ 未着手 |

**リリース目標**: 2026年1月19日

**更新**: 2025年10月27日
- Phase 0完了: ジェネリクスシステム（構造体、関数、enum）と文字列補間機能を実装
- テスト: 3,211個（100%成功）
- 次のPhase: Event Loop実装を開始予定

---

## 📝 Phase別詳細

### Phase 0: ジェネリクス + 文字列補間【4週間】✅ 完了

**期間**: 2025/10/01 - 2025/10/27  
**ステータス**: ✅ 完了  
**ドキュメント**: `v0.11.0_generics_minimal_spec.md`, `docs/features/string_interpolation.md`

#### 実装内容

**ジェネリクスシステム**
- ✅ 型パラメータの構文解析（`<T>`, `<T, E>`）
- ✅ ジェネリック構造体（`Box<T>`, `Option<T>`, `Result<T, E>`）
- ✅ ジェネリック関数（`fn swap<T>(T a, T b)`）
- ✅ ジェネリック列挙型（`enum Option<T> { Some(T), None }`）
- ✅ ネストしたジェネリック型（`Box<Option<int>>`）
- ✅ 配列・ポインタ型のサポート
- ✅ インスタンス化キャッシュ
- ✅ テスト: 37ケース

**文字列補間機能**
- ✅ `{expression:format}` 構文
- ✅ 変数、式、配列アクセス、メンバーアクセスの埋め込み
- ✅ フォーマット指定子（`:x`, `:.2`, `:05`, `:b`）
- ✅ エスケープシーケンス（`{{`, `}}`）
- ✅ テスト: 13ケース（80アサーション）

#### 成果物
- ✅ ジェネリック構造体・関数・Enumの完全実装
- ✅ 文字列補間の完全実装
- ✅ 50個のテストケース（100%成功）
- ✅ API仕様書とサンプルコード
- ✅ コーディングガイドライン作成

#### マイルストーン
- 🎯 **v0.11.0-part1**: ジェネリクス + 文字列補間（2025/10/27完了）✅
- 📝 リリースノート: `release_notes/v0.11.0.md`
- 🔗 コミット: `1da0122` (string interpolation), `e433166` (release notes)

---

### Phase 1: Event Loop + タイマー【2週間】🔵 次のフェーズ

**期間**: 2025/10/28 - 2025/11/10  
**ステータス**: 🔵 次のフェーズ

#### 週次目標

**Week 1: Event Loop実装**
- [ ] タスクキューの実装
- [ ] スケジューラーの実装
- [ ] run/stop メソッド
- [ ] テスト: 15個

**Week 2: タイマー実装**
- [ ] sleep_ms の実装
- [ ] タイマーキューの管理
- [ ] 精度テスト
- [ ] テスト: 10個

#### 成果物
- ✅ Event Loop実装
- ✅ 基本的なタイマー機能
- ✅ 25個のテスト

#### マイルストーン
- 🎯 **v0.11.0-alpha.2**: Event Loopのプレビュー（2025/12/7）

---

### Phase 2: Future<T>型【1週間】

**期間**: 2025/11/11 - 2025/11/17

#### タスク
- [ ] Future<T>構造体の定義（ジェネリクスを使用）
- [ ] 状態管理（Pending, Ready）
- [ ] get/set メソッド
- [ ] is_ready関数
- [ ] テスト: 20個

#### 成果物
- ✅ Future<T>型の実装
- ✅ Future操作関数
- ✅ 20個のテスト

---

### Phase 3: Result<T, E> + パターンマッチング【3週間】

**期間**: 2025/11/18 - 2025/12/8

#### 週次目標

**Week 1: Result<T, E>型**
- [ ] Result<T, E> Enumの定義（ジェネリクスを使用）
- [ ] Ok/Err バリアントの実装
- [ ] Result値の作成
- [ ] テスト: 15個

**Week 2: パターンマッチング**
- [ ] match文の構文解析
- [ ] Enumバリアントのマッチング
- [ ] 値の抽出（`Ok(value)`, `Err(error)`）
- [ ] テスト: 15個

**Week 3: Result型メソッド**
- [ ] unwrap/expect
- [ ] unwrap_or/unwrap_or_else
- [ ] is_ok/is_err
- [ ] map/and_then
- [ ] テスト: 20個

#### 成果物
- ✅ Result<T, E>型の実装
- ✅ パターンマッチングの実装
- ✅ Result型のメソッド群
- ✅ 50個のテスト

#### マイルストーン
- 🎯 **v0.11.0-beta.1**: Result型のプレビュー（2025/12/8）

---

### Phase 4: async/await構文【3週間】

**期間**: 2025/12/9 - 2025/12/29

#### 週次目標

**Week 1: パーサー拡張**
- [ ] async/awaitキーワードの認識
- [ ] async関数定義の構文解析
- [ ] await式の構文解析
- [ ] AST拡張

**Week 2: インタプリタ実装**
- [ ] async関数の実行（Future<Result<T, E>>を返す）
- [ ] await式の評価
- [ ] コンテキスト切り替え

**Week 3: Event Loop統合**
- [ ] async関数とEvent Loopの統合
- [ ] タスクスケジューリング
- [ ] テスト: 30個

#### 成果物
- ✅ async/await構文の完全実装
- ✅ Event Loopとの統合
- ✅ 30個のテスト

#### マイルストーン
- 🎯 **v0.11.0-beta.2**: async/awaitのプレビュー（2025/12/29）

---

### Phase 5: ?オペレーター【1週間】

**期間**: 2025/12/30 - 2026/1/5

#### タスク
- [ ] ?オペレーターの構文解析
- [ ] エラー伝播ロジック
- [ ] 型チェック
- [ ] テスト: 15個

#### 成果物
- ✅ ?オペレーターの実装
- ✅ 15個のテスト

---

### Phase 6: 並行実行 + ライブラリ【2週間】

**期間**: 2026/1/6 - 2026/1/19

#### 週次目標

**Week 1: 並行実行**
- [ ] 複数のFutureを同時に開始
- [ ] 各Futureを個別にawait
- [ ] テスト: 15個

**Week 2: 標準ライブラリ**
- [ ] stdlib/async.cbの充実
- [ ] 基本的なエラー型の定義
- [ ] サンプルコードの作成
- [ ] ドキュメント完成

#### 成果物
- ✅ 並行実行のサポート
- ✅ 充実した標準ライブラリ
- ✅ 実用的なサンプルコード
- ✅ 完全なドキュメント

#### マイルストーン
- 🎯 **v0.11.0**: 正式リリース（2026/1/19）

---

## 🧪 テスト計画

### テスト目標

| Phase | テスト数 | 累計 | ステータス |
|-------|---------|------|-----------|
| Phase 0 | 50 | 50 | ✅ 完了 |
| Phase 1 | 25 | 75 | ⚪ 未着手 |
| Phase 2 | 20 | 95 | ⚪ 未着手 |
| Phase 3 | 50 | 145 | ⚪ 未着手 |
| Phase 4 | 30 | 175 | ⚪ 未着手 |
| Phase 5 | 15 | 190 | ⚪ 未着手 |
| Phase 6 | 15 | 205 | ⚪ 未着手 |
| **合計** | **205** | **205** | **24% 完了** |

**更新**: 2025年10月27日
- Phase 0完了: 50テストケース（37 generics + 13 string interpolation）
- 全体の進捗: 50/205 = 24%

### テストカバレッジ目標

- **ユニットテスト**: 85%以上
- **統合テスト**: 全機能をカバー
- **パフォーマンステスト**: Event Loop、タイマー

---

## 📚 ドキュメント計画

### 作成予定のドキュメント

1. **設計書**
   - [x] `v0.11.0_async_await_design.md` - async/await設計書（完成）
   - [x] `v0.11.0_generics_minimal_spec.md` - ジェネリクス最小仕様（完成）
   - [x] `docs/features/string_interpolation.md` - 文字列補間仕様（完成）✅
   - [ ] `v0.11.0_event_loop_design.md` - Event Loop設計書
   - [ ] `v0.11.0_pattern_matching_spec.md` - パターンマッチング仕様

2. **API仕様**
   - [ ] `stdlib/async_api.md` - async標準ライブラリAPI
   - [ ] `stdlib/result_api.md` - Result型API
   - [ ] `stdlib/future_api.md` - Future型API

3. **チュートリアル**
   - [ ] `tutorial/async_await_basics.md` - async/awaitの基本
   - [ ] `tutorial/error_handling_with_result.md` - Result型によるエラーハンドリング
   - [ ] `tutorial/pattern_matching.md` - パターンマッチングの使い方
   - [x] `tutorial/generics_intro.md` - ジェネリクスの基本（サンプルコードで実現）✅

4. **仕様更新**
   - [ ] `spec.md` - 言語仕様書の更新
   - [ ] `BNF.md` - BNF文法の更新

5. **コーディングガイドライン**
   - [x] `docs/CODING_GUIDELINES.md` - テスト作成手順と開発ワークフロー（完成）✅

---

## 🎯 成功基準

### v0.11.0リリースの必須条件

- ✅ Phase 0完了（ジェネリクス + 文字列補間）
- ⚪ Phase 1-6完了
- ⚪ 205個のテストがすべてパス（現在: 50/205完了）
- ⚪ ドキュメントが完成
- ⚪ サンプルコードが動作
- ⚪ パフォーマンスが許容範囲内

**現在の進捗**: 24% (Phase 0完了)

### デモアプリケーション

リリース時に以下のデモを用意：

1. **非同期HTTPクライアント**
   ```cb
   async Result<string, NetworkError> fetch_data(string url);
   ```

2. **並行ファイル処理**
   ```cb
   async Result<void, FileError> process_files();
   ```

3. **エラーハンドリングのベストプラクティス**
   ```cb
   async Result<User, AppError> complex_operation();
   ```

---

## 🚨 リスクと対策

### 実装リスク

| リスク | 影響 | 対策 |
|-------|------|------|
| ジェネリクスの複雑性 | 高 | 最小限の機能に絞る |
| Event Loopのバグ | 高 | 段階的なテスト |
| パターンマッチングの実装難易度 | 中 | 既存のswitch文を参考に |
| スケジュール遅延 | 中 | 週次レビューで早期発見 |

### 品質管理

- **毎週のコードレビュー**
- **継続的インテグレーション**
- **パフォーマンス監視**
- **ドキュメントの同期更新**

---

## 📊 進捗管理

### 週次チェックポイント

毎週日曜日に以下を確認：
- [ ] 今週の目標達成率
- [ ] テストの合格率
- [ ] ドキュメントの更新状況
- [ ] 次週の計画

### マイルストーン

- ✅ **2025/10/27**: Phase 0完了（ジェネリクス + 文字列補間）
- 🎯 **2025/11/10**: Phase 1完了（Event Loop）
- 🎯 **2025/12/8**: Phase 3完了（Result型）
- 🎯 **2025/12/29**: Phase 4完了（async/await）
- 🎯 **2026/1/19**: v0.11.0リリース

---

## 🔄 更新履歴

- **2025/10/27**: Phase 0完了とロードマップ更新
  - ジェネリクスシステム実装完了（構造体、関数、enum）
  - 文字列補間機能実装完了
  - 50テストケース追加（100%成功）
  - コーディングガイドライン作成
  - リリースノート作成（v0.11.0-part1）
  - スケジュール更新（1ヶ月前倒し）

- **2025/10/26**: ロードマップ作成
  - async/await設計確定
  - Result型の採用決定
  - ジェネリクスを前提条件に追加
  - 16週間の実装スケジュール策定

---

**作成者**: GitHub Copilot  
**レビュアー**: shadowlink0122  
**最終更新**: 2025/10/27（Phase 0完了）  
**次回レビュー**: 2025/11/10（Phase 1完了時）
