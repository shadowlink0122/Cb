# Cb言語 v0.11.0 実装ロードマップ

**作成日**: 2025年10月26日  
**対象バージョン**: v0.11.0  
**目標リリース**: 2026年2月中旬

---

## 📋 実装概要

v0.11.0では、非同期処理（async/await）とRust風のエラーハンドリング（Result型）を導入します。これにはジェネリクス（テンプレート）の実装が前提条件となります。

### 主要機能

1. **ジェネリクス（基本機能）** - `Future<T>`, `Result<T, E>`の基盤
2. **Event Loop** - 非同期タスクのスケジューリング
3. **Future<T>型** - 非同期処理の結果を表現
4. **Result<T, E>型** - 明示的なエラーハンドリング
5. **パターンマッチング** - Result型との統合
6. **async/await構文** - TypeScript/Rust風の非同期構文
7. **?オペレーター** - エラー伝播の簡潔な記法

---

## 🗓️ 実装スケジュール

### 全体スケジュール（16週間）

| Phase | 機能 | 期間 | 開始日 | 完了予定 | ステータス |
|-------|-----|------|--------|---------|----------|
| **0** | ジェネリクス（基本） | 4週間 | 2025/10/26 | 2025/11/23 | 🔵 準備中 |
| **1** | Event Loop + タイマー | 2週間 | 2025/11/24 | 2025/12/7 | ⚪ 未着手 |
| **2** | Future<T>型 | 1週間 | 2025/12/8 | 2025/12/14 | ⚪ 未着手 |
| **3** | Result<T, E> + パターンマッチング | 3週間 | 2025/12/15 | 2026/1/4 | ⚪ 未着手 |
| **4** | async/await構文 | 3週間 | 2026/1/5 | 2026/1/25 | ⚪ 未着手 |
| **5** | ?オペレーター | 1週間 | 2026/1/26 | 2026/2/1 | ⚪ 未着手 |
| **6** | 並行実行 + ライブラリ | 2週間 | 2026/2/2 | 2026/2/15 | ⚪ 未着手 |

**リリース目標**: 2026年2月15日

---

## 📝 Phase別詳細

### Phase 0: ジェネリクス（基本）【4週間】

**期間**: 2025/10/26 - 2025/11/23  
**ドキュメント**: `v0.11.0_generics_minimal_spec.md`

#### 週次目標

**Week 1-2: ジェネリック構造体**
- [ ] 型パラメータの構文解析（`<T>`, `<T, E>`）
- [ ] 構造体定義での型パラメータ
- [ ] インスタンス化の実装（`Box<int>`, `Future<string>`）
- [ ] インスタンス化キャッシュ
- [ ] テスト: 20個

**Week 3: ジェネリックEnum**
- [ ] バリアント付きEnumの構文解析
- [ ] `enum Result<T, E> { Ok(T), Err(E) }` の実装
- [ ] Enumインスタンス化
- [ ] テスト: 10個

**Week 4: 統合とデバッグ**
- [ ] ネストした型のテスト（`Future<Result<int, Error>>`）
- [ ] エラーメッセージの改善
- [ ] パフォーマンステスト
- [ ] ドキュメント更新

#### 成果物
- ✅ ジェネリック構造体の実装
- ✅ ジェネリックEnumの実装
- ✅ 40個のテスト
- ✅ API仕様書

#### マイルストーン
- 🎯 **v0.11.0-alpha.1**: ジェネリクスのプレビューリリース（2025/11/23）

---

### Phase 1: Event Loop + タイマー【2週間】

**期間**: 2025/11/24 - 2025/12/7

#### 週次目標

**Week 1: Event Loop実装**
- [ ] タスクキューの実装
- [ ] スケジューラーの実装
- [ ] run/stop メソッド
- [ ] テスト: 15個

**Week 2: タイマー実装**
- [ ] sleep_ms の実装
- [ ] タイマーキューの管理
- [ ] 精度テスト
- [ ] テスト: 10個

#### 成果物
- ✅ Event Loop実装
- ✅ 基本的なタイマー機能
- ✅ 25個のテスト

#### マイルストーン
- 🎯 **v0.11.0-alpha.2**: Event Loopのプレビュー（2025/12/7）

---

### Phase 2: Future<T>型【1週間】

**期間**: 2025/12/8 - 2025/12/14

#### タスク
- [ ] Future<T>構造体の定義（ジェネリクスを使用）
- [ ] 状態管理（Pending, Ready）
- [ ] get/set メソッド
- [ ] is_ready関数
- [ ] テスト: 20個

#### 成果物
- ✅ Future<T>型の実装
- ✅ Future操作関数
- ✅ 20個のテスト

---

### Phase 3: Result<T, E> + パターンマッチング【3週間】

**期間**: 2025/12/15 - 2026/1/4

#### 週次目標

**Week 1: Result<T, E>型**
- [ ] Result<T, E> Enumの定義（ジェネリクスを使用）
- [ ] Ok/Err バリアントの実装
- [ ] Result値の作成
- [ ] テスト: 15個

**Week 2: パターンマッチング**
- [ ] match文の構文解析
- [ ] Enumバリアントのマッチング
- [ ] 値の抽出（`Ok(value)`, `Err(error)`）
- [ ] テスト: 15個

**Week 3: Result型メソッド**
- [ ] unwrap/expect
- [ ] unwrap_or/unwrap_or_else
- [ ] is_ok/is_err
- [ ] map/and_then
- [ ] テスト: 20個

#### 成果物
- ✅ Result<T, E>型の実装
- ✅ パターンマッチングの実装
- ✅ Result型のメソッド群
- ✅ 50個のテスト

#### マイルストーン
- 🎯 **v0.11.0-beta.1**: Result型のプレビュー（2026/1/4）

---

### Phase 4: async/await構文【3週間】

**期間**: 2026/1/5 - 2026/1/25

#### 週次目標

**Week 1: パーサー拡張**
- [ ] async/awaitキーワードの認識
- [ ] async関数定義の構文解析
- [ ] await式の構文解析
- [ ] AST拡張

**Week 2: インタプリタ実装**
- [ ] async関数の実行（Future<Result<T, E>>を返す）
- [ ] await式の評価
- [ ] コンテキスト切り替え

**Week 3: Event Loop統合**
- [ ] async関数とEvent Loopの統合
- [ ] タスクスケジューリング
- [ ] テスト: 30個

#### 成果物
- ✅ async/await構文の完全実装
- ✅ Event Loopとの統合
- ✅ 30個のテスト

#### マイルストーン
- 🎯 **v0.11.0-beta.2**: async/awaitのプレビュー（2026/1/25）

---

### Phase 5: ?オペレーター【1週間】

**期間**: 2026/1/26 - 2026/2/1

#### タスク
- [ ] ?オペレーターの構文解析
- [ ] エラー伝播ロジック
- [ ] 型チェック
- [ ] テスト: 15個

#### 成果物
- ✅ ?オペレーターの実装
- ✅ 15個のテスト

---

### Phase 6: 並行実行 + ライブラリ【2週間】

**期間**: 2026/2/2 - 2026/2/15

#### 週次目標

**Week 1: 並行実行**
- [ ] 複数のFutureを同時に開始
- [ ] 各Futureを個別にawait
- [ ] テスト: 15個

**Week 2: 標準ライブラリ**
- [ ] stdlib/async.cbの充実
- [ ] 基本的なエラー型の定義
- [ ] サンプルコードの作成
- [ ] ドキュメント完成

#### 成果物
- ✅ 並行実行のサポート
- ✅ 充実した標準ライブラリ
- ✅ 実用的なサンプルコード
- ✅ 完全なドキュメント

#### マイルストーン
- 🎯 **v0.11.0**: 正式リリース（2026/2/15）

---

## 🧪 テスト計画

### テスト目標

| Phase | テスト数 | 累計 |
|-------|---------|------|
| Phase 0 | 40 | 40 |
| Phase 1 | 25 | 65 |
| Phase 2 | 20 | 85 |
| Phase 3 | 50 | 135 |
| Phase 4 | 30 | 165 |
| Phase 5 | 15 | 180 |
| Phase 6 | 15 | 195 |
| **合計** | **195** | **195** |

### テストカバレッジ目標

- **ユニットテスト**: 85%以上
- **統合テスト**: 全機能をカバー
- **パフォーマンステスト**: Event Loop、タイマー

---

## 📚 ドキュメント計画

### 作成予定のドキュメント

1. **設計書**
   - [x] `v0.11.0_async_await_design.md` - async/await設計書（完成）
   - [x] `v0.11.0_generics_minimal_spec.md` - ジェネリクス最小仕様（完成）
   - [ ] `v0.11.0_event_loop_design.md` - Event Loop設計書
   - [ ] `v0.11.0_pattern_matching_spec.md` - パターンマッチング仕様

2. **API仕様**
   - [ ] `stdlib/async_api.md` - async標準ライブラリAPI
   - [ ] `stdlib/result_api.md` - Result型API
   - [ ] `stdlib/future_api.md` - Future型API

3. **チュートリアル**
   - [ ] `tutorial/async_await_basics.md` - async/awaitの基本
   - [ ] `tutorial/error_handling_with_result.md` - Result型によるエラーハンドリング
   - [ ] `tutorial/pattern_matching.md` - パターンマッチングの使い方
   - [ ] `tutorial/generics_intro.md` - ジェネリクスの基本

4. **仕様更新**
   - [ ] `spec.md` - 言語仕様書の更新
   - [ ] `BNF.md` - BNF文法の更新

---

## 🎯 成功基準

### v0.11.0リリースの必須条件

- ✅ すべてのPhaseが完了
- ✅ 195個のテストがすべてパス
- ✅ ドキュメントが完成
- ✅ サンプルコードが動作
- ✅ パフォーマンスが許容範囲内

### デモアプリケーション

リリース時に以下のデモを用意：

1. **非同期HTTPクライアント**
   ```cb
   async Result<string, NetworkError> fetch_data(string url);
   ```

2. **並行ファイル処理**
   ```cb
   async Result<void, FileError> process_files();
   ```

3. **エラーハンドリングのベストプラクティス**
   ```cb
   async Result<User, AppError> complex_operation();
   ```

---

## 🚨 リスクと対策

### 実装リスク

| リスク | 影響 | 対策 |
|-------|------|------|
| ジェネリクスの複雑性 | 高 | 最小限の機能に絞る |
| Event Loopのバグ | 高 | 段階的なテスト |
| パターンマッチングの実装難易度 | 中 | 既存のswitch文を参考に |
| スケジュール遅延 | 中 | 週次レビューで早期発見 |

### 品質管理

- **毎週のコードレビュー**
- **継続的インテグレーション**
- **パフォーマンス監視**
- **ドキュメントの同期更新**

---

## 📊 進捗管理

### 週次チェックポイント

毎週日曜日に以下を確認：
- [ ] 今週の目標達成率
- [ ] テストの合格率
- [ ] ドキュメントの更新状況
- [ ] 次週の計画

### マイルストーン

- 🎯 **2025/11/23**: Phase 0完了（ジェネリクス）
- 🎯 **2025/12/7**: Phase 1完了（Event Loop）
- 🎯 **2026/1/4**: Phase 3完了（Result型）
- 🎯 **2026/1/25**: Phase 4完了（async/await）
- 🎯 **2026/2/15**: v0.11.0リリース

---

## 🔄 更新履歴

- **2025/10/26**: ロードマップ作成
  - async/await設計確定
  - Result型の採用決定
  - ジェネリクスを前提条件に追加
  - 16週間の実装スケジュール策定

---

**作成者**: GitHub Copilot  
**レビュアー**: shadowlink0122  
**次回レビュー**: 2025/11/3（Phase 0 Week 1完了時）
