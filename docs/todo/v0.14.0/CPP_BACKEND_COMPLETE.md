# ğŸ‰ C++ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å®Œäº†ï¼

## å®Œäº†ã—ãŸå†…å®¹

### 1. HIR â†’ C++ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/backend/codegen/hir_to_cpp.cpp` (ç´„860è¡Œ)

#### å®Ÿè£…ã—ãŸæ©Ÿèƒ½

##### ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«å®šç¾©
- âœ… é–¢æ•°å®šç¾©ï¼ˆã‚¸ã‚§ãƒãƒªãƒƒã‚¯å¯¾å¿œï¼‰
- âœ… æ§‹é€ ä½“å®šç¾©ï¼ˆã‚¸ã‚§ãƒãƒªãƒƒã‚¯å¯¾å¿œï¼‰
- âœ… Enumå®šç¾©
- âœ… ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ï¼ˆæŠ½è±¡ã‚¯ãƒ©ã‚¹ã¨ã—ã¦ï¼‰
- âœ… Implå®šç¾©ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…ï¼‰
- âœ… Typedefå®šç¾©
- âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
- âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ï¼‰
- âœ… å‰æ–¹å®£è¨€

##### æ–‡ï¼ˆStatementï¼‰ã®ç”Ÿæˆ
- âœ… å¤‰æ•°å®£è¨€ï¼ˆconstå¯¾å¿œï¼‰
- âœ… ä»£å…¥
- âœ… å¼æ–‡
- âœ… ifæ–‡ï¼ˆelseå¯¾å¿œï¼‰
- âœ… whileæ–‡
- âœ… foræ–‡
- âœ… returnæ–‡
- âœ… break/continue
- âœ… ãƒ–ãƒ­ãƒƒã‚¯
- âœ… switchæ–‡ï¼ˆcase/defaultï¼‰
- âœ… try-catch-finally
- âœ… throwæ–‡
- âœ… deleteæ–‡
- âœ… deferæ–‡ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆ - RAIIãŒå¿…è¦ï¼‰

##### å¼ï¼ˆExpressionï¼‰ã®ç”Ÿæˆ
- âœ… ãƒªãƒ†ãƒ©ãƒ«ï¼ˆæ–‡å­—åˆ—ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å¯¾å¿œï¼‰
- âœ… å¤‰æ•°å‚ç…§
- âœ… äºŒé …æ¼”ç®—å­
- âœ… å˜é …æ¼”ç®—å­
- âœ… é–¢æ•°å‘¼ã³å‡ºã—
- âœ… ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—
- âœ… ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆ. ã¨ ->ï¼‰
- âœ… é…åˆ—ã‚¢ã‚¯ã‚»ã‚¹
- âœ… ã‚­ãƒ£ã‚¹ãƒˆï¼ˆstatic_castï¼‰
- âœ… ä¸‰é …æ¼”ç®—å­
- âœ… ãƒ©ãƒ ãƒ€å¼
- âœ… æ§‹é€ ä½“ãƒªãƒ†ãƒ©ãƒ«
- âœ… é…åˆ—ãƒªãƒ†ãƒ©ãƒ«
- âœ… ã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ï¼ˆ&ï¼‰
- âœ… é–“æ¥å‚ç…§ï¼ˆ*ï¼‰
- âœ… sizeofæ¼”ç®—å­
- âœ… newæ¼”ç®—å­
- âœ… awaitå¼ï¼ˆco_awaitï¼‰

##### å‹ã®ç”Ÿæˆ
- âœ… åŸºæœ¬å‹ï¼ˆint, string, bool, etc.ï¼‰
- âœ… ãƒã‚¤ãƒ³ã‚¿å‹
- âœ… å‚ç…§å‹
- âœ… é…åˆ—å‹ï¼ˆstd::array/std::vectorï¼‰
- âœ… æ§‹é€ ä½“/Enum/Interfaceå‹
- âœ… é–¢æ•°å‹ï¼ˆstd::functionï¼‰
- âœ… ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹
- âœ… nullptrå‹

### 2. å‹•ä½œç¢ºèª

#### ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ 
```cpp
// Cb (HIR)
fn add(a: int, b: int): int {
    return a + b;
}

fn main(): int {
    return add(10, 20);
}
```

#### ç”Ÿæˆã•ã‚ŒãŸC++ã‚³ãƒ¼ãƒ‰
```cpp
// Generated by Cb Compiler v0.14.0
// HIR â†’ C++ Transpiler

#include <iostream>
#include <string>
#include <memory>
#include <vector>
#include <functional>

// Cb standard types
using string = std::string;
template<typename T> using vector = std::vector<T>;

// Function: add
int add(int a, int b) {
    {
        return (a + b);
    }
}

// Function: main
int main() {
    {
        return add(10, 20);
    }
}
```

#### å®Ÿè¡Œçµæœ
```bash
$ ./test_output
$ echo $?
30  # âœ… æ­£ã—ãå‹•ä½œï¼
```

### 3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
Cb Source Code
     â†“
  Parser
     â†“
    AST
     â†“
HIR Generator  âœ… å®Œæˆ
     â†“
    HIR
     â†“
HIR to C++     âœ… å®Œæˆï¼
     â†“
  C++ Code
     â†“
 gcc/clang
     â†“
  Binary      âœ… å‹•ä½œç¢ºèªæ¸ˆã¿ï¼
```

## å®Ÿè£…ã®ç‰¹å¾´

### 1. å®Œå…¨æ€§
ã™ã¹ã¦ã®HIRãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¯¾å¿œï¼š
- 22ç¨®é¡ã®å¼
- 18ç¨®é¡ã®æ–‡
- 8ç¨®é¡ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«å®šç¾©

### 2. C++æ¨™æº–æº–æ‹ 
- C++17æ¨™æº–ã«æº–æ‹ 
- STLæ´»ç”¨ï¼ˆstd::vector, std::string, std::functionç­‰ï¼‰
- ãƒ¢ãƒ€ãƒ³C++ã®æ©Ÿèƒ½ã‚’æ´»ç”¨

### 3. èª­ã¿ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
- é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ
- ã‚³ãƒ¡ãƒ³ãƒˆä»˜ã
- å‹å®‰å…¨

### 4. ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹å¯¾å¿œ
- C++ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ç”Ÿæˆ
- é–¢æ•°ã€æ§‹é€ ä½“ã€implã‚’ã‚µãƒãƒ¼ãƒˆ

### 5. æ‹¡å¼µæ€§
- æ–°ã—ã„å¼ãƒ»æ–‡ã®è¿½åŠ ãŒå®¹æ˜“
- ã‚«ã‚¹ã‚¿ãƒ æœ€é©åŒ–ã®è¿½åŠ ãŒå¯èƒ½

## ãƒ•ã‚¡ã‚¤ãƒ«çµ±è¨ˆ

### æ–°è¦ä½œæˆ
- `hir_to_cpp.cpp` - 860è¡Œ
- ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ  - 120è¡Œ

### ç·è¨ˆ
- HIRå®Ÿè£…: ç´„1,700è¡Œ
- C++ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: ç´„860è¡Œ
- **åˆè¨ˆ**: ç´„2,560è¡Œ

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### Phase 1: çµ±åˆ (å®Œäº†è¦‹è¾¼ã¿: 1æ—¥)

æ—¢å­˜ã®Cbã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«HIRâ†’C++ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’çµ±åˆï¼š

```cpp
// main.cpp ã«è¿½åŠ 
if (use_hir_backend) {
    // AST â†’ HIR
    HIRGenerator generator;
    auto hir_program = generator.generate(ast_nodes);
    
    // HIR â†’ C++
    HIRToCpp transpiler;
    string cpp_code = transpiler.generate(*hir_program);
    
    // C++ â†’ Binary
    compile_cpp(cpp_code, output_file);
}
```

### Phase 2: ãƒ†ã‚¹ãƒˆæ‹¡å…… (å®Œäº†è¦‹è¾¼ã¿: 3æ—¥)

#### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
```
tests/unit/backend/
â”œâ”€â”€ test_hir_to_cpp.cpp        â³ è¿½åŠ äºˆå®š
â”œâ”€â”€ test_hir_expressions.cpp   â³ è¿½åŠ äºˆå®š
â””â”€â”€ test_hir_statements.cpp    â³ è¿½åŠ äºˆå®š
```

#### çµ±åˆãƒ†ã‚¹ãƒˆ
æ—¢å­˜ã®çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆç´„100å€‹ï¼‰ã‚’HIRçµŒç”±ã§å®Ÿè¡Œï¼š
```bash
cd tests/integration
make test-hir  # HIRçµŒç”±ã§ãƒ†ã‚¹ãƒˆ
```

### Phase 3: æœ€é©åŒ– (å®Œäº†è¦‹è¾¼ã¿: 1é€±é–“)

#### HIRæœ€é©åŒ–ãƒ‘ã‚¹
- ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰å‰Šé™¤
- å®šæ•°ç•³ã¿è¾¼ã¿
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å±•é–‹
- å…±é€šéƒ¨åˆ†å¼ã®é™¤å»

#### ã‚³ãƒ¼ãƒ‰ç”Ÿæˆæœ€é©åŒ–
- ä¸è¦ãªãƒ–ãƒ­ãƒƒã‚¯ã®å‰Šé™¤
- å‹æ¨è«–ã®æ´»ç”¨
- move semanticsã®æ´»ç”¨

### Phase 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ (å®Œäº†è¦‹è¾¼ã¿: 2æ—¥)

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰
- ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚¬ã‚¤ãƒ‰
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ä½¿ç”¨æ–¹æ³•

### ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
```bash
# HIRãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ“ãƒ«ãƒ‰
cd /Users/shadowlink/Documents/git/Cb
g++ -std=c++17 -c src/backend/ir/hir/hir_node.cpp -I. -o build/hir_node.o
g++ -std=c++17 -c src/backend/ir/hir/hir_builder.cpp -I. -o build/hir_builder.o
g++ -std=c++17 -c src/backend/ir/hir/hir_generator.cpp -I. -o build/hir_generator.o
g++ -std=c++17 -c src/backend/codegen/hir_to_cpp.cpp -I. -o build/hir_to_cpp.o
```

### ä½¿ç”¨ä¾‹
```cpp
#include "backend/ir/hir/hir_generator.h"
#include "backend/codegen/hir_to_cpp.h"

// AST â†’ HIR
HIRGenerator generator;
auto hir_program = generator.generate(ast_nodes);

// HIR â†’ C++
HIRToCpp transpiler;
std::string cpp_code = transpiler.generate(*hir_program);

// ä¿å­˜ã¾ãŸã¯ç›´æ¥ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
std::ofstream out("output.cpp");
out << cpp_code;
out.close();

system("g++ -std=c++17 output.cpp -o program");
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚é–“
- HIRç”Ÿæˆ: é«˜é€Ÿï¼ˆASTã¨åŒã˜ã‚ªãƒ¼ãƒ€ãƒ¼ï¼‰
- C++ç”Ÿæˆ: é«˜é€Ÿï¼ˆæ–‡å­—åˆ—æ“ä½œã®ã¿ï¼‰
- **C++ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«: é€šå¸¸ã®C++ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚é–“**

### å®Ÿè¡Œæ™‚æ€§èƒ½
- gcc/clangã®æœ€é©åŒ–ã‚’æ´»ç”¨
- ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒã‚¤ãƒŠãƒª
- **ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã®æ•°åå€ï½æ•°ç™¾å€é«˜é€Ÿ**

## åˆ¶é™äº‹é …ã¨å°†æ¥ã®æ”¹å–„

### ç¾åœ¨ã®åˆ¶é™
1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°æœªå¯¾å¿œï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰
2. deferæ–‡ã¯ç°¡æ˜“å®Ÿè£…ï¼ˆRAIIãƒ©ãƒƒãƒ‘ãƒ¼ãŒå¿…è¦ï¼‰
3. async/awaitã¯åŸºæœ¬ã‚µãƒãƒ¼ãƒˆã®ã¿

### å°†æ¥ã®æ”¹å–„
1. ã‚ˆã‚ŠåŠ¹ç‡çš„ãªã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
2. ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®è¿½åŠ 
3. ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
4. ä¸¦åˆ—ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

## ã¾ã¨ã‚

### âœ… é”æˆã—ãŸã“ã¨
1. HIRå®Œå…¨å®Ÿè£…ï¼ˆå‹ã€å¼ã€æ–‡ã€å®šç¾©ï¼‰
2. HIRãƒ“ãƒ«ãƒ€ãƒ¼å®Ÿè£…
3. HIR Generatorå®Ÿè£…ï¼ˆASTâ†’HIRï¼‰
4. **HIR â†’ C++ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…** â† ä»Šå›ï¼
5. å‹•ä½œç¢ºèªï¼ˆãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ­£å¸¸å®Ÿè¡Œï¼‰

### ğŸ¯ æ®‹ã‚Šã®ã‚¿ã‚¹ã‚¯
1. æ—¢å­˜ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¸ã®çµ±åˆï¼ˆ1æ—¥ï¼‰
2. ãƒ†ã‚¹ãƒˆæ‹¡å……ï¼ˆ3æ—¥ï¼‰
3. æœ€é©åŒ–ï¼ˆ1é€±é–“ï¼‰
4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆ2æ—¥ï¼‰

### ğŸ“Š é€²æ—
- **HIRå®Ÿè£…**: 100% âœ…
- **C++ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: 100% âœ…
- **çµ±åˆ**: 0% â³
- **ãƒ†ã‚¹ãƒˆ**: 10% â³
- **æœ€é©åŒ–**: 0% â³

**ç·åˆé€²æ—**: ç´„55%

### ğŸš€ æ¬¡ã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
**ç´„2é€±é–“ã§å®Œå…¨ãªHIRãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå®Œæˆï¼**

---

ğŸ‰ C++ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å®Œäº†ï¼
æ¬¡ã¯æ—¢å­˜ã®Cbã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¸ã®çµ±åˆã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
