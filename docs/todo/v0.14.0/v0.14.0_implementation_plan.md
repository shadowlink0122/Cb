# v0.14.0 実装計画 - IR基盤実装

**対象バージョン**: v0.14.0  
**種別**: マイナーバージョン  
**作成日**: 2025年11月14日  
**ステータス**: Future Planning

---

## 🎯 概要

v0.14.0から、Cb言語はコンパイラ実装フェーズに移行します。
このバージョンでは、IR（中間表現）基盤の実装を行い、最適化とコード生成の基礎を構築します。

**重要な転換点**: インタプリタから→コンパイラベースへ

### 主要目標

1. **IR基盤の構築**
   - HIR (High-level IR) - ASTから直接変換
   - MIR (Mid-level IR) - 型情報とコントロールフロー
   - LIR (Low-level IR) - マシンコードに近い表現

2. **最適化パス**
   - 定数畳み込み
   - デッドコード削除
   - インライン展開

3. **IRインタプリタ**
   - IRを直接実行できる仕組み
   - デバッグとテスト用

### 期間

**3-4ヶ月**

---

## 📋 実装内容

### Phase 1: HIR実装（Week 1-4）

**目標**: ASTからHIRへの変換

```
AST → HIR
  - 構文糖衣の展開
  - 型情報の保持
  - コントロールフローの明示化
```

**実装項目**:
- HIR ノード定義
- AST→HIR変換器
- HIR検証器

### Phase 2: MIR実装（Week 5-8）

**目標**: HIRからMIRへの変換と最適化

```
HIR → MIR
  - SSA形式への変換
  - 基本ブロックの構築
  - コントロールフローグラフ（CFG）
```

**実装項目**:
- MIR ノード定義
- HIR→MIR変換器
- 最適化パス（定数畳み込み、デッドコード削除）

### Phase 3: LIR実装（Week 9-12）

**目標**: MIRからLIRへの変換

```
MIR → LIR
  - レジスタ割り当て
  - 命令選択
  - マシンコードに近い表現
```

**実装項目**:
- LIR ノード定義
- MIR→LIR変換器
- レジスタアロケータ

### Phase 4: IRインタプリタ（Week 13-14）

**目標**: IRを直接実行

**実装項目**:
- LIRインタプリタ
- デバッグ機能
- 既存テストとの統合

---

## 🎯 成功指標（KPI）

- **IRの完全性**: すべてのCb構文をIRで表現可能
- **最適化効果**: ベンチマークで10-20%の性能向上
- **テスト合格**: 既存の740+テストすべて合格
- **後方互換性**: 100%維持

---

## 📚 参考資料

- `ir_implementation_plan.md` - IR実装の詳細設計
- `multi_backend_architecture.md` - マルチバックエンド設計
- `low_level_support.md` - 低レベルサポート

---

## 🔄 次のバージョン

**v0.15.0**: 複数バックエンド対応（ネイティブコード生成、WASM、TypeScript）

---

**注**: v0.13.x で基本機能実装が完了していることが前提条件
