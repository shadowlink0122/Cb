````markdown
# v0.12.0 実装ガイド

このディレクトリには、v0.11.0で実装しきれなかった機能と、v0.12.0での実装計画が含まれています。

---

## 📚 ドキュメント構成

### v0.11.0 完了記録
1. **release_notes/v0.11.0.md** ⭐ **必読**
   - v0.11.0で実装した内容の完全なサマリー
   - ジェネリクスシステムの詳細
   - 文字列補間機能の詳細
   - テスト結果

### v0.12.0 実装計画
2. **v0.12.0_implementation_gaps.md** ⭐ **最優先**
   - 未実装機能の詳細な説明（v0.10.1から繰り越し）
   - 具体的なコードレベルでの修正箇所
   - 実装優先度の明示
   - テスト状況

3. **v0.12.0_rvalue_reference_roadmap.md** ⭐ **実装ロードマップ**
   - ムーブセマンティクスの完全実装計画
   - Phase 1-6 の段階的実装計画
   - 各Phaseの推定時間
   - チェックリスト

4. **v0.12.0_implementation_plan.md**
   - return文での自動ムーブ
   - ムーブ代入演算子
   - 右辺値の自動検出

### v0.12.0 以降
5. **v0.11.0_async_await_design.md**
   - 非同期/await構文の設計
   - 基本的な非同期処理

---

## 🚀 v0.12.0 実装を開始する前に

### Step 1: 現状を理解する
```bash
# 必読ドキュメント（この順番で読む）
1. release_notes/v0.11.0.md              # v0.11.0で完了したこと
2. v0.12.0_implementation_gaps.md        # 何が未実装か（詳細）
3. v0.12.0_rvalue_reference_roadmap.md   # どう実装するか（計画）
```

### Step 2: 環境をセットアップする
```bash
# プロジェクトルートから
git checkout feature/generics
make clean
make
make test  # 全3,211テストが成功することを確認
```

### Step 3: テストを実行する
```bash
# 統合テストを実行
./main

# 全テストが成功することを確認
```

---

## 📋 v0.12.0 実装チェックリスト

### Phase 1: 参照マップの実装（最優先）
- [ ] `src/backend/interpreter/core/interpreter.h` に `reference_maps_` を追加
- [ ] `Interpreter::resolve_reference()` を実装
- [ ] `Interpreter::register_reference()` を実装
- [ ] `push_scope()` / `pop_scope()` で参照マップを管理

**期待結果**: 参照変数の名前解決が可能になる

### Phase 2: メンバーアクセスの修正
- [ ] `src/backend/interpreter/evaluator/access/member.cpp` を修正
  - `evaluate_member_access_impl()` で `resolve_reference()` を呼び出す
- [ ] `test_member_access` が PASS になることを確認

**期待結果**: `ref.x` で元の変数 `p.x` が更新される

### Phase 3: メンバー代入の修正
- [ ] `src/backend/interpreter/executors/assignments/member_assignment.cpp` を修正
  - メンバー代入時に `resolve_reference()` を呼び出す
- [ ] `test_member_assignment` が PASS になることを確認

**期待結果**: `ref.x = 10` で元の変数 `p.x` が更新される

### Phase 4: エイリアシングのサポート
- [ ] `src/backend/interpreter/managers/variables/declaration.cpp` を修正
  - 参照の参照を正しく解決する
- [ ] `test_aliasing` が PASS になることを確認

**期待結果**: `Point&& ref2 = ref1` で `ref2` が `p1` を参照する

### Phase 5: デストラクタの自動呼び出し
- [ ] `Interpreter::call_destructors_for_scope()` を実装
- [ ] `pop_scope()` でデストラクタを呼び出す
- [ ] return/break/continue でもデストラクタを呼び出す

**期待結果**: スコープ終了時にデストラクタが自動的に呼ばれる

---

## 🎯 成功基準

v0.12.0の実装が成功したと判断する基準：

1. ✅ 全3,211テストが引き続き PASS
2. ✅ return文での自動ムーブが動作する
3. ✅ ムーブ代入演算子が実装される
4. ✅ 右辺値の自動検出が動作する
5. ✅ パフォーマンス劣化が10%以内
6. ✅ メモリリークがない（valgrindで確認）

---

## ⚠️ 重要な注意点

### 後方互換性を保つ
- 既存の3,211テストが壊れないようにする
- v0.11.0で実装したジェネリクス・文字列補間に影響を与えない
- 通常の変数宣言・代入に影響を与えない

### パフォーマンスに注意
- `resolve_reference()` は頻繁に呼ばれる可能性がある
- できるだけ効率的な実装を心がける
- 参照でない場合は早期リターンする

### デバッグのヒント
```cpp
// デバッグ出力を使う
debug_print("[REF_DEBUG] Resolving reference: %s\n", name.c_str());

// 条件付きコンパイル
#ifdef DEBUG_REFERENCES
    std::cerr << "Reference map: " << /* ... */ << std::endl;
#endif
```

---

## 📊 実装の進捗管理

### タイムライン（推定）
| Phase | 内容 | 推定時間 |
|-------|------|----------|
| 1 | 参照マップ実装 | 3時間 |
| 2 | メンバーアクセス修正 | 2時間 |
| 3 | メンバー代入修正 | 1時間 |
| 4 | エイリアシング | 1時間 |
| 5 | デストラクタ自動呼び出し | 3時間 |
| **合計** | | **10時間** |

### 進捗を記録する
実装を進める際は、以下のドキュメントを更新してください：

1. このREADMEのチェックリスト
2. `v0.10.1_implementation_progress.md`（新規作成を推奨）
3. `v0.10.1_rvalue_reference_roadmap.md`のチェックリスト

---

## 🆘 困ったときは

### よくある問題

**Q1: テストが PASS から FAIL に変わった**
```bash
# 差分を確認
git diff

# 特定のテストだけ実行
./main tests/cases/xxx/yyy.cb

# デバッグモードで実行
./main --debug tests/cases/xxx/yyy.cb
```

**Q2: メモリリークが発生した**
```bash
# valgrindで確認
valgrind --leak-check=full ./main tests/cases/xxx/yyy.cb
```

**Q3: パフォーマンスが低下した**
```bash
# プロファイリング
time make test

# 特定の処理の時間を計測
# （time(NULL)を使う、または<chrono>を使う）
```

---

## 📖 参考資料

### C++の参照セマンティクス
- [cppreference - References](https://en.cppreference.com/w/cpp/language/reference)
- [cppreference - Rvalue references](https://en.cppreference.com/w/cpp/language/reference#Rvalue_references)

### 実装のヒント
- 参照の参照は再帰的に解決する
- スコープと参照の有効期限を連動させる
- デストラクタは構築の逆順で呼び出す

---

## 🎉 完了したら

v0.12.0の実装が完了したら：

1. ✅ 全テストが PASS していることを確認
2. ✅ リリースノート `release_notes/v0.12.0.md` を作成
3. ✅ コミットとプッシュ
```bash
git add .
git commit -m "feat(v0.12.0): Complete move semantics implementation"
git push origin feature/generics
```

---

**最終更新**: 2025年10月27日  
**v0.11.0 完了時点**  
**次の実装者へ**: この資料があなたの実装をスムーズに進める助けになることを願っています！

````

---

**最終更新**: 2025年10月12日  
**v0.10.0 完了時点**  
**次の実装者へ**: この資料があなたの実装をスムーズに進める助けになることを願っています！
