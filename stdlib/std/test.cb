// Test Framework for Cb
// シンプルなテストフレームワーク - アサーションとテストランナー

export struct TestResult {
    int passed;
    int failed;
    int total;
};

export interface TestFramework {
    void assert_true(bool condition, string message);
    void assert_false(bool condition, string message);
    void assert_eq_int(int actual, int expected, string message);
    void assert_eq_long(long actual, long expected, string message);
    void assert_eq_bool(bool actual, bool expected, string message);
    void assert_eq_str(string actual, string expected, string message);
    TestResult get_result();
    void print_summary();
    void reset();
    int get_exit_code();
};

impl TestFramework for TestResult {
    void assert_true(bool condition, string message) {
        self.total = self.total + 1;
        if (condition) {
            self.passed = self.passed + 1;
            println("  ✅ {message}");
        } else {
            self.failed = self.failed + 1;
            println("  ❌ {message}");
        }
    }
    
    void assert_false(bool condition, string message) {
        self.assert_true(!condition, message);
    }
    
    void assert_eq_int(int actual, int expected, string message) {
        self.total = self.total + 1;
        if (actual == expected) {
            self.passed = self.passed + 1;
            println("  ✅ {message}");
        } else {
            self.failed = self.failed + 1;
            println("  ❌ {message} (expected: {expected}, got: {actual})");
        }
    }
    
    void assert_eq_long(long actual, long expected, string message) {
        self.total = self.total + 1;
        if (actual == expected) {
            self.passed = self.passed + 1;
            println("  ✅ {message}");
        } else {
            self.failed = self.failed + 1;
            println("  ❌ {message} (expected: {expected}, got: {actual})");
        }
    }
    
    void assert_eq_bool(bool actual, bool expected, string message) {
        self.total = self.total + 1;
        if (actual == expected) {
            self.passed = self.passed + 1;
            println("  ✅ {message}");
        } else {
            self.failed = self.failed + 1;
            if (expected) {
                println("  ❌ {message} (expected: true, got: false)");
            } else {
                println("  ❌ {message} (expected: false, got: true)");
            }
        }
    }
    
    void assert_eq_str(string actual, string expected, string message) {
        self.total = self.total + 1;
        if (actual == expected) {
            self.passed = self.passed + 1;
            println("  ✅ {message}");
        } else {
            self.failed = self.failed + 1;
            println("  ❌ {message} (expected: '{expected}', got: '{actual}')");
        }
    }
    
    TestResult get_result() {
        return self;
    }
    
    void print_summary() {
        println("");
        println("═══════════════════════════════════════════════════════");
        println("Test Results: {self.passed} passed, {self.failed} failed, {self.total} total");
        println("═══════════════════════════════════════════════════════");
        
        if (self.failed == 0) {
            println("✅ All tests passed!");
        } else {
            println("❌ Some tests failed");
        }
    }
    
    void reset() {
        self.passed = 0;
        self.failed = 0;
        self.total = 0;
    }
    
    int get_exit_code() {
        if (self.failed == 0) {
            return 0;
        } else {
            return 1;
        }
    }
};

impl TestResult {
    self() {
        self.passed = 0;
        self.failed = 0;
        self.total = 0;
    }
    
    ~self() {
        // Nothing to clean up
    }
};

// ヘルパー関数
export void print_test_header(string test_name) {
    println("");
    println("╔════════════════════════════════════════════════════════════╗");
    println("║  {test_name}");
    println("╚════════════════════════════════════════════════════════════╝");
    println("");
}

export void print_section(string section_name) {
    println("");
    println("=== {section_name} ===");
}
